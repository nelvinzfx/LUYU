<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUYU - Platform Ojol Syariah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      tailwind.config = {
          theme: {
              extend: {
                  colors: {
                      'luyu-green': '#2ecc71',
                      'luyu-gold': '#f1c40f',
                      'luyu-blue': '#3498db',
                      'luyu-red': '#e74c3c',
                      'luyu-purple': '#9b59b6',
                      'luyu-gray': '#95a5a6'
                  },
                  fontFamily: {
                      'sans': ['Inter', 'system-ui', 'sans-serif'],
                  },
                  animation: {
                      'fade-in': 'fadeIn 0.5s ease-in-out',
                      'slide-up': 'slideUp 0.3s ease-out',
                      'slide-right': 'slideRight 0.3s ease-out',
                      'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                  }
              }
          }
      }
    </script>
    <style>
      @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
      }
      @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
      }
      @keyframes slideRight {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
      }
      /* Base Preloader Styles */
      .preloader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 25%, #f0f9ff 75%, #eff6ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      overflow: hidden;
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .preloader-overlay.fade-out {
      opacity: 0;
      visibility: hidden;
      transform: scale(1.1);
      }
      .preloader-container {
      text-align: center;
      position: relative;
      z-index: 10;
      animation: containerFadeIn 1s ease-out;
      }
      /* Logo Styles */
      .preloader-logo {
      margin-bottom: 2rem;
      }
      .logo-icon {
      display: inline-block;
      animation: logoFloat 3s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(16, 185, 129, 0.3));
      }
      .logo-icon svg {
      animation: logoRotate 4s linear infinite;
      }
      .logo-custom {
      display: inline-block;
      animation: logoFloat 3s ease-in-out infinite;
      }
      .logo-custom img {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      object-fit: contain;
      }
      .hidden { display: none; }
      /* Text Styles */
      .app-title {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #10b981, #059669, #3b82f6);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      letter-spacing: 0.1em;
      animation: gradientShift 3s ease-in-out infinite;
      }
      .app-subtitle {
      font-size: 1.125rem;
      color: #6b7280;
      font-weight: 500;
      opacity: 0.8;
      margin-bottom: 2.5rem;
      }
      /* Loading Dots */
      .loading-dots {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      }
      .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: linear-gradient(135deg, #10b981, #3b82f6);
      animation: dotPulse 1.5s ease-in-out infinite;
      }
      .dot-2 { animation-delay: 0.2s; }
      .dot-3 { animation-delay: 0.4s; }
      .loading-status {
      font-size: 0.875rem;
      color: #6b7280;
      font-weight: 500;
      margin-bottom: 2rem;
      }
      /* Progress Bar */
      .preloader-progress {
      width: 280px;
      margin: 0 auto;
      }
      .progress-bar-container {
      width: 100%;
      height: 6px;
      background-color: rgba(16, 185, 129, 0.2);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
      }
      .progress-fill-animation {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #059669, #3b82f6);
      border-radius: 10px;
      width: 0%;
      transition: width 0.3s ease;
      }
      .progress-text {
      font-size: 0.75rem;
      color: #10b981;
      font-weight: 600;
      }
      /* Background Pattern */
      .preloader-pattern {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      opacity: 0.1;
      z-index: 1;
      }
      .pattern-circle {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(135deg, #10b981, #3b82f6);
      opacity: 0.3;
      }
      .circle-1 {
      width: 300px;
      height: 300px;
      top: -150px;
      right: -150px;
      animation: circleFloat1 8s ease-in-out infinite;
      }
      .circle-2 {
      width: 200px;
      height: 200px;
      bottom: -100px;
      left: -100px;
      animation: circleFloat2 6s ease-in-out infinite reverse;
      }
      .circle-3 {
      width: 150px;
      height: 150px;
      top: 20%;
      left: -75px;
      animation: circleFloat3 10s ease-in-out infinite;
      }
      /* Animations */
      @keyframes containerFadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
      }
      @keyframes logoFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      }
      @keyframes logoRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
      }
      @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      }
      @keyframes dotPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      }
      @keyframes circleFloat1 {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(-30px, -30px) rotate(120deg); }
      66% { transform: translate(30px, -15px) rotate(240deg); }
      }
      @keyframes circleFloat2 {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(20px, -40px) rotate(180deg); }
      }
      @keyframes circleFloat3 {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(40px, 20px) rotate(90deg); }
      50% { transform: translate(20px, -30px) rotate(180deg); }
      75% { transform: translate(-20px, 10px) rotate(270deg); }
      }
      /* Dark Mode Support */
      .dark .preloader-overlay {
      background: linear-gradient(135deg, #111827 0%, #1f2937 25%, #374151 75%, #1f2937 100%);
      }
      .dark .app-subtitle,
      .dark .loading-status {
      color: #d1d5db;
      }
      /* Mobile Responsive */
      @media (max-width: 768px) {
      .app-title { font-size: 2.5rem; }
      .app-subtitle { font-size: 1rem; }
      .logo-icon svg, .logo-custom img { width: 60px; height: 60px; }
      .preloader-progress { width: 240px; }
      }
      .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      }
      .switch input {
      opacity: 0;
      width: 0;
      height: 0;
      }
      .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #d1d5db;
      transition: all 0.4s ease;
      border-radius: 24px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: all 0.4s ease;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      input:checked + .slider {
      background-color: #2ecc71;
      box-shadow: inset 0 2px 4px rgba(46, 204, 113, 0.3);
      }
      input:checked + .slider:before {
      transform: translateX(26px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      /* Enhanced switch variants */
      .switch-gold input:checked + .slider {
      background-color: #f1c40f;
      box-shadow: inset 0 2px 4px rgba(241, 196, 15, 0.3);
      }
      .switch-blue input:checked + .slider {
      background-color: #3498db;
      box-shadow: inset 0 2px 4px rgba(52, 152, 219, 0.3);
      }
      .switch-purple input:checked + .slider {
      background-color: #9b59b6;
      box-shadow: inset 0 2px 4px rgba(155, 89, 182, 0.3);
      }
      .sidebar-item:hover {
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
      }
      .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .gradient-text {
      background: linear-gradient(135deg, #2ecc71, #3498db);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      }
      .modal {
      transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .modal.hidden {
      opacity: 0;
      visibility: hidden;
      }
      .modal:not(.hidden) {
      opacity: 1;
      visibility: visible;
      }
      .notification-enter {
      animation: slideUp 0.3s ease-out;
      }
      .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2ecc71;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      }
      @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
      }
      .data-table {
      overflow-x: auto;
      }
      .data-table table {
      width: 100%;
      border-collapse: collapse;
      }
      .data-table th, .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      }
      .data-table th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
      }
      .data-table tr:hover {
      background-color: #f9fafb;
      }
      /* Driver panel styles */
      .driver-panel {
      transform: translateX(100%);
      transition: transform 0.3s ease;
      }
      .driver-panel.active {
      transform: translateX(0);
      }
      /* Interactive map styles */
      .cluster-zone {
      cursor: pointer;
      transition: all 0.3s ease;
      }
      .cluster-zone:hover {
      opacity: 0.8;
      stroke-width: 3;
      }
      .driver-marker {
      cursor: pointer;
      transition: all 0.2s ease;
      }
      .driver-marker:hover {
      transform: scale(1.2);
      }
      /* Tooltip styles */
      .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.2s ease;
      }
      .tooltip.show {
      opacity: 1;
      }
      /* Status badges */
      .status-pending {
      background-color: #f1c40f;
      color: #856404;
      }
      .status-confirmed {
      background-color: #3498db;
      color: #1a365d;
      }
      .status-pickup {
      background-color: #9b59b6;
      color: #4a1a4a;
      }
      .status-ongoing {
      background-color: #e67e22;
      color: #8b4513;
      }
      .status-completed {
      background-color: #2ecc71;
      color: #155724;
      }
      .status-cancelled {
      background-color: #e74c3c;
      color: #721c24;
      }
      /* Progress bars */
      .progress-bar {
      width: 100%;
      height: 8px;
      background-color: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      }
      .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2ecc71, #3498db);
      transition: width 0.3s ease;
      }
      /* Chart containers */
      .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
      }
      .chart-container canvas {
      max-height: 100%;
      }
      /* Mobile Responsive Styles */
      @media (max-width: 1024px) {
      /* Hide sidebar by default on mobile */
      aside {
      position: fixed;
      top: 0;
      left: -100%;
      width: 280px;
      height: 100vh;
      z-index: 50;
      transition: left 0.3s ease-in-out;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }
      aside.mobile-open {
      left: 0;
      }
      /* Main content adjustments */
      main {
      width: 100%;
      margin-left: 0;
      }
      /* Overlay for mobile sidebar */
      .mobile-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 40;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      }
      .mobile-overlay.active {
      opacity: 1;
      visibility: visible;
      }
      /* Grid adjustments for mobile */
      .grid.grid-cols-12 {
      grid-template-columns: 1fr;
      }
      .col-span-8, .col-span-4 {
      grid-column: span 1;
      }
      /* Card spacing adjustments */
      .space-y-6 > * + * {
      margin-top: 1.5rem;
      }
      /* Header adjustments */
      header {
      padding-left: 1rem;
      padding-right: 1rem;
      }
      /* Content padding adjustments */
      #main-content {
      padding: 1rem;
      }
      }
      @media (max-width: 768px) {
      /* Smaller screens adjustments */
      .grid.grid-cols-2 {
      grid-template-columns: 1fr;
      }
      .grid.grid-cols-3 {
      grid-template-columns: repeat(2, 1fr);
      }
      .grid.grid-cols-4 {
      grid-template-columns: repeat(2, 1fr);
      }
      /* Text size adjustments */
      .text-2xl {
      font-size: 1.5rem;
      }
      .text-xl {
      font-size: 1.25rem;
      }
      /* Modal adjustments */
      .modal > div {
      margin: 1rem;
      max-width: calc(100vw - 2rem);
      }
      /* Driver panel mobile */
      .driver-panel {
      width: 100%;
      height: 60vh;
      top: auto;
      bottom: 0;
      transform: translateY(100%);
      border-radius: 1rem 1rem 0 0;
      }
      .driver-panel.active {
      transform: translateY(0);
      }
      /* Driver toggle button mobile */
      .driver-toggle {
      bottom: 1rem;
      right: 1rem;
      width: 3.5rem;
      height: 3.5rem;
      }
      }
      @media (max-width: 480px) {
      /* Very small screens */
      .p-8 {
      padding: 1rem;
      }
      .p-6 {
      padding: 1rem;
      }
      .gap-8 {
      gap: 1rem;
      }
      .gap-6 {
      gap: 1rem;
      }
      /* Stack everything vertically */
      .grid.grid-cols-3, .grid.grid-cols-4 {
      grid-template-columns: 1fr;
      }
      }
      /* Hamburger Menu Styles */
      .hamburger-menu {
      display: none;
      flex-direction: column;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 0.5rem;
      transition: background-color 0.2s;
      }
      .hamburger-menu:hover {
      background-color: rgba(0, 0, 0, 0.05);
      }
      .hamburger-line {
      width: 1.5rem;
      height: 2px;
      background-color: #4b5563;
      margin: 2px 0;
      transition: all 0.3s ease;
      }
      .hamburger-menu.active .hamburger-line:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
      }
      .hamburger-menu.active .hamburger-line:nth-child(2) {
      opacity: 0;
      }
      .hamburger-menu.active .hamburger-line:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
      }
      @media (max-width: 1024px) {
      .hamburger-menu {
      display: flex;
      }
      }
      /* Touch-friendly adjustments */
      @media (hover: none) and (pointer: coarse) {
      /* Touch devices */
      button, .button, .sidebar-item, .card-hover {
      min-height: 44px; /* Apple's recommended touch target size */
      }
      .switch {
      width: 60px;
      height: 32px;
      }
      .switch input:checked + .slider:before {
      transform: translateX(28px);
      }
      }
      /* Maps template specific fixes */
      #main-content {
      overflow-y: auto;
      max-height: calc(100vh - 80px); /* Adjust based on header height */
      }
      /* Ensure maps template has proper spacing */
      .maps-template-container {
      min-height: calc(100vh - 120px);
      padding-bottom: 2rem;
      }
      /* Fix for sidebar scrolling in maps */
      @media (max-width: 1024px) {
      .maps-template-container .grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      }
      .maps-template-container .col-span-8,
      .maps-template-container .col-span-4 {
      grid-column: span 1;
      }
      /* Reduce map height on mobile */
      .maps-template-container #interactive-map {
      height: 400px;
      }
      }
      /* Ensure last element is visible */
      .space-y-6 > :last-child {
      margin-bottom: 1.5rem;
      }
      /* Live Kajian Modal Responsive Fixes */
      .modal {
      padding: 0.5rem;
      }
      @media (min-width: 1024px) {
      .modal {
      padding: 1rem;
      }
      }
      /* Enhanced Video Area */
      .live-video-area {
      min-height: 300px;
      position: relative;
      }
      @media (min-width: 768px) {
      .live-video-area {
      min-height: 400px;
      }
      }
      @media (min-width: 1024px) {
      .live-video-area {
      min-height: 500px;
      }
      }
      @media (min-width: 1280px) {
      .live-video-area {
      min-height: 600px;
      }
      }
      /* Chat Messages Styling */
      .chat-message {
      margin-bottom: 0.75rem;
      word-wrap: break-word;
      word-break: break-word;
      }
      .chat-message:last-child {
      margin-bottom: 0;
      }
      /* Improved Text Contrast */
      #live-kajian-title {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }
      #live-kajian-ustadz {
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      }
      /* Mobile Chat Overlay Reduced Blur */
      #mobile-chat-overlay {
      z-index: 60;
      backdrop-filter: blur(2px);
      }
      #mobile-chat-overlay .bg-white {
      animation: slideUpFromBottom 0.3s ease-out;
      border-top: 1px solid #e5e7eb;
      }
      @keyframes slideUpFromBottom {
      from {
      transform: translateY(100%);
      opacity: 0;
      }
      to {
      transform: translateY(0);
      opacity: 1;
      }
      }
      /* Optimized Chat Scrollbar */
      #chat-messages, #mobile-chat-messages {
      scrollbar-width: thin;
      scrollbar-color: #d1d5db #f9fafb;
      }
      #chat-messages::-webkit-scrollbar, #mobile-chat-messages::-webkit-scrollbar {
      width: 4px;
      }
      #chat-messages::-webkit-scrollbar-track, #mobile-chat-messages::-webkit-scrollbar-track {
      background: #f9fafb;
      border-radius: 2px;
      }
      #chat-messages::-webkit-scrollbar-thumb, #mobile-chat-messages::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 2px;
      }
      #chat-messages::-webkit-scrollbar-thumb:hover, #mobile-chat-messages::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
      }
      /* Responsive Chat Width */
      @media (min-width: 1024px) {
      .live-kajian-chat {
      width: 18rem; /* 288px - reduced from 320px */
      }
      }
      @media (min-width: 1280px) {
      .live-kajian-chat {
      width: 20rem; /* 320px - reduced from 384px */
      }
      }
      /* Better Mobile Controls */
      @media (max-width: 1023px) {
      .mobile-controls {
      backdrop-filter: blur(4px);
      }
      }
      /* Responsive Text Scaling */
      @media (max-width: 640px) {
      .live-kajian-modal .text-2xl {
      font-size: 1.25rem;
      line-height: 1.75rem;
      }
      .live-kajian-modal .text-xl {
      font-size: 1.125rem;
      line-height: 1.75rem;
      }
      .live-kajian-modal .text-lg {
      font-size: 1rem;
      line-height: 1.5rem;
      }
      }
      /* Enhanced Backdrop */
      .video-backdrop {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      }
      /* Message Bubble Improvements */
      .chat-message .bg-gray-100 {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      }
      .chat-message.own-message .bg-luyu-green\/10 {
      background-color: rgba(46, 204, 113, 0.1);
      border-left: 3px solid #2ecc71;
      }
      /* Focus States */
      #chat-input:focus, #mobile-chat-input:focus {
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
      border-color: #2ecc71;
      }
      /* Button Hover States */
      button:hover {
      transform: translateY(-1px);
      transition: all 0.2s ease;
      }
      button:active {
      transform: translateY(0);
      }
      /* Dark Mode Variables */
      :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --shadow-color: rgba(0, 0, 0, 0.1);
      }
      :root.dark {
      --bg-primary: #1f2937;
      --bg-secondary: #111827;
      --text-primary: #f9fafb;
      --text-secondary: #d1d5db;
      --border-color: #374151;
      --shadow-color: rgba(0, 0, 0, 0.3);
      }
      /* Dark Mode Theme Switching */
      .dark {
      color-scheme: dark;
      }
      /* Smooth transition for theme switching */
      * {
      transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 300ms;
      }
      /* Dark Mode Styles */
      .dark body {
      background-color: #111827;
      color: #f9fafb;
      }
      .dark aside {
      background-color: #1f2937;
      border-color: #374151;
      }
      .dark .sidebar-item {
      color: #d1d5db;
      }
      .dark .sidebar-item:hover {
      background-color: #374151;
      color: #f9fafb;
      }
      .dark .sidebar-item.active {
      background-color: rgba(46, 204, 113, 0.1);
      color: #10b981;
      }
      .dark main {
      background-color: #111827;
      }
      .dark .bg-white {
      background-color: #1f2937 !important;
      }
      .dark .bg-gray-50 {
      background-color: #374151 !important;
      }
      .dark .bg-gray-100 {
      background-color: #4b5563 !important;
      }
      .dark .text-gray-800 {
      color: #f9fafb !important;
      }
      .dark .text-gray-700 {
      color: #e5e7eb !important;
      }
      .dark .text-gray-600 {
      color: #d1d5db !important;
      }
      .dark .text-gray-500 {
      color: #9ca3af !important;
      }
      .dark .border-gray-100 {
      border-color: #374151 !important;
      }
      .dark .border-gray-200 {
      border-color: #4b5563 !important;
      }
      .dark .border-gray-300 {
      border-color: #6b7280 !important;
      }
      /* DASHBOARD NUMBERS - Fix untuk angka dashboard */
      .dark .dashboard-number,
      .dark .text-3xl,
      .dark .text-2xl,
      .dark .font-bold {
      color: #f9fafb !important;
      }
      /* Specific dashboard card fixes */
      .dark .bg-white .text-3xl {
      color: #f9fafb !important;
      }
      .dark .bg-white .text-2xl {
      color: #f9fafb !important;
      }
      .dark .bg-white .font-bold {
      color: #f9fafb !important;
      }
      /* Dashboard stats yang berwarna harus tetap kontras */
      .dark .text-luyu-green {
      color: #10b981 !important;
      }
      .dark .text-luyu-blue {
      color: #3b82f6 !important;
      }
      .dark .text-luyu-gold {
      color: #f59e0b !important;
      }
      .dark .text-luyu-purple {
      color: #8b5cf6 !important;
      }
      /* Dark Mode Cards */
      .dark .card-hover {
      background-color: #1f2937;
      border-color: #374151;
      }
      .dark .card-hover:hover {
      background-color: #374151;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      }
      /* Dark Mode Modals */
      .dark .modal {
      background-color: rgba(0, 0, 0, 0.8);
      }
      .dark .modal > div {
      background-color: #1f2937;
      border-color: #374151;
      }
      /* Dark Mode Forms */
      .dark input[type="text"],
      .dark input[type="email"],
      .dark input[type="password"],
      .dark input[type="number"],
      .dark select,
      .dark textarea {
      background-color: #374151;
      border-color: #4b5563;
      color: #f9fafb;
      }
      .dark input[type="text"]:focus,
      .dark input[type="email"]:focus,
      .dark input[type="password"]:focus,
      .dark input[type="number"]:focus,
      .dark select:focus,
      .dark textarea:focus {
      background-color: #4b5563;
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      }
      .dark input::placeholder {
      color: #9ca3af;
      }
      /* Dark Mode Toggle Button Animation - FIXED */
      #dark-mode-toggle {
      overflow: hidden;
      width: 2.5rem;
      height: 2.5rem;
      }
      #dark-mode-toggle:hover {
      transform: scale(1.05);
      }
      /* Default state (Light Mode) - Sun visible */
      #sun-icon {
      opacity: 1;
      transform: rotate(0deg) scale(1);
      }
      #moon-icon {
      opacity: 0;
      transform: rotate(90deg) scale(0);
      }
      /* Dark Mode state - Moon visible */
      .dark #sun-icon {
      opacity: 0;
      transform: rotate(90deg) scale(0);
      }
      .dark #moon-icon {
      opacity: 1;
      transform: rotate(0deg) scale(1);
      }
      /* Theme Transition Animation */
      .theme-transition {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      /* Dark Mode for Charts */
      .dark .chart-container {
      background-color: #1f2937;
      border-color: #374151;
      }
      /* CLUSTER MAP FIXES - Khusus untuk Cluster B */
      .dark .cluster-zone[data-cluster="b"] rect {
      fill: rgba(251, 191, 36, 0.15) !important; /* Gold/Yellow dengan opacity rendah */
      stroke: #fbbf24 !important; /* Border yang lebih terang */
      stroke-width: 3;
      }
      .dark .cluster-zone[data-cluster="b"] text {
      fill: #fbbf24 !important; /* Text yang kontras */
      }
      .dark .cluster-zone[data-cluster="a"] rect {
      fill: rgba(59, 130, 246, 0.15) !important;
      stroke: #3b82f6 !important;
      }
      .dark .cluster-zone[data-cluster="a"] text {
      fill: #60a5fa !important;
      }
      .dark .cluster-zone[data-cluster="c"] rect {
      fill: rgba(16, 185, 129, 0.15) !important;
      stroke: #10b981 !important;
      }
      .dark .cluster-zone[data-cluster="c"] text {
      fill: #34d399 !important;
      }
      /* Map background dark mode */
      .dark #interactive-map svg rect:first-child {
      fill: #374151 !important;
      }
      /* Driver markers dark mode */
      .dark .driver-marker[fill="#f39c12"] {
      fill: #fbbf24 !important;
      stroke: #1f2937 !important;
      }
      .dark .driver-marker[fill="#3498db"] {
      fill: #3b82f6 !important;
      stroke: #1f2937 !important;
      }
      .dark .driver-marker[fill="#2ecc71"] {
      fill: #10b981 !important;
      stroke: #1f2937 !important;
      }
      /* Dark Mode for Status Badges - Keep original colors but adjust contrast */
      .dark .status-pending {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
      color: #78350f;
      }
      .dark .status-confirmed {
      background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 50%, #2563eb 100%);
      color: #1e3a8a;
      }
      .dark .status-completed {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 50%, #16a34a 100%);
      color: #14532d;
      }
      /* Dark Mode Data Tables */
      .dark .data-table {
      background-color: #1f2937;
      border-color: #374151;
      }
      .dark .data-table th {
      background-color: #374151;
      color: #f9fafb;
      }
      .dark .data-table tr:hover {
      background-color: #374151;
      }
      /* Dark Mode Switch Components */
      .dark .switch .slider {
      background-color: #4b5563;
      }
      .dark .switch input:checked + .slider {
      background-color: #10b981;
      }
      /* Animation for theme icon */
      .theme-icon-animation {
      animation: rotateIcon 0.5s ease-in-out;
      }
      @keyframes rotateIcon {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
      }
      /* Responsive dark mode adjustments */
      @media (max-width: 768px) {
      .dark .hamburger-line {
      background-color: #d1d5db;
      }
      #dark-mode-toggle {
      padding: 0.5rem;
      width: 2.25rem;
      height: 2.25rem;
      }
      #dark-mode-toggle svg {
      width: 1.25rem;
      height: 1.25rem;
      }
      }
      /* Header Default Light Theme - FORCE OVERRIDE */
      header {
      background-color: #ffffff !important;
      border-bottom: 1px solid #e5e7eb !important;
      color: #1f2937 !important;
      }
      /* Header Dark Theme */
      .dark header {
      background-color: #1f2937 !important;
      border-bottom: 1px solid #374151 !important;
      color: #f9fafb !important;
      }
      /* Ensure header elements maintain light theme by default */
      header h1 {
      color: #1f2937 !important;
      }
      header p {
      color: #6b7280 !important;
      }
      .dark header h1 {
      color: #f9fafb !important;
      }
      .dark header p {
      color: #d1d5db !important;
      }
      /* Header button default states */
      header button:not(.bg-gradient-to-r) {
      color: #6b7280 !important;
      }
      .dark header button:not(.bg-gradient-to-r) {
      color: #d1d5db !important;
      }
      /* Search input in header */
      header input[type="text"] {
      background-color: #ffffff !important;
      border-color: #d1d5db !important;
      color: #1f2937 !important;
      }
      .dark header input[type="text"] {
      background-color: #374151 !important;
      border-color: #4b5563 !important;
      color: #f9fafb !important;
      }
      /* Dark mode toggle button */
      #dark-mode-toggle {
      background-color: #f3f4f6 !important;
      }
      .dark #dark-mode-toggle {
      background-color: #374151 !important;
      }
      #dark-mode-toggle:hover {
      background-color: #e5e7eb !important;
      }
      .dark #dark-mode-toggle:hover {
      background-color: #4b5563 !important;
      }
      /* Hamburger menu lines */
      .hamburger-line {
      background-color: #4b5563 !important;
      }
      .dark .hamburger-line {
      background-color: #d1d5db !important;
      }
      /* Override any conflicting dark mode styles for header */
      .dark header.bg-white {
      background-color: #1f2937 !important;
      }
      /* Ensure notification badge stays visible */
      header .bg-luyu-red {
      background-color: #ef4444 !important;
      color: #ffffff !important;
      }
      /* Gradient button should maintain its colors */
      header .bg-gradient-to-r {
      background: linear-gradient(to right, #10b981, #3b82f6) !important;
      color: #ffffff !important;
      }
      /* Remove any potential dark mode overrides on header */
      .dark aside,
      .dark main {
      /* Keep these dark */
      }
      /* But keep header light/dark controlled */
      header * {
      transition: all 0.3s ease !important;
      }
      /* Cluster B Dashboard Elements - Dark Mode Fix */
      .dark .text-gray-800 {
      color: #f9fafb !important;
      }
      .dark .text-gray-600 {
      color: #d1d5db !important;
      }
      .dark .text-gray-500 {
      color: #9ca3af !important;
      }
      /* Specific fix for cluster cards */
      .dark .chart-container + h4.text-gray-800 {
      color: #f9fafb !important;
      }
      .dark .chart-container + h4 + p.text-gray-600 {
      color: #d1d5db !important;
      }
      .dark .progress-bar + p.text-gray-500 {
      color: #9ca3af !important;
      }
      /* Progress bar adjustments for better contrast in dark mode */
      .dark .progress-bar {
      background-color: #374151 !important;
      }
      .dark .progress-fill.bg-orange-500 {
      background-color: #f97316 !important; /* Brighter orange for dark mode */
      }
      /* Alternative: if you want to keep the orange but make it more visible */
      .dark .bg-orange-500 {
      background-color: #fb923c !important;
      }
      /* General cluster card text fixes */
      .dark [class*="text-gray-800"] {
      color: #f9fafb !important;
      }
      .dark [class*="text-gray-600"] {
      color: #d1d5db !important;
      }
      .dark [class*="text-gray-500"] {
      color: #9ca3af !important;
      }
      /* Chart container background for dark mode */
      .dark .chart-container {
      background-color: #1f2937 !important;
      border-color: #374151 !important;
      }
      /* Canvas elements in dark mode */
      .dark .chart-container canvas {
      background-color: transparent !important;
      }
      /* Ensure all cluster elements are properly themed */
      .dark .cluster-stat h4,
      .dark .cluster-stat p,
      .dark .cluster-stat span {
      color: inherit !important;
      }
      /* Specific cluster B styling enhancements */
      .dark .cluster-stat.bg-orange-50 {
      background-color: rgba(251, 146, 60, 0.1) !important;
      border-color: #f97316 !important;
      }
      .dark .cluster-stat.bg-orange-50 h4 {
      color: #f9fafb !important;
      }
      .dark .cluster-stat.bg-orange-50 p {
      color: #d1d5db !important;
      }
      .dark .cluster-stat.bg-orange-50 .text-orange-500 {
      color: #fb923c !important;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen font-sans">
    <!-- PRELOADER -->
    <div id="preloader" class="preloader-overlay">
      <div class="preloader-container">
        <!-- Logo Area -->
        <div class="preloader-logo">
          <div id="default-logo" class="logo-icon">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
              <defs>
                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981"/>
                  <stop offset="50%" style="stop-color:#059669"/>
                  <stop offset="100%" style="stop-color:#3b82f6"/>
                </linearGradient>
              </defs>
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="url(#logoGradient)"/>
            </svg>
          </div>
          <div id="custom-logo" class="logo-custom hidden">
            <img id="custom-logo-img" src="" alt="LUYU Logo" />
          </div>
        </div>
        <!-- App Name -->
        <div class="preloader-text">
          <h1 id="app-name" class="app-title">LUYU</h1>
          <p id="app-tagline" class="app-subtitle">Ojek Online Syariah</p>
        </div>
        <!-- Loading Animation -->
        <div class="preloader-loading">
          <div class="loading-dots">
            <div class="dot dot-1"></div>
            <div class="dot dot-2"></div>
            <div class="dot dot-3"></div>
          </div>
          <p id="loading-text" class="loading-status">Memuat aplikasi...</p>
        </div>
        <!-- Progress Bar -->
        <div class="preloader-progress">
          <div class="progress-bar-container">
            <div id="progress-fill" class="progress-fill-animation"></div>
          </div>
          <span id="progress-percentage" class="progress-text">0%</span>
        </div>
      </div>
      <!-- Background Pattern -->
      <div class="preloader-pattern">
        <div class="pattern-circle circle-1"></div>
        <div class="pattern-circle circle-2"></div>
        <div class="pattern-circle circle-3"></div>
      </div>
    </div>
    <!-- NOTIFICATION SYSTEM -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center">
      <div class="bg-white rounded-lg p-6 flex items-center">
        <div class="loading-spinner mr-3"></div>
        <span class="text-gray-700">Memproses...</span>
      </div>
    </div>
    <!-- TOOLTIP -->
    <div id="tooltip" class="tooltip"></div>
    <!-- MAIN CONTAINER -->
    <div class="flex min-h-screen">
      <!-- ========== SIDEBAR ========== -->
      <aside class="w-72 bg-white border-r border-gray-200 shadow-lg">
        <!-- LOGO & BRAND -->
        <div class="p-6 border-b border-gray-100">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-gradient-to-r from-luyu-green to-luyu-blue rounded-xl flex items-center justify-center">
              <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </div>
            <div class="ml-3">
              <h1 class="text-xl font-bold gradient-text">LUYU</h1>
              <p class="text-sm text-gray-500">Ojol Syariah Platform</p>
            </div>
          </div>
        </div>
        <!-- NAVIGATION MENU -->
        <nav class="p-4">
          <div class="space-y-2">
            <a href="#" onclick="showPage('dashboard')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="dashboard">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
              </svg>
              <span class="font-medium">Dashboard</span>
            </a>
            <a href="#" onclick="showPage('maps')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="maps">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"/>
              </svg>
              <span class="font-medium">Peta Cluster</span>
            </a>
            <a href="#" onclick="showPage('orders')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="orders">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
              </svg>
              <span class="font-medium">Pesanan</span>
              <span class="ml-auto bg-luyu-red text-white text-xs px-2 py-1 rounded-full">3</span>
            </a>
            <a href="#" onclick="showPage('wallet')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="wallet">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
              </svg>
              <span class="font-medium">Dompet Syariah</span>
            </a>
            <a href="#" onclick="showPage('analytics')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="analytics">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span class="font-medium">Analitik</span>
            </a>
            <div class="border-t border-gray-100 my-4 pt-4">
              <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-3 px-4">Syariah</p>
              <a href="#" onclick="showPage('zakat')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="zakat">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <span class="font-medium">Zakat & Infaq</span>
              </a>
              <a href="#" onclick="showPage('wakaf')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="wakaf">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                <span class="font-medium">Wakaf Digital</span>
              </a>
              <a href="#" onclick="showPage('kajian')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="kajian">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <span class="font-medium">Kajian Online</span>
              </a>
            </div>
            <div class="border-t border-gray-100 my-4 pt-4">
              <a href="#" onclick="showPage('settings')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="settings">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span class="font-medium">Pengaturan</span>
              </a>
            </div>
          </div>
        </nav>
        <!-- USER PROFILE SECTION -->
        <div class="px-4 py-6 mt-8 border-t border-gray-200">
          <div class="bg-gradient-to-br from-luyu-green/5 to-luyu-blue/5 rounded-2xl p-4 border border-luyu-green/10">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-gradient-to-r from-luyu-green to-luyu-blue rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
              </div>
              <div class="ml-3 flex-1">
                <p class="font-bold text-gray-800 text-sm">Ahmad Santoso</p>
                <p class="text-xs text-gray-600">ahmad.santoso@email.com</p>
                <div class="flex items-center mt-1">
                  <span class="bg-luyu-gold/20 text-luyu-gold px-2 py-0.5 rounded-full text-xs font-semibold">Level 2</span>
                  <span class="ml-2 text-xs text-gray-500">230 Pahala</span>
                </div>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200/50">
              <div class="grid grid-cols-2 gap-3 text-center">
                <div>
                  <p class="text-lg font-bold text-luyu-green">127</p>
                  <p class="text-xs text-gray-600">Total Trip</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-luyu-blue">2.4M</p>
                  <p class="text-xs text-gray-600">Pahala Points</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>
      <!-- ========== MAIN CONTENT ========== -->
      <main class="flex-1 overflow-hidden relative">
        <!-- TOP HEADER -->
        <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-600 px-8 py-4 transition-colors duration-300">
          <div class="flex items-center justify-between">
            <!-- Mobile Hamburger Menu -->
            <div class="hamburger-menu" onclick="toggleMobileSidebar()">
              <div class="hamburger-line bg-gray-600 dark:bg-gray-300 transition-colors duration-300"></div>
              <div class="hamburger-line bg-gray-600 dark:bg-gray-300 transition-colors duration-300"></div>
              <div class="hamburger-line bg-gray-600 dark:bg-gray-300 transition-colors duration-300"></div>
            </div>
            <div class="flex-1 ml-4">
              <h1 id="page-title" class="text-2xl font-bold text-gray-800 dark:text-white transition-colors duration-300">Assalamu'alaikum, Ahmad!</h1>
              <p id="page-subtitle" class="text-gray-600 dark:text-gray-300 hidden md:block transition-colors duration-300">Semoga hari ini penuh berkah dan kebaikan</p>
            </div>
            <div class="flex items-center space-x-4">
              <!-- DARK MODE TOGGLE -->
              <div class="relative">
                <button id="dark-mode-toggle" class="relative p-2 rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300 group" onclick="toggleDarkMode()">
                  <!-- Sun Icon (Light Mode Active) -->
                  <svg id="sun-icon" class="w-5 h-5 text-amber-500 transform transition-all duration-500 absolute inset-0 m-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                  </svg>
                  <!-- Moon Icon (Dark Mode Active) -->
                  <svg id="moon-icon" class="w-5 h-5 text-blue-300 transform transition-all duration-500 absolute inset-0 m-auto opacity-0 scale-0 rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                  </svg>
                </button>
                <!-- Tooltip -->
                <div class="absolute -bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 dark:bg-gray-700 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50">
                  <span id="theme-tooltip">Dark Mode</span>
                </div>
              </div>
              <!-- SEARCH - Hidden on mobile -->
              <div class="relative hidden md:block">
                <input type="text" placeholder="Cari driver, rute..." class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent transition-colors duration-300" onkeyup="handleSearch(this.value)">
                <svg class="w-5 h-5 text-gray-400 dark:text-gray-400 absolute left-3 top-2.5 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
              </div>
              <!-- NOTIFICATIONS -->
              <button class="relative p-2 text-gray-600 dark:text-gray-300 hover:text-luyu-green hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-300" onclick="showNotifications()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5 5-5h-5m-6 10V4H4v13h5z"/>
                </svg>
                <span class="absolute -top-1 -right-1 w-5 h-5 bg-luyu-red text-white text-xs rounded-full flex items-center justify-center pulse-slow">5</span>
              </button>
              <!-- QUICK ACTIONS - Simplified on mobile -->
              <button class="bg-gradient-to-r from-luyu-green to-luyu-blue text-white px-4 md:px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all text-sm md:text-base" onclick="showOrderModal()">
              <span class="hidden md:inline">Pesan Ojek</span>
              <span class="md:hidden">Pesan</span>
              </button>
            </div>
          </div>
        </header>
        <!-- CONTENT AREA -->
        <div id="main-content" class="p-8 h-full overflow-y-auto">
          <!-- Dynamic content will be loaded here -->
        </div>
        <!-- DRIVER DETAIL PANEL -->
        <div id="driver-panel" class="driver-panel fixed top-0 right-0 w-96 h-full bg-white shadow-2xl border-l border-gray-200 z-30">
          <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-bold text-gray-800">Detail Driver</h2>
              <button onclick="closeDriverPanel()" class="p-2 hover:bg-gray-100 rounded-lg">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
            <div id="driver-detail-content">
              <!-- Driver details will be loaded here -->
            </div>
          </div>
        </div>
      </main>
    </div>
    <!-- ========== MODALS ========== -->
    <!-- ORDER MODAL -->
    <div id="order-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Pesan Ojek Syariah</h2>
          <button onclick="closeModal('order-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Dari</label>
            <input type="text" placeholder="Lokasi penjemputan..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ke</label>
            <input type="text" placeholder="Tujuan..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent">
          </div>
        </div>
        <div class="mt-6">
          <div class="bg-luyu-green/10 border border-luyu-green/20 rounded-xl p-4">
            <div class="flex items-center justify-between mb-3">
              <span class="font-medium text-gray-800">Prioritas Driver Daerah Berkembang</span>
              <label class="switch">
              <input type="checkbox" checked>
              <span class="slider"></span>
              </label>
            </div>
            <p class="text-sm text-gray-600">Otomatis memilih driver dari Cluster C (90% untuk driver)</p>
          </div>
        </div>
        <div class="mt-6 flex space-x-4">
          <button class="flex-1 bg-gradient-to-r from-luyu-green to-luyu-blue text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="processOrder()">
          Pesan Sekarang
          </button>
          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('order-modal')">
          Batal
          </button>
        </div>
      </div>
    </div>
    <!-- TOP UP MODAL -->
    <div id="topup-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Top Up Saldo</h2>
          <button onclick="closeModal('topup-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Top Up</label>
            <input type="number" placeholder="100000" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent" id="topup-amount">
          </div>
          <div class="grid grid-cols-3 gap-3">
            <button class="py-2 px-4 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all" onclick="setTopupAmount(50000)">50K</button>
            <button class="py-2 px-4 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all" onclick="setTopupAmount(100000)">100K</button>
            <button class="py-2 px-4 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all" onclick="setTopupAmount(200000)">200K</button>
          </div>
          <div class="bg-luyu-gold/10 border border-luyu-gold/30 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="font-medium text-gray-800">Auto-Zakat (2.5%)</span>
              <label class="switch switch-gold">
              <input type="checkbox" checked id="auto-zakat">
              <span class="slider"></span>
              </label>
            </div>
            <p class="text-sm text-gray-600">Zakat akan dipotong otomatis: <span id="zakat-amount">Rp 2.500</span></p>
          </div>
        </div>
        <div class="mt-6 flex space-x-4">
          <button class="flex-1 bg-gradient-to-r from-luyu-green to-luyu-blue text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="processTopup()">
          Top Up Sekarang
          </button>
          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('topup-modal')">
          Batal
          </button>
        </div>
      </div>
    </div>
    <!-- ORDER DETAIL MODAL -->
    <div id="order-detail-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Detail Pesanan</h2>
          <button onclick="closeModal('order-detail-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div id="order-detail-content">
          <!-- Order details will be loaded here -->
        </div>
      </div>
    </div>
    <!-- ZAKAT MANUAL MODAL -->
    <div id="zakat-manual-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Bayar Zakat Manual</h2>
          <button onclick="closeModal('zakat-manual-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Zakat</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-gold focus:border-transparent" id="manual-zakat-type">
              <option value="mal">Zakat Mal (Harta)</option>
              <option value="penghasilan">Zakat Penghasilan</option>
              <option value="perdagangan">Zakat Perdagangan</option>
              <option value="emas">Zakat Emas/Perak</option>
              <option value="fitrah">Zakat Fitrah</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Zakat</label>
            <input type="number" placeholder="Masukkan jumlah zakat..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-gold focus:border-transparent" id="manual-zakat-amount">
          </div>
          <div class="bg-luyu-gold/10 border border-luyu-gold/20 rounded-lg p-4">
            <h4 class="font-semibold text-gray-800 mb-2">Mustahiq yang Akan Dibantu</h4>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <label class="flex items-center">
              <input type="checkbox" checked class="mr-2">
              <span>Fakir & Miskin</span>
              </label>
              <label class="flex items-center">
              <input type="checkbox" checked class="mr-2">
              <span>Driver Cluster C</span>
              </label>
              <label class="flex items-center">
              <input type="checkbox" class="mr-2">
              <span>Amil Zakat</span>
              </label>
              <label class="flex items-center">
              <input type="checkbox" class="mr-2">
              <span>Muallaf</span>
              </label>
            </div>
          </div>
        </div>
        <div class="mt-6 flex space-x-4">
          <button class="flex-1 bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all" onclick="processManualZakat()">
          Bayar Zakat
          </button>
          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('zakat-manual-modal')">
          Batal
          </button>
        </div>
      </div>
    </div>
    <!-- INFAQ MODAL -->
    <div id="infaq-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Kirim Infaq</h2>
          <button onclick="closeModal('infaq-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Penerima Infaq</label>
            <div class="p-4 bg-gray-50 rounded-lg" id="infaq-recipient">
              <!-- Dynamic content -->
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Infaq</label>
            <input type="number" placeholder="Masukkan jumlah infaq..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent" id="infaq-amount">
          </div>
          <div class="grid grid-cols-4 gap-3">
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all text-sm" onclick="setInfaqAmount(5000)">5K</button>
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all text-sm" onclick="setInfaqAmount(10000)">10K</button>
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all text-sm" onclick="setInfaqAmount(25000)">25K</button>
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all text-sm" onclick="setInfaqAmount(50000)">50K</button>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Pesan (Opsional)</label>
            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent" rows="3" placeholder="Tulis pesan untuk driver..." id="infaq-message"></textarea>
          </div>
        </div>
        <div class="mt-6 flex space-x-4">
          <button class="flex-1 bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="processInfaq()">
          Kirim Infaq
          </button>
          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('infaq-modal')">
          Batal
          </button>
        </div>
      </div>
    </div>
    <!-- WAKAF TUNAI MODAL -->
    <div id="wakaf-tunai-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Wakaf Tunai</h2>
          <button onclick="closeModal('wakaf-tunai-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Wakaf Tunai</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-purple focus:border-transparent" id="wakaf-type">
              <option value="umum">Wakaf Tunai Umum</option>
              <option value="masjid">Wakaf Pembangunan Masjid</option>
              <option value="pendidikan">Wakaf Pendidikan</option>
              <option value="sosial">Wakaf Sosial</option>
              <option value="kesehatan">Wakaf Kesehatan</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Wakaf</label>
            <input type="number" placeholder="Masukkan jumlah wakaf..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-purple focus:border-transparent" id="wakaf-amount">
          </div>
          <div class="grid grid-cols-4 gap-3">
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setWakafAmount(50000)">50K</button>
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setWakafAmount(100000)">100K</button>
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setWakafAmount(250000)">250K</button>
            <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setWakafAmount(500000)">500K</button>
          </div>
          <div class="bg-luyu-purple/10 border border-luyu-purple/20 rounded-lg p-4">
            <div class="flex items-center justify-between mb-3">
              <span class="font-medium text-gray-800">Wakaf Berkala (Bulanan)</span>
              <label class="switch switch-purple">
              <input type="checkbox" id="wakaf-recurring">
              <span class="slider"></span>
              </label>
            </div>
            <p class="text-sm text-gray-600">Aktifkan untuk wakaf otomatis setiap bulan</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Niat Wakaf (Opsional)</label>
            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-purple focus:border-transparent" rows="3" placeholder="Tulis niat wakaf Anda..." id="wakaf-intention"></textarea>
          </div>
        </div>
        <div class="mt-6 flex space-x-4">
          <button class="flex-1 bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all" onclick="processWakafTunai()">
          Bayar Wakaf
          </button>
          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('wakaf-tunai-modal')">
          Batal
          </button>
        </div>
      </div>
    </div>
    <!-- WAKAF PROGRAM MODAL -->
    <div id="wakaf-program-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Kontribusi Wakaf Program</h2>
          <button onclick="closeModal('wakaf-program-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div id="wakaf-program-content">
          <!-- Dynamic content will be loaded here -->
        </div>
      </div>
    </div>
    <!-- WAKAF DETAIL MODAL -->
    <div id="wakaf-detail-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-3xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Detail Program Wakaf</h2>
          <button onclick="closeModal('wakaf-detail-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div id="wakaf-detail-content">
          <!-- Dynamic content will be loaded here -->
        </div>
      </div>
    </div>
    <!-- LIVE KAJIAN MODAL -->
    <div id="live-kajian-modal" class="modal fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
      <div class="bg-white rounded-2xl w-full max-w-6xl max-h-[95vh] flex flex-col animate-slide-up overflow-hidden">
        <!-- HEADER -->
        <div class="flex items-center justify-between p-4 lg:p-6 border-b border-gray-200 bg-white">
          <div class="flex items-center">
            <div class="w-3 h-3 lg:w-4 lg:h-4 bg-red-500 rounded-full mr-2 lg:mr-3 animate-pulse"></div>
            <h2 class="text-lg lg:text-2xl font-bold text-gray-800">Live Kajian</h2>
            <span class="ml-2 lg:ml-3 bg-red-100 text-red-800 px-2 lg:px-3 py-1 rounded-full text-xs lg:text-sm font-semibold">LIVE</span>
          </div>
          <button onclick="closeModal('live-kajian-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <!-- MAIN CONTENT -->
        <div class="flex flex-1 overflow-hidden">
          <!-- VIDEO AREA -->
          <div class="flex-1 bg-gray-900 flex items-center justify-center relative min-h-0 live-video-area">
            <div class="text-center text-white p-4 z-10">
              <div class="w-16 h-16 lg:w-24 lg:h-24 bg-white/15 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-white/20">
                <svg class="w-8 h-8 lg:w-12 lg:h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <h3 class="text-lg lg:text-xl xl:text-2xl font-bold mb-2 drop-shadow-lg" id="live-kajian-title">Tafsir Surat Al-Baqarah</h3>
              <p class="text-white/90 text-sm lg:text-base drop-shadow-md" id="live-kajian-ustadz">Ustadz Ahmad Syakir</p>
              <div class="mt-4 flex items-center justify-center space-x-4 text-xs lg:text-sm">
                <div class="bg-black/30 backdrop-blur-sm rounded-full px-3 py-1">
                  <span id="live-participants">450 peserta</span>
                </div>
                <div class="bg-black/30 backdrop-blur-sm rounded-full px-3 py-1">
                  <span id="live-duration">45:32</span>
                </div>
              </div>
            </div>
            <!-- VIDEO CONTROLS (Mobile) -->
            <div class="absolute bottom-4 left-4 right-4 lg:hidden">
              <div class="bg-black/60 backdrop-blur-sm rounded-xl p-3 flex items-center justify-between border border-white/10">
                <div class="flex items-center space-x-3 text-white text-sm">
                  <span id="mobile-participants">450</span>
                  <span>•</span>
                  <span id="mobile-duration">45:32</span>
                </div>
                <button class="bg-luyu-green/90 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-green transition-all" onclick="toggleMobileChat()">
                Chat
                </button>
              </div>
            </div>
          </div>
          <!-- CHAT AREA (Desktop) -->
          <div class="hidden lg:flex lg:w-72 xl:w-80 border-l border-gray-200 flex-col bg-white">
            <div class="p-3 xl:p-4 border-b border-gray-200 bg-gray-50">
              <div class="flex items-center justify-between">
                <h4 class="font-semibold text-gray-800 text-sm xl:text-base">Chat Diskusi</h4>
                <span class="text-xs text-gray-500 bg-gray-200 px-2 py-1 rounded-full" id="chat-count">3 pesan</span>
              </div>
            </div>
            <div class="flex-1 p-3 xl:p-4 overflow-y-auto min-h-0" id="chat-messages">
              <div class="space-y-3">
                <div class="chat-message">
                  <div class="text-xs text-gray-500 mb-1 font-medium">Ahmad_123</div>
                  <div class="bg-gray-100 rounded-lg p-2.5 text-sm text-gray-700 break-words">
                    Barakallahu fiikum ustadz atas penjelasan yang sangat bermanfaat
                  </div>
                </div>
                <div class="chat-message">
                  <div class="text-xs text-gray-500 mb-1 font-medium">Siti_Muslimah</div>
                  <div class="bg-gray-100 rounded-lg p-2.5 text-sm text-gray-700 break-words">
                    Subhanallah, penjelasan yang sangat jelas dan mudah dipahami
                  </div>
                </div>
                <div class="chat-message">
                  <div class="text-xs text-gray-500 mb-1 font-medium">AbdulRahman</div>
                  <div class="bg-gray-100 rounded-lg p-2.5 text-sm text-gray-700 break-words">
                    Ustadz, bagaimana dengan ayat selanjutnya? Apakah ada hubungannya dengan ayat sebelumnya?
                  </div>
                </div>
              </div>
            </div>
            <div class="p-3 xl:p-4 border-t border-gray-200 bg-white">
              <div class="flex space-x-2">
                <input type="text" placeholder="Tulis pesan..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent text-sm" id="chat-input" maxlength="500">
                <button class="bg-luyu-green text-white px-3 xl:px-4 py-2 rounded-lg hover:bg-luyu-green/90 transition-all flex-shrink-0" onclick="sendChatMessage()">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                  </svg>
                </button>
              </div>
              <div class="text-xs text-gray-500 mt-1" id="char-count">0/500</div>
            </div>
          </div>
        </div>
        <!-- FOOTER ACTIONS -->
        <div class="p-4 lg:p-6 border-t border-gray-200 bg-gray-50">
          <div class="flex flex-col lg:flex-row items-center justify-between space-y-3 lg:space-y-0">
            <div class="flex items-center space-x-2 lg:space-x-4 w-full lg:w-auto">
              <button class="flex-1 lg:flex-none bg-luyu-green text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-luyu-green/90 transition-all text-sm" onclick="toggleBookmark()">
                <svg class="w-4 h-4 mr-1 lg:mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                </svg>
                <span class="hidden lg:inline">Bookmark</span>
                <span class="lg:hidden">Save</span>
              </button>
              <button class="flex-1 lg:flex-none bg-luyu-blue text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-luyu-blue/90 transition-all text-sm" onclick="shareKajian()">
                <svg class="w-4 h-4 mr-1 lg:mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                </svg>
                <span class="hidden lg:inline">Bagikan</span>
                <span class="lg:hidden">Share</span>
              </button>
            </div>
            <button class="w-full lg:w-auto bg-red-600 text-white px-4 lg:px-6 py-2 rounded-lg hover:bg-red-700 transition-all text-sm" onclick="closeModal('live-kajian-modal')">
            Keluar dari Kajian
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- MOBILE CHAT OVERLAY -->
    <div id="mobile-chat-overlay" class="fixed inset-0 bg-black/40 z-60 hidden lg:hidden">
      <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[70vh] flex flex-col shadow-2xl">
        <div class="p-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-2xl">
          <h4 class="font-semibold text-gray-800">Chat Diskusi</h4>
          <button onclick="closeMobileChat()" class="p-2 hover:bg-gray-200 rounded-lg transition-all">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="flex-1 p-4 overflow-y-auto min-h-0" id="mobile-chat-messages">
          <!-- Messages will be populated by JavaScript -->
        </div>
        <div class="p-4 border-t border-gray-200 bg-white">
          <div class="flex space-x-2">
            <input type="text" placeholder="Tulis pesan..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent text-sm" id="mobile-chat-input" maxlength="500">
            <button class="bg-luyu-green text-white px-4 py-2 rounded-lg hover:bg-luyu-green/90 transition-all flex-shrink-0" onclick="sendMobileChatMessage()">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- KAJIAN DETAIL MODAL -->
    <div id="kajian-detail-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Detail Kajian</h2>
          <button onclick="closeModal('kajian-detail-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div id="kajian-detail-content">
          <!-- Dynamic content will be loaded here -->
        </div>
      </div>
    </div>
    <!-- VIDEO PLAYER MODAL -->
    <div id="video-player-modal" class="modal fixed inset-0 bg-black bg-opacity-90 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl max-w-5xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between p-4 border-b border-gray-200">
          <h2 class="text-xl font-bold text-gray-800" id="video-title">Video Kajian</h2>
          <button onclick="closeModal('video-player-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="aspect-video bg-gray-900 flex items-center justify-center">
          <div class="text-center text-white">
            <div class="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="text-xl font-bold mb-2" id="playing-title">Loading...</h3>
            <p class="text-white/80" id="playing-ustadz">Please wait...</p>
          </div>
        </div>
        <div class="p-4 bg-gray-50 border-t border-gray-200">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <button class="bg-luyu-green text-white px-4 py-2 rounded-lg hover:bg-luyu-green/90 transition-all">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                Like
              </button>
              <button class="bg-luyu-blue text-white px-4 py-2 rounded-lg hover:bg-luyu-blue/90 transition-all">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                </svg>
                Simpan
              </button>
              <button class="bg-luyu-purple text-white px-4 py-2 rounded-lg hover:bg-luyu-purple/90 transition-all">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                </svg>
                Bagikan
              </button>
            </div>
            <div class="text-sm text-gray-600" id="video-views">
              <!-- View count will be shown here -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- PROFILE SETTINGS MODAL -->
    <div id="profile-settings-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Edit Profil</h2>
          <button onclick="closeModal('profile-settings-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <!-- Profile Photo -->
          <div class="text-center mb-6">
            <div class="w-24 h-24 bg-luyu-blue/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-12 h-12 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
            </div>
            <button class="bg-luyu-blue text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-blue/90 transition-all">
            Ganti Foto
            </button>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
            <input type="text" value="Ahmad Santoso" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="profile-name">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
            <input type="email" value="ahmad.santoso@email.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="profile-email">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Telefon</label>
            <input type="tel" value="+62 812-3456-7890" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="profile-phone">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Lahir</label>
            <input type="date" value="1990-05-15" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="profile-birthdate">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Alamat</label>
            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" rows="3" id="profile-address">Jl. Sudirman No. 123, Jakarta Pusat, DKI Jakarta</textarea>
          </div>
        </div>
        <div class="mt-6 flex space-x-4">
          <button class="flex-1 bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:bg-luyu-blue/90 transition-all" onclick="saveProfileSettings()">
          Simpan Perubahan
          </button>
          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('profile-settings-modal')">
          Batal
          </button>
        </div>
      </div>
    </div>
    <!-- SECURITY SETTINGS MODAL -->
    <div id="security-settings-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Keamanan & Privacy</h2>
          <button onclick="closeModal('security-settings-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-6">
          <!-- Password Settings -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengaturan Password</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password Lama</label>
                <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-red focus:border-transparent" id="current-password">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password Baru</label>
                <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-red focus:border-transparent" id="new-password">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password Baru</label>
                <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-red focus:border-transparent" id="confirm-password">
              </div>
              <button class="bg-luyu-red text-white px-6 py-2 rounded-lg font-semibold hover:bg-luyu-red/90 transition-all" onclick="changePassword()">
              Ubah Password
              </button>
            </div>
          </div>
          <!-- Two Factor Authentication -->
          <div class="border-t pt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Two-Factor Authentication</h3>
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg mb-4">
              <div>
                <h4 class="font-medium text-gray-800">SMS Authentication</h4>
                <p class="text-sm text-gray-600">Kirim kode verifikasi via SMS</p>
              </div>
              <label class="switch switch-red">
              <input type="checkbox" id="sms-2fa">
              <span class="slider"></span>
              </label>
            </div>
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg mb-4">
              <div>
                <h4 class="font-medium text-gray-800">Email Authentication</h4>
                <p class="text-sm text-gray-600">Kirim kode verifikasi via email</p>
              </div>
              <label class="switch switch-blue">
              <input type="checkbox" checked id="email-2fa">
              <span class="slider"></span>
              </label>
            </div>
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
              <div>
                <h4 class="font-medium text-gray-800">Authenticator App</h4>
                <p class="text-sm text-gray-600">Google Authenticator atau Authy</p>
              </div>
              <button class="bg-luyu-blue text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-blue/90 transition-all">
              Setup
              </button>
            </div>
          </div>
          <!-- Privacy Settings -->
          <div class="border-t pt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengaturan Privacy</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <h4 class="font-medium text-gray-800">Profil Publik</h4>
                  <p class="text-sm text-gray-600">Tampilkan profil di pencarian</p>
                </div>
                <label class="switch">
                <input type="checkbox" id="public-profile">
                <span class="slider"></span>
                </label>
              </div>
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <h4 class="font-medium text-gray-800">Tracking Lokasi</h4>
                  <p class="text-sm text-gray-600">Izinkan aplikasi melacak lokasi</p>
                </div>
                <label class="switch switch-green">
                <input type="checkbox" checked id="location-tracking">
                <span class="slider"></span>
                </label>
              </div>
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <h4 class="font-medium text-gray-800">Data Analytics</h4>
                  <p class="text-sm text-gray-600">Bantu tingkatkan layanan</p>
                </div>
                <label class="switch switch-purple">
                <input type="checkbox" checked id="analytics-data">
                <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- PAYMENT SETTINGS MODAL -->
    <div id="payment-settings-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Metode Pembayaran</h2>
          <button onclick="closeModal('payment-settings-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-6">
          <!-- Credit/Debit Cards -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Kartu Kredit/Debit</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                <div class="flex items-center">
                  <div class="w-12 h-8 bg-blue-600 rounded mr-3 flex items-center justify-center text-white text-xs font-bold">
                    VISA
                  </div>
                  <div>
                    <p class="font-semibold">**** **** **** 4567</p>
                    <p class="text-sm text-gray-500">Expires 12/27</p>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button class="text-luyu-blue text-sm hover:underline">Edit</button>
                  <button class="text-red-600 text-sm hover:underline">Hapus</button>
                </div>
              </div>
              <button class="w-full border-2 border-dashed border-gray-300 rounded-lg py-4 text-gray-600 hover:border-luyu-green hover:text-luyu-green transition-all" onclick="addPaymentMethod('card')">
              + Tambah Kartu Baru
              </button>
            </div>
          </div>
          <!-- E-Wallets -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">E-Wallet</h3>
            <div class="grid grid-cols-2 gap-4">
              <div class="p-4 border border-gray-200 rounded-lg text-center">
                <div class="w-12 h-12 bg-blue-500 rounded-lg mx-auto mb-2 flex items-center justify-center text-white font-bold">
                  OVO
                </div>
                <p class="font-semibold text-sm">OVO</p>
                <p class="text-xs text-green-600">Terhubung</p>
              </div>
              <div class="p-4 border border-gray-200 rounded-lg text-center">
                <div class="w-12 h-12 bg-green-500 rounded-lg mx-auto mb-2 flex items-center justify-center text-white font-bold">
                  DANA
                </div>
                <p class="font-semibold text-sm">DANA</p>
                <p class="text-xs text-green-600">Terhubung</p>
              </div>
              <div class="p-4 border border-gray-200 rounded-lg text-center">
                <div class="w-12 h-12 bg-red-500 rounded-lg mx-auto mb-2 flex items-center justify-center text-white font-bold">
                  LP
                </div>
                <p class="font-semibold text-sm">LinkAja</p>
                <button class="text-xs text-luyu-blue hover:underline">Hubungkan</button>
              </div>
              <div class="p-4 border border-gray-200 rounded-lg text-center">
                <div class="w-12 h-12 bg-purple-500 rounded-lg mx-auto mb-2 flex items-center justify-center text-white font-bold">
                  GP
                </div>
                <p class="font-semibold text-sm">GoPay</p>
                <button class="text-xs text-luyu-blue hover:underline">Hubungkan</button>
              </div>
            </div>
          </div>
          <!-- Auto Payment -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Pembayaran Otomatis</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <h4 class="font-medium text-gray-800">Auto-Debit Zakat</h4>
                  <p class="text-sm text-gray-600">Potong otomatis dari e-wallet</p>
                </div>
                <label class="switch switch-gold">
                <input type="checkbox" checked id="auto-zakat-payment">
                <span class="slider"></span>
                </label>
              </div>
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <h4 class="font-medium text-gray-800">Auto-Topup</h4>
                  <p class="text-sm text-gray-600">Isi ulang otomatis saat saldo rendah</p>
                </div>
                <label class="switch">
                <input type="checkbox" id="auto-topup">
                <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ISLAMIC SETTINGS MODAL -->
    <div id="islamic-settings-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-800">Pengaturan Syariah</h2>
      <button onclick="closeModal('islamic-settings-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="space-y-6">
    <!-- Prayer Settings -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengaturan Sholat</h3>
      <div class="space-y-4">
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
          <div>
            <h4 class="font-medium text-gray-800">Notifikasi Adzan</h4>
            <p class="text-sm text-gray-600">Pengingat waktu sholat</p>
          </div>
          <label class="switch switch-green">
          <input type="checkbox" checked id="adzan-notification">
          <span class="slider"></span>
          </label>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Metode Perhitungan</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-gold focus:border-transparent" id="calculation-method">
              <option value="kemenag">Kementerian Agama RI</option>
              <option value="mwl">Muslim World League</option>
              <option value="isna">Islamic Society of North America</option>
              <option value="egypt">Egyptian General Authority</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Madhab</label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-gold focus:border-transparent" id="madhab">
              <option value="shafi">Shafi'i</option>
              <option value="hanafi">Hanafi</option>
              <option value="maliki">Maliki</option>
              <option value="hanbali">Hanbali</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <!-- Qibla Direction -->
    <div>
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Arah Kiblat</h3>
    <div class="p-4 bg-luyu-gold/10 border border-luyu-gold/20 rounded-lg">
      <div class="flex items-center justify-between mb-3">
        <span class="font-medium">Auto-detect Kiblat</span>
        <label class="switch switch-gold">
        <input type="checkbox" checked id="auto-qibla">
        <span class="slider"></span>
        </label>
      </div>
      <div class="text-center">
        <div class="w-24 h-24 border-4 border-luyu-gold rounded-full mx-auto mb-2 flex items-center justify-center">
          <div class="w-1 h-8 bg-luyu-gold transform rotate-12"></div>
        </div>
        <p class="text-sm font-semibold">294° dari Utara</p>
        <p class="text-xs text-gray-600">Jarak: 8,023 km ke Makkah</p>
      </div>
    </div>
    <!-- PAGE TEMPLATES -->
    <template id="dashboard-template">
      <div class="animate-fade-in">
        <!-- QUICK STATS -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-luyu-green/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Total Trip</p>
                <p class="text-2xl font-bold text-gray-900" id="trip-count">127</p>
                <p class="text-xs text-luyu-green">+12 bulan ini</p>
              </div>
            </div>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-luyu-gold/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                </svg>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Zakat Terkumpul</p>
                <p class="text-2xl font-bold text-gray-900">Rp 4.8M</p>
                <p class="text-xs text-luyu-gold">+25% dari target</p>
              </div>
            </div>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-luyu-red/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-luyu-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Driver Aktif</p>
                <p class="text-2xl font-bold text-gray-900" id="driver-count">1,247</p>
                <p class="text-xs text-luyu-red">89% Cluster C</p>
              </div>
            </div>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-luyu-blue/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Pahala Points</p>
                <p class="text-2xl font-bold text-gray-900" id="pahala-count">2,340</p>
                <p class="text-xs text-luyu-blue">Level 2 progress</p>
              </div>
            </div>
          </div>
        </div>
        <!-- QUICK ORDER SECTION -->
        <div class="bg-gradient-to-r from-luyu-green to-luyu-blue rounded-2xl p-8 text-white mb-8">
          <div class="grid grid-cols-2 gap-8 items-center">
            <div>
              <h2 class="text-2xl font-bold mb-4">Pesan Ojek Syariah</h2>
              <p class="text-white/90 mb-6">Dukung driver di wilayah berkembang dengan prioritas syariah</p>
              <div class="bg-white/20 p-4 rounded-xl mb-6 backdrop-blur-sm">
                <div class="flex items-center justify-between mb-3">
                  <span class="text-sm font-medium">Prioritas Driver Daerah Berkembang</span>
                  <label class="switch switch-gold">
                  <input type="checkbox" checked>
                  <span class="slider"></span>
                  </label>
                </div>
                <p class="text-xs text-white/80">Otomatis memilih driver dari Cluster C (Banten, Lampung)</p>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <button class="bg-white text-luyu-green font-semibold py-3 px-6 rounded-xl hover:shadow-lg transition-all" onclick="showOrderModal()">
                  <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Pesan Ojek
                </button>
                <button class="bg-white/20 text-white font-semibold py-3 px-6 rounded-xl hover:bg-white/30 transition-all">
                  <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                  </svg>
                  Berbagi Berkah
                </button>
              </div>
            </div>
            <div class="text-center">
              <div class="bg-white/10 p-6 rounded-2xl backdrop-blur-sm">
                <h3 class="text-lg font-semibold mb-2">Impact Hari Ini</h3>
                <div class="text-3xl font-bold mb-1" id="impact-count">23</div>
                <p class="text-sm text-white/80">Driver dibantu</p>
                <div class="mt-4 pt-4 border-t border-white/20">
                  <p class="text-xs">Sedekah terkumpul</p>
                  <p class="text-xl font-bold" id="sedekah-count">Rp 127.500</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- DRIVER TERDEKAT -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-8">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-800">Driver Terdekat</h3>
            <button class="text-luyu-green font-semibold text-sm hover:underline" onclick="showPage('maps')">
            Lihat di Peta
            </button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="driver-card border border-gray-200 rounded-xl p-4 hover:border-luyu-green/30 hover:shadow-md transition-all cursor-pointer" onclick="showDriverDetail('siti')">
              <div class="flex items-center mb-3">
                <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <div class="ml-3 flex-1">
                  <div class="flex items-center justify-between">
                    <h4 class="font-semibold text-gray-800">Ustadzah Siti</h4>
                    <span class="text-xs bg-luyu-green text-white px-2 py-1 rounded-full">1.2 km</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-600 mt-1">
                    <span>Honda Beat • ⭐ 4.9</span>
                    <span class="ml-2 bg-luyu-red text-white px-1 py-0.5 rounded text-xs">C</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-gray-500">
                <span class="bg-luyu-green/10 text-luyu-green px-2 py-1 rounded-full">Online • Prioritas Syariah</span>
              </div>
            </div>
            <div class="driver-card border border-gray-200 rounded-xl p-4 hover:border-luyu-green/30 hover:shadow-md transition-all cursor-pointer" onclick="showDriverDetail('ahmad')">
              <div class="flex items-center mb-3">
                <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <div class="ml-3 flex-1">
                  <div class="flex items-center justify-between">
                    <h4 class="font-semibold text-gray-800">Pak Ahmad</h4>
                    <span class="text-xs bg-luyu-green text-white px-2 py-1 rounded-full">1.8 km</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-600 mt-1">
                    <span>Yamaha Mio • ⭐ 4.8</span>
                    <span class="ml-2 bg-luyu-red text-white px-1 py-0.5 rounded text-xs">C</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-gray-500">
                <span class="bg-luyu-green/10 text-luyu-green px-2 py-1 rounded-full">Online • Prioritas Syariah</span>
              </div>
            </div>
            <div class="driver-card border border-gray-200 rounded-xl p-4 hover:border-luyu-blue/30 hover:shadow-md transition-all cursor-pointer" onclick="showDriverDetail('budi')">
              <div class="flex items-center mb-3">
                <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <div class="ml-3 flex-1">
                  <div class="flex items-center justify-between">
                    <h4 class="font-semibold text-gray-800">Budi</h4>
                    <span class="text-xs bg-luyu-blue text-white px-2 py-1 rounded-full">2.1 km</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-600 mt-1">
                    <span>Honda Vario • ⭐ 4.7</span>
                    <span class="ml-2 bg-luyu-blue text-white px-1 py-0.5 rounded text-xs">A</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-gray-500">
                <span class="bg-luyu-blue/10 text-luyu-blue px-2 py-1 rounded-full">Online • Standar</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="analytics-template">
      <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN CHARTS -->
          <div class="col-span-8 space-y-6">
            <!-- OVERVIEW METRICS -->
            <div class="grid grid-cols-4 gap-4 mb-6">
              <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">Total Revenue</p>
                    <p class="text-2xl font-bold text-luyu-green">Rp 15.2M</p>
                    <p class="text-xs text-green-600">↑ +12.5%</p>
                  </div>
                  <div class="w-10 h-10 bg-luyu-green/10 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">Zakat Collected</p>
                    <p class="text-2xl font-bold text-luyu-gold">Rp 4.8M</p>
                    <p class="text-xs text-yellow-600">↑ +8.2%</p>
                  </div>
                  <div class="w-10 h-10 bg-luyu-gold/10 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">Active Users</p>
                    <p class="text-2xl font-bold text-luyu-blue">8,247</p>
                    <p class="text-xs text-blue-600">↑ +5.7%</p>
                  </div>
                  <div class="w-10 h-10 bg-luyu-blue/10 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">Driver Satisfaction</p>
                    <p class="text-2xl font-bold text-luyu-purple">4.87</p>
                    <p class="text-xs text-purple-600">↑ +0.3</p>
                  </div>
                  <div class="w-10 h-10 bg-luyu-purple/10 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
            <!-- REVENUE CHART -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Trend Revenue & Zakat</h3>
                <div class="flex space-x-2">
                  <button class="px-4 py-2 bg-luyu-green text-white rounded-lg text-sm font-semibold">7 Hari</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">30 Hari</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">1 Tahun</button>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="revenue-chart"></canvas>
              </div>
            </div>
            <!-- CLUSTER PERFORMANCE -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Performa Cluster Wilayah</h3>
              <div class="grid grid-cols-3 gap-6">
                <div class="text-center">
                  <div class="chart-container h-32 mb-4">
                    <canvas id="cluster-a-chart"></canvas>
                  </div>
                  <h4 class="font-semibold text-gray-800">Cluster A</h4>
                  <p class="text-sm text-gray-600">342 Driver • Jakarta</p>
                  <div class="mt-2">
                    <div class="progress-bar">
                      <div class="progress-fill bg-luyu-blue" style="width: 85%"></div>
                    </div>
                    <p class="text-xs mt-1 text-gray-500">Target Achievement: 85%</p>
                  </div>
                </div>
                <div class="text-center">
                  <div class="chart-container h-32 mb-4">
                    <canvas id="cluster-b-chart"></canvas>
                  </div>
                  <h4 class="font-semibold text-gray-800">Cluster B</h4>
                  <p class="text-sm text-gray-600">198 Driver • Bandung</p>
                  <div class="mt-2">
                    <div class="progress-bar">
                      <div class="progress-fill bg-orange-500" style="width: 72%"></div>
                    </div>
                    <p class="text-xs mt-1 text-gray-500">Target Achievement: 72%</p>
                  </div>
                </div>
                <div class="text-center">
                  <div class="chart-container h-32 mb-4">
                    <canvas id="cluster-c-chart"></canvas>
                  </div>
                  <h4 class="font-semibold text-gray-800">Cluster C</h4>
                  <p class="text-sm text-gray-600">707 Driver • Banten</p>
                  <div class="mt-2">
                    <div class="progress-bar">
                      <div class="progress-fill bg-luyu-green" style="width: 95%"></div>
                    </div>
                    <p class="text-xs mt-1 text-gray-500">Target Achievement: 95%</p>
                  </div>
                </div>
              </div>
            </div>
            <!-- IMPACT METRICS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Impact Sosial</h3>
              <div class="grid grid-cols-2 gap-6">
                <div class="chart-container">
                  <canvas id="impact-chart"></canvas>
                </div>
                <div class="space-y-4">
                  <div class="p-4 bg-luyu-green/10 rounded-lg">
                    <h4 class="font-semibold text-luyu-green">Driver Terbantu</h4>
                    <p class="text-2xl font-bold text-gray-800">1,247</p>
                    <p class="text-sm text-gray-600">Cluster C mendapat prioritas</p>
                  </div>
                  <div class="p-4 bg-luyu-gold/10 rounded-lg">
                    <h4 class="font-semibold text-luyu-gold">Zakat Disalurkan</h4>
                    <p class="text-2xl font-bold text-gray-800">Rp 4.8M</p>
                    <p class="text-sm text-gray-600">Untuk 2,847 mustahiq</p>
                  </div>
                  <div class="p-4 bg-luyu-purple/10 rounded-lg">
                    <h4 class="font-semibold text-luyu-purple">Wakaf Terkumpul</h4>
                    <p class="text-2xl font-bold text-gray-800">Rp 1.2M</p>
                    <p class="text-sm text-gray-600">Untuk masjid & sekolah</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR METRICS -->
          <div class="col-span-4 space-y-6">
            <!-- REALTIME STATS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Real-time Stats</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Orders Today</span>
                  <span class="font-bold text-luyu-green" id="orders-today">1,847</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Active Drivers</span>
                  <span class="font-bold text-luyu-blue" id="active-drivers">1,247</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Avg Response Time</span>
                  <span class="font-bold text-luyu-purple">2.3 min</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Customer Satisfaction</span>
                  <span class="font-bold text-luyu-gold">4.9/5</span>
                </div>
              </div>
            </div>
            <!-- TOP PERFORMERS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Top Performing Drivers</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-green rounded-full flex items-center justify-center text-white font-bold text-sm">1</div>
                    <div class="ml-3">
                      <p class="font-semibold text-sm">Ustadzah Siti</p>
                      <p class="text-xs text-gray-500">Cluster C • 47 trips</p>
                    </div>
                  </div>
                  <span class="text-luyu-green font-bold">⭐ 4.9</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-blue rounded-full flex items-center justify-center text-white font-bold text-sm">2</div>
                    <div class="ml-3">
                      <p class="font-semibold text-sm">Pak Ahmad</p>
                      <p class="text-xs text-gray-500">Cluster C • 52 trips</p>
                    </div>
                  </div>
                  <span class="text-luyu-blue font-bold">⭐ 4.8</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-gold rounded-full flex items-center justify-center text-white font-bold text-sm">3</div>
                    <div class="ml-3">
                      <p class="font-semibold text-sm">Bu Fatimah</p>
                      <p class="text-xs text-gray-500">Cluster B • 38 trips</p>
                    </div>
                  </div>
                  <span class="text-luyu-gold font-bold">⭐ 4.8</span>
                </div>
              </div>
            </div>
            <!-- RECENT TRANSACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Transaksi Terbaru</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-2 h-2 bg-luyu-green rounded-full mr-3"></div>
                    <div>
                      <p class="text-sm font-medium">Trip Completed</p>
                      <p class="text-xs text-gray-500">15:30 • Cluster C</p>
                    </div>
                  </div>
                  <span class="font-semibold text-luyu-green">+Rp 15.000</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-2 h-2 bg-luyu-gold rounded-full mr-3"></div>
                    <div>
                      <p class="text-sm font-medium">Auto Zakat</p>
                      <p class="text-xs text-gray-500">15:28 • Ahmad S.</p>
                    </div>
                  </div>
                  <span class="font-semibold text-luyu-gold">-Rp 375</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-2 h-2 bg-luyu-blue rounded-full mr-3"></div>
                    <div>
                      <p class="text-sm font-medium">Top Up Saldo</p>
                      <p class="text-xs text-gray-500">14:45 • Bu Siti</p>
                    </div>
                  </div>
                  <span class="font-semibold text-luyu-blue">+Rp 100.000</span>
                </div>
              </div>
            </div>
            <!-- EXPORT OPTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Export Reports</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all">
                Download Revenue Report
                </button>
                <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all">
                Download Zakat Report
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                Custom Report Builder
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="orders-template">
      <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN ORDER LIST -->
          <div class="col-span-8 space-y-6">
            <!-- ORDER FILTERS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">Filter Pesanan</h3>
                <button class="bg-luyu-green text-white px-4 py-2 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showOrderModal()">
                + Buat Pesanan Baru
                </button>
              </div>
              <div class="grid grid-cols-4 gap-4">
                <select class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterOrders('status', this.value)">
                  <option value="">Semua Status</option>
                  <option value="pending">Menunggu</option>
                  <option value="confirmed">Dikonfirmasi</option>
                  <option value="pickup">Penjemputan</option>
                  <option value="ongoing">Dalam Perjalanan</option>
                  <option value="completed">Selesai</option>
                  <option value="cancelled">Dibatalkan</option>
                </select>
                <select class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterOrders('cluster', this.value)">
                  <option value="">Semua Cluster</option>
                  <option value="A">Cluster A</option>
                  <option value="B">Cluster B</option>
                  <option value="C">Cluster C</option>
                </select>
                <input type="date" class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterOrders('date', this.value)">
                <input type="text" placeholder="Cari driver atau tujuan..." class="border border-gray-300 rounded-lg px-3 py-2" onkeyup="searchOrders(this.value)">
              </div>
            </div>
            <!-- ORDER LIST -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
              <div class="p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-gray-800">Daftar Pesanan</h3>
              </div>
              <div class="divide-y divide-gray-100" id="orders-list">
                <!-- ORDER ITEM 1 -->
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD001')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="flex items-center space-x-2 mb-1">
                          <h4 class="font-semibold text-gray-800">#ORD001</h4>
                          <span class="status-ongoing px-2 py-1 rounded-full text-xs font-semibold">Dalam Perjalanan</span>
                          <span class="bg-luyu-green text-white px-2 py-1 rounded-full text-xs font-bold">C</span>
                        </div>
                        <p class="text-sm text-gray-600">Jl. Sudirman → Masjid Al-Barokah</p>
                        <p class="text-xs text-gray-500">Driver: Ustadzah Siti • Honda Beat</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-bold text-gray-800">Rp 15.000</p>
                      <p class="text-xs text-gray-500">30 Mei 2025, 14:30</p>
                      <div class="mt-2">
                        <div class="progress-bar w-32">
                          <div class="progress-fill bg-orange-500" style="width: 75%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">ETA: 8 menit</p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ORDER ITEM 2 -->
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD002')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="flex items-center space-x-2 mb-1">
                          <h4 class="font-semibold text-gray-800">#ORD002</h4>
                          <span class="status-completed px-2 py-1 rounded-full text-xs font-semibold">Selesai</span>
                          <span class="bg-luyu-red text-white px-2 py-1 rounded-full text-xs font-bold">C</span>
                        </div>
                        <p class="text-sm text-gray-600">Rumah → Pasar Tradisional</p>
                        <p class="text-xs text-gray-500">Driver: Pak Ahmad • Yamaha Mio</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-bold text-gray-800">Rp 12.500</p>
                      <p class="text-xs text-gray-500">30 Mei 2025, 13:15</p>
                      <div class="mt-2 flex items-center text-xs text-luyu-green">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Trip Completed
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ORDER ITEM 3 -->
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD003')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-12 h-12 bg-luyu-gold/10 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="flex items-center space-x-2 mb-1">
                          <h4 class="font-semibold text-gray-800">#ORD003</h4>
                          <span class="status-pending px-2 py-1 rounded-full text-xs font-semibold">Menunggu Driver</span>
                          <span class="bg-luyu-blue text-white px-2 py-1 rounded-full text-xs font-bold">A</span>
                        </div>
                        <p class="text-sm text-gray-600">Plaza Indonesia → Kemang</p>
                        <p class="text-xs text-gray-500">Mencari driver terdekat...</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-bold text-gray-800">Rp 25.000</p>
                      <p class="text-xs text-gray-500">30 Mei 2025, 15:45</p>
                      <div class="mt-2">
                        <div class="progress-bar w-32">
                          <div class="progress-fill bg-luyu-gold" style="width: 20%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Estimasi: 5 menit</p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ORDER ITEM 4 -->
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD004')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-12 h-12 bg-luyu-purple/10 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="flex items-center space-x-2 mb-1">
                          <h4 class="font-semibold text-gray-800">#ORD004</h4>
                          <span class="status-pickup px-2 py-1 rounded-full text-xs font-semibold">Penjemputan</span>
                          <span class="bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-bold">B</span>
                        </div>
                        <p class="text-sm text-gray-600">Bandung Station → Dago</p>
                        <p class="text-xs text-gray-500">Driver: Bu Fatimah • Honda Scoopy</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-bold text-gray-800">Rp 18.000</p>
                      <p class="text-xs text-gray-500">30 Mei 2025, 15:20</p>
                      <div class="mt-2">
                        <div class="progress-bar w-32">
                          <div class="progress-fill bg-luyu-purple" style="width: 45%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Driver menuju lokasi</p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ORDER ITEM 5 -->
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD005')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-12 h-12 bg-luyu-red/10 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                      </div>
                      <div>
                        <div class="flex items-center space-x-2 mb-1">
                          <h4 class="font-semibold text-gray-800">#ORD005</h4>
                          <span class="status-cancelled px-2 py-1 rounded-full text-xs font-semibold">Dibatalkan</span>
                          <span class="bg-luyu-green text-white px-2 py-1 rounded-full text-xs font-bold">C</span>
                        </div>
                        <p class="text-sm text-gray-600">Tangerang Mall → BSD</p>
                        <p class="text-xs text-gray-500">Dibatalkan oleh pelanggan</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-bold text-gray-400 line-through">Rp 22.000</p>
                      <p class="text-xs text-gray-500">30 Mei 2025, 12:00</p>
                      <div class="mt-2 text-xs text-luyu-red">
                        Refund: Rp 22.000
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR -->
          <div class="col-span-4 space-y-6">
            <!-- ORDER STATS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Statistik Pesanan</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Total Hari Ini</span>
                  <span class="font-bold text-luyu-green">23</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Sedang Berlangsung</span>
                  <span class="font-bold text-orange-500">3</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Selesai Hari Ini</span>
                  <span class="font-bold text-luyu-blue">18</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Dibatalkan</span>
                  <span class="font-bold text-luyu-red">2</span>
                </div>
              </div>
              <div class="mt-6 pt-6 border-t border-gray-100">
                <h4 class="font-semibold text-gray-800 mb-3">Success Rate</h4>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 91%"></div>
                </div>
                <p class="text-sm text-gray-600 mt-2">91% pesanan berhasil diselesaikan</p>
              </div>
            </div>
            <!-- ACTIVE ORDERS MAP -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Pesanan Aktif</h3>
              <div class="relative h-48 bg-gray-100 rounded-lg overflow-hidden mb-4">
                <svg viewBox="0 0 300 200" class="absolute inset-0 w-full h-full">
                  <rect width="300" height="200" fill="#f8f9fa"/>
                  <!-- Routes -->
                  <path d="M50 50 Q 150 100 250 150" stroke="#2ecc71" stroke-width="3" fill="none" stroke-dasharray="5,5" opacity="0.8"/>
                  <path d="M80 80 Q 180 120 220 160" stroke="#9b59b6" stroke-width="3" fill="none" stroke-dasharray="5,5" opacity="0.8"/>
                  <!-- Driver positions -->
                  <circle cx="150" cy="100" r="6" fill="#2ecc71" stroke="white" stroke-width="2">
                    <animate attributeName="r" values="6;8;6" dur="2s" repeatCount="indefinite"/>
                  </circle>
                  <circle cx="180" cy="120" r="6" fill="#9b59b6" stroke="white" stroke-width="2">
                    <animate attributeName="r" values="6;8;6" dur="2s" repeatCount="indefinite"/>
                  </circle>
                  <!-- Destinations -->
                  <rect x="245" y="145" width="10" height="10" fill="#e74c3c" rx="2"/>
                  <rect x="215" y="155" width="10" height="10" fill="#e74c3c" rx="2"/>
                </svg>
              </div>
              <div class="space-y-3">
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-luyu-green rounded-full mr-2"></div>
                    <span>ORD001 - Ustadzah Siti</span>
                  </div>
                  <span class="text-gray-500">8 min</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-luyu-purple rounded-full mr-2"></div>
                    <span>ORD004 - Bu Fatimah</span>
                  </div>
                  <span class="text-gray-500">3 min</span>
                </div>
              </div>
            </div>
            <!-- QUICK ACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showOrderModal()">
                Buat Pesanan Baru
                </button>
                <button class="w-full bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:bg-luyu-blue/90 transition-all" onclick="refreshOrders()">
                Refresh Data
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                Export Laporan
                </button>
              </div>
            </div>
            <!-- DRIVER AVAILABILITY -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Ketersediaan Driver</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-luyu-blue rounded-full mr-2"></div>
                    <span class="text-sm">Cluster A</span>
                  </div>
                  <div class="text-right">
                    <span class="font-bold text-luyu-blue">87</span>
                    <span class="text-xs text-gray-500 ml-1">online</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                    <span class="text-sm">Cluster B</span>
                  </div>
                  <div class="text-right">
                    <span class="font-bold text-orange-500">45</span>
                    <span class="text-xs text-gray-500 ml-1">online</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-luyu-green rounded-full mr-2"></div>
                    <span class="text-sm">Cluster C</span>
                  </div>
                  <div class="text-right">
                    <span class="font-bold text-luyu-green">134</span>
                    <span class="text-xs text-gray-500 ml-1">online</span>
                  </div>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-100">
                  <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-600">Total Online</span>
                    <span class="font-bold text-luyu-green">266 driver</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="maps-template">
      <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-6 min-h-screen pb-8">
          <!-- MAP AREA -->
          <div class="col-span-8">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 h-fit overflow-hidden">
              <div class="p-4 border-b border-gray-100">
                <div class="flex items-center justify-between">
                  <h3 class="text-lg font-bold text-gray-800">Peta Cluster Real-time</h3>
                  <div class="flex items-center space-x-4">
                    <div class="flex items-center text-sm">
                      <div class="w-3 h-3 bg-luyu-green rounded-full mr-2"></div>
                      <span>Online (1,247)</span>
                    </div>
                    <div class="flex items-center text-sm">
                      <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                      <span>Offline (423)</span>
                    </div>
                    <button class="bg-luyu-green text-white px-4 py-2 rounded-lg text-sm font-semibold" onclick="refreshMap()">
                    Refresh
                    </button>
                  </div>
                </div>
              </div>
              <div class="relative h-[600px] bg-gray-100" id="interactive-map">
                <!-- INTERACTIVE MAP -->
                <svg viewBox="0 0 1000 600" class="absolute inset-0 w-full h-full">
                  <!-- Background -->
                  <rect width="1000" height="600" fill="#f8f9fa"/>
                  <!-- Cluster Areas -->
                  <g class="cluster-zone" data-cluster="a" onclick="selectCluster('a')">
                    <rect x="100" y="80" width="250" height="180" fill="#3498db20" stroke="#3498db" stroke-width="3" rx="15" />
                    <text x="225" y="175" text-anchor="middle" class="text-lg font-bold fill-blue-600">Jakarta</text>
                    <text x="225" y="195" text-anchor="middle" class="text-sm fill-blue-500">Cluster A</text>
                  </g>
                  <g class="cluster-zone" data-cluster="b" onclick="selectCluster('b')">
                    <rect x="400" y="120" width="200" height="140" fill="#f39c1220" stroke="#f39c12" stroke-width="3" rx="15" />
                    <text x="500" y="185" text-anchor="middle" class="text-lg font-bold fill-orange-600">Bandung</text>
                    <text x="500" y="205" text-anchor="middle" class="text-sm fill-orange-500">Cluster B</text>
                  </g>
                  <g class="cluster-zone" data-cluster="c" onclick="selectCluster('c')">
                    <rect x="650" y="150" width="280" height="220" fill="#2ecc7120" stroke="#2ecc71" stroke-width="3" rx="15" />
                    <text x="790" y="260" text-anchor="middle" class="text-lg font-bold fill-green-600">Banten</text>
                    <text x="790" y="280" text-anchor="middle" class="text-sm fill-green-500">Cluster C</text>
                  </g>
                  <!-- Driver Markers -->
                  <g class="driver-markers">
                    <!-- Cluster A Drivers -->
                    <circle class="driver-marker" cx="180" cy="140" r="8" fill="#3498db" stroke="white" stroke-width="3" data-driver="driver1" onclick="showDriverDetail('driver1')" />
                    <circle class="driver-marker" cx="220" cy="160" r="8" fill="#3498db" stroke="white" stroke-width="3" data-driver="driver2" onclick="showDriverDetail('driver2')" />
                    <circle class="driver-marker" cx="280" cy="190" r="8" fill="#3498db" stroke="white" stroke-width="3" data-driver="driver3" onclick="showDriverDetail('driver3')" />
                    <!-- Cluster B Drivers -->
                    <circle class="driver-marker" cx="450" cy="170" r="8" fill="#f39c12" stroke="white" stroke-width="3" data-driver="driver4" onclick="showDriverDetail('driver4')" />
                    <circle class="driver-marker" cx="520" cy="200" r="8" fill="#f39c12" stroke="white" stroke-width="3" data-driver="driver5" onclick="showDriverDetail('driver5')" />
                    <!-- Cluster C Drivers -->
                    <circle class="driver-marker" cx="720" cy="200" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="siti" onclick="showDriverDetail('siti')" />
                    <circle class="driver-marker" cx="780" cy="240" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="ahmad" onclick="showDriverDetail('ahmad')" />
                    <circle class="driver-marker" cx="850" cy="280" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="driver8" onclick="showDriverDetail('driver8')" />
                    <circle class="driver-marker" cx="880" cy="320" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="driver9" onclick="showDriverDetail('driver9')" />
                    <!-- Moving drivers animation -->
                    <circle class="driver-marker" cx="300" cy="300" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="moving1">
                      <animateTransform attributeName="transform" type="translate" values="0,0; 50,0; 50,-50; 0,-50; 0,0" dur="10s" repeatCount="indefinite"/>
                    </circle>
                  </g>
                  <!-- Routes -->
                  <path d="M180 140 Q 400 200 720 200" stroke="#2ecc71" stroke-width="4" fill="none" stroke-dasharray="8,4" opacity="0.6"/>
                  <path d="M450 170 Q 600 180 780 240" stroke="#f39c12" stroke-width="4" fill="none" stroke-dasharray="8,4" opacity="0.6"/>
                </svg>
                <!-- MAP CONTROLS -->
                <div class="absolute top-4 left-4 bg-white rounded-lg shadow-lg p-2 space-y-1">
                  <button class="block p-2 hover:bg-gray-100 rounded text-gray-600" onclick="zoomIn()">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                  </button>
                  <button class="block p-2 hover:bg-gray-100 rounded text-gray-600" onclick="zoomOut()">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                    </svg>
                  </button>
                  <button class="block p-2 hover:bg-gray-100 rounded text-gray-600" onclick="centerMap()">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                    </svg>
                  </button>
                </div>
                <!-- CLUSTER INFO PANEL -->
                <div id="cluster-info" class="absolute bottom-4 left-4 bg-white rounded-xl shadow-lg p-4 max-w-sm hidden">
                  <div id="cluster-info-content">
                    <!-- Dynamic cluster info -->
                  </div>
                </div>
                <!-- LIVE ACTIVITY -->
                <div class="absolute bottom-4 right-4 bg-white rounded-xl shadow-lg p-4 max-w-sm">
                  <h4 class="font-semibold text-gray-800 mb-3">Aktivitas Real-time</h4>
                  <div class="space-y-2 text-sm" id="live-activity">
                    <div class="flex items-center">
                      <div class="w-2 h-2 bg-luyu-green rounded-full mr-2 animate-pulse"></div>
                      <span>Ustadzah Siti - Menuju pickup</span>
                    </div>
                    <div class="flex items-center">
                      <div class="w-2 h-2 bg-luyu-blue rounded-full mr-2 animate-pulse"></div>
                      <span>Pak Ahmad - Dalam perjalanan</span>
                    </div>
                    <div class="flex items-center">
                      <div class="w-2 h-2 bg-luyu-gold rounded-full mr-2 animate-pulse"></div>
                      <span>3 pesanan baru diterima</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR INFO -->
          <div class="col-span-4 flex flex-col space-y-6 pb-6">
            <!-- CLUSTER OVERVIEW -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Overview Cluster</h3>
              <div class="space-y-4">
                <div class="cluster-stat p-4 bg-luyu-blue/5 border-l-4 border-luyu-blue rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-semibold text-gray-800">Cluster A</h4>
                    <span class="text-luyu-blue font-bold">70:30</span>
                  </div>
                  <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                      <span class="text-gray-600">Driver Online</span>
                      <p class="font-bold text-luyu-blue">342</p>
                    </div>
                    <div>
                      <span class="text-gray-600">Avg Income</span>
                      <p class="font-bold">Rp 285K</p>
                    </div>
                  </div>
                </div>
                <div class="cluster-stat p-4 bg-orange-50 border-l-4 border-orange-500 rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-semibold text-gray-800">Cluster B</h4>
                    <span class="text-orange-500 font-bold">80:20</span>
                  </div>
                  <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                      <span class="text-gray-600">Driver Online</span>
                      <p class="font-bold text-orange-500">198</p>
                    </div>
                    <div>
                      <span class="text-gray-600">Avg Income</span>
                      <p class="font-bold">Rp 195K</p>
                    </div>
                  </div>
                </div>
                <div class="cluster-stat p-4 bg-luyu-green/5 border-l-4 border-luyu-green rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-semibold text-gray-800">Cluster C</h4>
                    <span class="text-luyu-green font-bold">90:10</span>
                  </div>
                  <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                      <span class="text-gray-600">Driver Online</span>
                      <p class="font-bold text-luyu-green">707</p>
                    </div>
                    <div>
                      <span class="text-gray-600">Avg Income</span>
                      <p class="font-bold">Rp 125K</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- FILTER & CONTROLS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Filter & Kontrol</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Tampilkan Driver</label>
                  <div class="space-y-2">
                    <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2" onchange="toggleDriverVisibility('online')">
                    <span class="text-sm">Online (1,247)</span>
                    </label>
                    <label class="flex items-center">
                    <input type="checkbox" class="mr-2" onchange="toggleDriverVisibility('offline')">
                    <span class="text-sm">Offline (423)</span>
                    </label>
                    <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2" onchange="toggleDriverVisibility('priority')">
                    <span class="text-sm">Prioritas Syariah</span>
                    </label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Cluster Focus</label>
                  <select class="w-full border border-gray-300 rounded-lg px-3 py-2" onchange="focusCluster(this.value)">
                    <option value="">Semua Cluster</option>
                    <option value="a">Cluster A - Jakarta</option>
                    <option value="b">Cluster B - Bandung</option>
                    <option value="c">Cluster C - Banten</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Radius Pencarian</label>
                  <input type="range" min="1" max="50" value="10" class="w-full" onchange="updateSearchRadius(this.value)">
                  <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>1 km</span>
                    <span id="radius-value">10 km</span>
                    <span>50 km</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- QUICK ACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showOrderModal()">
                Pesan Ojek Terdekat
                </button>
                <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all">
                Berikan Infaq Langsung
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                Export Data Cluster
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="wallet-template">
      <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN WALLET -->
          <div class="col-span-8 space-y-6">
            <!-- BALANCE OVERVIEW -->
            <div class="bg-gradient-to-r from-luyu-green to-luyu-blue rounded-2xl p-8 text-white">
              <h2 class="text-2xl font-bold mb-6">Dompet Syariah</h2>
              <div class="grid grid-cols-2 gap-8">
                <div class="bg-white/20 p-6 rounded-xl backdrop-blur-sm">
                  <h3 class="text-lg font-semibold mb-2">Saldo Utama</h3>
                  <p class="text-3xl font-bold mb-2" id="main-balance">Rp 185.000</p>
                  <p class="text-sm text-white/80">+Rp 25.000 hari ini</p>
                  <button class="mt-4 bg-white text-luyu-green px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="showModal('topup-modal')">
                  Top Up
                  </button>
                </div>
                <div class="bg-white/20 p-6 rounded-xl backdrop-blur-sm">
                  <h3 class="text-lg font-semibold mb-2">Saldo Infaq</h3>
                  <p class="text-3xl font-bold mb-2" id="infaq-balance">Rp 35.000</p>
                  <p class="text-sm text-white/80">Siap disalurkan</p>
                  <button class="mt-4 bg-luyu-gold text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all">
                  Salurkan
                  </button>
                </div>
              </div>
            </div>
            <!-- TRANSACTION HISTORY -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Riwayat Transaksi</h3>
                <div class="flex space-x-2">
                  <button class="px-4 py-2 bg-luyu-green text-white rounded-lg text-sm">Semua</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Masuk</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Keluar</button>
                </div>
              </div>
              <div class="data-table">
                <table>
                  <thead>
                    <tr>
                      <th>Tanggal</th>
                      <th>Deskripsi</th>
                      <th>Kategori</th>
                      <th>Jumlah</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>30 Mei 2025</td>
                      <td>Ojek ke Masjid Al-Barokah</td>
                      <td><span class="bg-luyu-green/10 text-luyu-green px-2 py-1 rounded-full text-xs">Trip</span></td>
                      <td class="font-semibold text-luyu-red">-Rp 12.500</td>
                      <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                    </tr>
                    <tr>
                      <td>30 Mei 2025</td>
                      <td>Auto Zakat - Trip</td>
                      <td><span class="bg-luyu-gold/10 text-luyu-gold px-2 py-1 rounded-full text-xs">Zakat</span></td>
                      <td class="font-semibold text-luyu-red">-Rp 312</td>
                      <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                    </tr>
                    <tr>
                      <td>29 Mei 2025</td>
                      <td>Infaq untuk Ustadzah Siti</td>
                      <td><span class="bg-luyu-purple/10 text-luyu-purple px-2 py-1 rounded-full text-xs">Infaq</span></td>
                      <td class="font-semibold text-luyu-red">-Rp 25.000</td>
                      <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                    </tr>
                    <tr>
                      <td>29 Mei 2025</td>
                      <td>Top Up Saldo</td>
                      <td><span class="bg-luyu-blue/10 text-luyu-blue px-2 py-1 rounded-full text-xs">Top Up</span></td>
                      <td class="font-semibold text-luyu-green">+Rp 100.000</td>
                      <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                    </tr>
                    <tr>
                      <td>28 Mei 2025</td>
                      <td>Wakaf Quran Digital</td>
                      <td><span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-xs">Wakaf</span></td>
                      <td class="font-semibold text-luyu-red">-Rp 50.000</td>
                      <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- SIDEBAR -->
          <div class="col-span-4 space-y-6">
            <!-- AUTO SETTINGS - PERBAIKAN -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Pengaturan Otomatis</h3>
              <div class="space-y-4">
                <div class="p-4 bg-luyu-gold/10 border border-luyu-gold/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Auto-Zakat</h4>
                      <p class="text-sm text-gray-600">2.5% dari setiap transaksi</p>
                    </div>
                    <label class="switch switch-gold">
                    <input type="checkbox" checked id="auto-zakat-wallet" onchange="toggleAutoZakat(this.checked)">
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
                <div class="p-4 bg-luyu-purple/10 border border-luyu-purple/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Auto-Infaq</h4>
                      <p class="text-sm text-gray-600">Rp 1.000 per trip Cluster C</p>
                    </div>
                    <label class="switch switch-purple">
                    <input type="checkbox" checked id="auto-infaq-wallet" onchange="toggleAutoInfaq(this.checked)">
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
                <div class="p-4 bg-luyu-blue/10 border border-luyu-blue/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Notifikasi Saldo</h4>
                      <p class="text-sm text-gray-600">Alert jika saldo < Rp 50.000</p>
                    </div>
                    <label class="switch switch-blue">
                    <input type="checkbox" checked id="balance-notification-wallet" onchange="toggleBalanceNotification(this.checked)">
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <!-- MONTHLY SUMMARY -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Ringkasan Bulan Ini</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Total Pengeluaran</span>
                  <span class="font-bold text-luyu-red">Rp 425.000</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Total Top Up</span>
                  <span class="font-bold text-luyu-green">Rp 500.000</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Zakat Dibayar</span>
                  <span class="font-bold text-luyu-gold">Rp 12.500</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Infaq Disalurkan</span>
                  <span class="font-bold text-luyu-purple">Rp 75.000</span>
                </div>
                <div class="border-t pt-4">
                  <div class="flex justify-between items-center">
                    <span class="font-semibold text-gray-800">Pahala Earned</span>
                    <span class="font-bold text-luyu-blue">+185 Points</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- QUICK ACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showModal('topup-modal')">
                Top Up Saldo
                </button>
                <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all">
                Bayar Zakat Manual
                </button>
                <button class="w-full bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all">
                Salurkan Infaq
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                Unduh Laporan
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="zakat-template">
      <div class="animate-fade-in">
        <!-- ZAKAT CALCULATOR -->
        <div class="bg-gradient-to-r from-luyu-gold to-luyu-green rounded-2xl p-8 text-white mb-8">
          <div class="grid grid-cols-2 gap-8 items-center">
            <div>
              <h2 class="text-2xl font-bold mb-4">Kalkulator Zakat</h2>
              <p class="text-white/90 mb-6">Hitung zakat Anda dengan mudah sesuai syariat Islam</p>
              <div class="bg-white/20 p-4 rounded-xl mb-6 backdrop-blur-sm">
                <div class="grid grid-cols-2 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium mb-2">Jenis Zakat</label>
                    <select class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white" id="zakat-type" onchange="updateZakatCalculation()">
                      <option value="mal">Zakat Mal (Harta)</option>
                      <option value="penghasilan">Zakat Penghasilan</option>
                      <option value="perdagangan">Zakat Perdagangan</option>
                      <option value="emas">Zakat Emas/Perak</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">Jumlah Harta (Rp)</label>
                    <input type="number" class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70" placeholder="0" id="zakat-amount" onkeyup="updateZakatCalculation()">
                  </div>
                </div>
                <div class="bg-white/10 p-3 rounded-lg">
                  <div class="flex justify-between items-center">
                    <span class="text-sm">Zakat yang harus dibayar:</span>
                    <span class="text-xl font-bold" id="zakat-result">Rp 0</span>
                  </div>
                </div>
              </div>
              <button class="bg-white text-luyu-gold font-semibold py-3 px-6 rounded-xl hover:shadow-lg transition-all" onclick="payZakat()">
              Bayar Zakat Sekarang
              </button>
            </div>
            <div class="text-center">
              <div class="bg-white/10 p-6 rounded-2xl backdrop-blur-sm">
                <h3 class="text-lg font-semibold mb-2">Zakat Terbayar Bulan Ini</h3>
                <div class="text-3xl font-bold mb-1" id="monthly-zakat">Rp 47.500</div>
                <p class="text-sm text-white/80">Target: Rp 50.000</p>
                <div class="mt-4">
                  <div class="progress-bar">
                    <div class="progress-fill bg-white" style="width: 95%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN CONTENT -->
          <div class="col-span-8 space-y-6">
            <!-- INFAQ TO DRIVERS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Infaq Langsung ke Driver</h3>
              <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="border border-gray-200 rounded-xl p-4 hover:border-luyu-green/30 hover:shadow-md transition-all cursor-pointer" onclick="selectDriverForInfaq('siti')">
                  <div class="flex items-center mb-3">
                    <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                      <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                      </svg>
                    </div>
                    <div class="ml-3">
                      <h4 class="font-semibold text-gray-800">Ustadzah Siti</h4>
                      <p class="text-sm text-gray-600">Cluster C • Online</p>
                    </div>
                  </div>
                  <button class="w-full bg-luyu-green text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-green/90 transition-all">
                  Kirim Infaq
                  </button>
                </div>
                <div class="border border-gray-200 rounded-xl p-4 hover:border-luyu-green/30 hover:shadow-md transition-all cursor-pointer" onclick="selectDriverForInfaq('ahmad')">
                  <div class="flex items-center mb-3">
                    <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                      <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                      </svg>
                    </div>
                    <div class="ml-3">
                      <h4 class="font-semibold text-gray-800">Pak Ahmad</h4>
                      <p class="text-sm text-gray-600">Cluster C • Online</p>
                    </div>
                  </div>
                  <button class="w-full bg-luyu-green text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-green/90 transition-all">
                  Kirim Infaq
                  </button>
                </div>
                <div class="border border-gray-200 rounded-xl p-4 hover:border-luyu-blue/30 hover:shadow-md transition-all cursor-pointer" onclick="selectDriverForInfaq('random')">
                  <div class="flex items-center mb-3">
                    <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center">
                      <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <div class="ml-3">
                      <h4 class="font-semibold text-gray-800">Driver Random</h4>
                      <p class="text-sm text-gray-600">Semua Cluster</p>
                    </div>
                  </div>
                  <button class="w-full bg-luyu-blue text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-blue/90 transition-all">
                  Infaq Random
                  </button>
                </div>
              </div>
              <div class="bg-luyu-green/10 border border-luyu-green/20 rounded-xl p-4">
                <h4 class="font-semibold text-gray-800 mb-3">Infaq Cepat</h4>
                <div class="grid grid-cols-4 gap-3">
                  <button class="py-3 px-4 border border-luyu-green/30 rounded-lg hover:bg-luyu-green hover:text-white transition-all" onclick="quickInfaq(5000)">Rp 5.000</button>
                  <button class="py-3 px-4 border border-luyu-green/30 rounded-lg hover:bg-luyu-green hover:text-white transition-all" onclick="quickInfaq(10000)">Rp 10.000</button>
                  <button class="py-3 px-4 border border-luyu-green/30 rounded-lg hover:bg-luyu-green hover:text-white transition-all" onclick="quickInfaq(25000)">Rp 25.000</button>
                  <button class="py-3 px-4 border border-luyu-green/30 rounded-lg hover:bg-luyu-green hover:text-white transition-all" onclick="quickInfaq(50000)">Rp 50.000</button>
                </div>
              </div>
            </div>
            <!-- TRANSACTION HISTORY -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Riwayat Zakat & Infaq</h3>
                <div class="flex space-x-2">
                  <button class="px-4 py-2 bg-luyu-green text-white rounded-lg text-sm">Semua</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Zakat</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Infaq</button>
                </div>
              </div>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-luyu-gold/20 rounded-full flex items-center justify-center mr-4">
                      <svg class="w-5 h-5 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold">Zakat Mal - Auto</p>
                      <p class="text-sm text-gray-500">30 Mei 2025 • 15:30</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="font-bold text-luyu-gold">Rp 12.500</p>
                    <p class="text-xs text-green-600">Tersalurkan</p>
                  </div>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-luyu-green/20 rounded-full flex items-center justify-center mr-4">
                      <svg class="w-5 h-5 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold">Infaq untuk Ustadzah Siti</p>
                      <p class="text-sm text-gray-500">30 Mei 2025 • 14:15</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="font-bold text-luyu-green">Rp 25.000</p>
                    <p class="text-xs text-green-600">Diterima Driver</p>
                  </div>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-luyu-purple/20 rounded-full flex items-center justify-center mr-4">
                      <svg class="w-5 h-5 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold">Zakat Penghasilan Manual</p>
                      <p class="text-sm text-gray-500">29 Mei 2025 • 20:45</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="font-bold text-luyu-purple">Rp 50.000</p>
                    <p class="text-xs text-green-600">Tersalurkan</p>
                  </div>
                </div>
              </div>
            </div>
            <!-- MUSTAHIQ STATISTICS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Dampak Zakat & Infaq Anda</h3>
              <div class="grid grid-cols-2 gap-6">
                <div class="text-center p-6 bg-luyu-green/10 rounded-xl">
                  <div class="w-16 h-16 bg-luyu-green/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                  </div>
                  <p class="text-3xl font-bold text-luyu-green mb-2">847</p>
                  <p class="text-sm text-gray-600">Mustahiq Terbantu</p>
                </div>
                <div class="text-center p-6 bg-luyu-gold/10 rounded-xl">
                  <div class="w-16 h-16 bg-luyu-gold/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                    </svg>
                  </div>
                  <p class="text-3xl font-bold text-luyu-gold mb-2">Rp 2.4M</p>
                  <p class="text-sm text-gray-600">Total Disalurkan</p>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR -->
          <div class="col-span-4 space-y-6">
            <!-- AUTO ZAKAT SETTINGS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Pengaturan Auto-Zakat</h3>
              <div class="space-y-4">
                <div class="p-4 bg-luyu-gold/10 border border-luyu-gold/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Auto-Zakat Trip</h4>
                      <p class="text-sm text-gray-600">2.5% dari setiap trip</p>
                    </div>
                    <label class="switch switch-gold">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
                <div class="p-4 bg-luyu-green/10 border border-luyu-green/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Auto-Zakat Bulanan</h4>
                      <p class="text-sm text-gray-600">Dari total pendapatan</p>
                    </div>
                    <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
                <div class="p-4 bg-luyu-blue/10 border border-luyu-blue/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Reminder Zakat</h4>
                      <p class="text-sm text-gray-600">Pengingat bulanan</p>
                    </div>
                    <label class="switch switch-blue">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <!-- MONTHLY TARGET -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Target Zakat Bulanan</h3>
              <div class="space-y-4">
                <div>
                  <div class="flex justify-between text-sm mb-2">
                    <span>Progress Bulan Ini</span>
                    <span class="font-semibold">Rp 47.5K / Rp 50K</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill bg-luyu-gold" style="width: 95%"></div>
                  </div>
                  <p class="text-xs text-gray-500 mt-1">Rp 2.500 lagi untuk mencapai target</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-gray-800 mb-2">Rincian Target</h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span>Auto-zakat trip</span>
                      <span>Rp 32.500</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Zakat manual</span>
                      <span>Rp 15.000</span>
                    </div>
                    <hr class="my-2">
                    <div class="flex justify-between font-semibold">
                      <span>Total</span>
                      <span>Rp 47.500</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- ZAKAT CALCULATOR SIDEBAR -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Nisab Hari Ini</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Emas (85 gram)</span>
                  <span class="font-semibold">Rp 85.000.000</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Perak (595 gram)</span>
                  <span class="font-semibold">Rp 8.500.000</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Penghasilan</span>
                  <span class="font-semibold">Rp 6.000.000</span>
                </div>
              </div>
              <div class="mt-4 pt-4 border-t border-gray-100">
                <p class="text-xs text-gray-500">*Nisab dihitung berdasarkan harga emas hari ini</p>
              </div>
            </div>
            <!-- QUICK ACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all" onclick="showModal('zakat-manual-modal')">
                Bayar Zakat Manual
                </button>
                <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="randomInfaq()">
                Infaq Random Driver
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                Lihat Laporan Lengkap
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="wakaf-template">
      <div class="animate-fade-in">
        <!-- WAKAF HEADER -->
        <div class="bg-gradient-to-r from-luyu-purple to-luyu-blue rounded-2xl p-8 text-white mb-8">
          <div class="grid grid-cols-2 gap-8 items-center">
            <div>
              <h2 class="text-2xl font-bold mb-4">Wakaf Digital</h2>
              <p class="text-white/90 mb-6">Investasi akhirat yang berkelanjutan melalui platform digital</p>
              <div class="bg-white/20 p-4 rounded-xl mb-6 backdrop-blur-sm">
                <h3 class="font-semibold mb-3">Total Kontribusi Wakaf Anda</h3>
                <div class="text-3xl font-bold mb-2" id="total-wakaf">Rp 1.250.000</div>
                <p class="text-sm text-white/80">Dalam 12 program wakaf aktif</p>
              </div>
              <button class="bg-white text-luyu-purple font-semibold py-3 px-6 rounded-xl hover:shadow-lg transition-all" onclick="showModal('wakaf-tunai-modal')">
              Wakaf Tunai Sekarang
              </button>
            </div>
            <div class="text-center">
              <div class="bg-white/10 p-6 rounded-2xl backdrop-blur-sm">
                <h3 class="text-lg font-semibold mb-2">Pahala Wakaf Bulan Ini</h3>
                <div class="text-3xl font-bold mb-1">+1,847</div>
                <p class="text-sm text-white/80">Pahala Points</p>
                <div class="mt-4">
                  <div class="progress-bar">
                    <div class="progress-fill bg-white" style="width: 73%"></div>
                  </div>
                  <p class="text-xs mt-1 text-white/70">Target: 2,500 points</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN CONTENT -->
          <div class="col-span-8 space-y-6">
            <!-- WAKAF PROGRAMS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Program Wakaf Aktif</h3>
                <div class="flex space-x-2">
                  <button class="px-4 py-2 bg-luyu-purple text-white rounded-lg text-sm">Semua</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Masjid</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Pendidikan</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Sosial</button>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-6">
                <!-- WAKAF PROGRAM 1 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="showWakafDetail('masjid-al-ikhlas')">
                  <div class="h-48 bg-gradient-to-br from-luyu-green to-luyu-blue relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute top-4 left-4">
                      <span class="bg-white/90 text-luyu-green px-3 py-1 rounded-full text-xs font-semibold">Masjid</span>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <h4 class="font-bold text-lg">Masjid Al-Ikhlas</h4>
                      <p class="text-sm text-white/90">Tangerang Selatan</p>
                    </div>
                  </div>
                  <div class="p-4">
                    <div class="mb-4">
                      <div class="flex justify-between text-sm mb-2">
                        <span>Progress</span>
                        <span class="font-semibold">Rp 847M / Rp 1.2M</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill bg-luyu-green" style="width: 70.6%"></div>
                      </div>
                      <p class="text-xs text-gray-500 mt-1">70.6% tercapai</p>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                      <span class="text-sm text-gray-600">Kontribusi Anda:</span>
                      <span class="font-bold text-luyu-green">Rp 250.000</span>
                    </div>
                    <button class="w-full bg-luyu-green text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-green/90 transition-all" onclick="contributeWakaf('masjid-al-ikhlas'); event.stopPropagation();">
                    Tambah Wakaf
                    </button>
                  </div>
                </div>
                <!-- WAKAF PROGRAM 2 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="showWakafDetail('sekolah-tahfidz')">
                  <div class="h-48 bg-gradient-to-br from-luyu-blue to-luyu-purple relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute top-4 left-4">
                      <span class="bg-white/90 text-luyu-blue px-3 py-1 rounded-full text-xs font-semibold">Pendidikan</span>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <h4 class="font-bold text-lg">Sekolah Tahfidz</h4>
                      <p class="text-sm text-white/90">Bekasi</p>
                    </div>
                  </div>
                  <div class="p-4">
                    <div class="mb-4">
                      <div class="flex justify-between text-sm mb-2">
                        <span>Progress</span>
                        <span class="font-semibold">Rp 320M / Rp 800M</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill bg-luyu-blue" style="width: 40%"></div>
                      </div>
                      <p class="text-xs text-gray-500 mt-1">40% tercapai</p>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                      <span class="text-sm text-gray-600">Kontribusi Anda:</span>
                      <span class="font-bold text-luyu-blue">Rp 150.000</span>
                    </div>
                    <button class="w-full bg-luyu-blue text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-blue/90 transition-all" onclick="contributeWakaf('sekolah-tahfidz'); event.stopPropagation();">
                    Tambah Wakaf
                    </button>
                  </div>
                </div>
                <!-- WAKAF PROGRAM 3 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="showWakafDetail('sumur-wakaf')">
                  <div class="h-48 bg-gradient-to-br from-luyu-gold to-luyu-green relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute top-4 left-4">
                      <span class="bg-white/90 text-luyu-gold px-3 py-1 rounded-full text-xs font-semibold">Sosial</span>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <h4 class="font-bold text-lg">Sumur Wakaf</h4>
                      <p class="text-sm text-white/90">Lombok Timur</p>
                    </div>
                  </div>
                  <div class="p-4">
                    <div class="mb-4">
                      <div class="flex justify-between text-sm mb-2">
                        <span>Progress</span>
                        <span class="font-semibold">Rp 125M / Rp 150M</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill bg-luyu-gold" style="width: 83.3%"></div>
                      </div>
                      <p class="text-xs text-gray-500 mt-1">83.3% tercapai</p>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                      <span class="text-sm text-gray-600">Kontribusi Anda:</span>
                      <span class="font-bold text-luyu-gold">Rp 100.000</span>
                    </div>
                    <button class="w-full bg-luyu-gold text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-gold/90 transition-all" onclick="contributeWakaf('sumur-wakaf'); event.stopPropagation();">
                    Tambah Wakaf
                    </button>
                  </div>
                </div>
                <!-- WAKAF PROGRAM 4 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="showWakafDetail('ambulance-gratis')">
                  <div class="h-48 bg-gradient-to-br from-luyu-red to-luyu-purple relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute top-4 left-4">
                      <span class="bg-white/90 text-luyu-red px-3 py-1 rounded-full text-xs font-semibold">Kesehatan</span>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <h4 class="font-bold text-lg">Ambulance Gratis</h4>
                      <p class="text-sm text-white/90">Jakarta Selatan</p>
                    </div>
                  </div>
                  <div class="p-4">
                    <div class="mb-4">
                      <div class="flex justify-between text-sm mb-2">
                        <span>Progress</span>
                        <span class="font-semibold">Rp 180M / Rp 500M</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill bg-luyu-red" style="width: 36%"></div>
                      </div>
                      <p class="text-xs text-gray-500 mt-1">36% tercapai</p>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                      <span class="text-sm text-gray-600">Kontribusi Anda:</span>
                      <span class="font-bold text-luyu-red">Rp 75.000</span>
                    </div>
                    <button class="w-full bg-luyu-red text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-red/90 transition-all" onclick="contributeWakaf('ambulance-gratis'); event.stopPropagation();">
                    Tambah Wakaf
                    </button>
                  </div>
                </div>
              </div>
              <div class="mt-6 text-center">
                <button class="text-luyu-purple font-semibold hover:underline" onclick="showAllWakafPrograms()">
                Lihat Semua Program Wakaf
                </button>
              </div>
            </div>
            <!-- WAKAF HISTORY -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Riwayat Wakaf Anda</h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-luyu-purple/20 rounded-full flex items-center justify-center mr-4">
                      <svg class="w-5 h-5 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold">Wakaf Masjid Al-Ikhlas</p>
                      <p class="text-sm text-gray-500">30 Mei 2025 • 14:20</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="font-bold text-luyu-purple">Rp 50.000</p>
                    <button class="text-xs text-luyu-blue hover:underline" onclick="downloadWakafCertificate('WKF001')">
                    Unduh Sertifikat
                    </button>
                  </div>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-luyu-blue/20 rounded-full flex items-center justify-center mr-4">
                      <svg class="w-5 h-5 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold">Wakaf Sekolah Tahfidz</p>
                      <p class="text-sm text-gray-500">28 Mei 2025 • 16:45</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="font-bold text-luyu-blue">Rp 100.000</p>
                    <button class="text-xs text-luyu-blue hover:underline" onclick="downloadWakafCertificate('WKF002')">
                    Unduh Sertifikat
                    </button>
                  </div>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-luyu-gold/20 rounded-full flex items-center justify-center mr-4">
                      <svg class="w-5 h-5 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold">Wakaf Tunai Bulanan</p>
                      <p class="text-sm text-gray-500">25 Mei 2025 • 08:00</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="font-bold text-luyu-gold">Rp 200.000</p>
                    <button class="text-xs text-luyu-blue hover:underline" onclick="downloadWakafCertificate('WKF003')">
                    Unduh Sertifikat
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- WAKAF IMPACT -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Dampak Wakaf Anda</h3>
              <div class="grid grid-cols-3 gap-6">
                <div class="text-center p-6 bg-luyu-purple/10 rounded-xl">
                  <div class="w-16 h-16 bg-luyu-purple/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                  </div>
                  <p class="text-3xl font-bold text-luyu-purple mb-2">3</p>
                  <p class="text-sm text-gray-600">Masjid Terbangun</p>
                </div>
                <div class="text-center p-6 bg-luyu-blue/10 rounded-xl">
                  <div class="w-16 h-16 bg-luyu-blue/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                  </div>
                  <p class="text-3xl font-bold text-luyu-blue mb-2">847</p>
                  <p class="text-sm text-gray-600">Santri Terdidik</p>
                </div>
                <div class="text-center p-6 bg-luyu-gold/10 rounded-xl">
                  <div class="w-16 h-16 bg-luyu-gold/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                  </div>
                  <p class="text-3xl font-bold text-luyu-gold mb-2">2,847</p>
                  <p class="text-sm text-gray-600">Keluarga Terbantu</p>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR -->
          <div class="col-span-4 space-y-6">
            <!-- WAKAF TUNAI -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Wakaf Tunai</h3>
              <div class="space-y-4">
                <div class="p-4 bg-luyu-purple/10 border border-luyu-purple/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Wakaf Bulanan</h4>
                      <p class="text-sm text-gray-600">Rp 100.000 per bulan</p>
                    </div>
                    <label class="switch switch-purple">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
                <div class="p-4 bg-luyu-blue/10 border border-luyu-blue/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-800">Auto-Wakaf Trip</h4>
                      <p class="text-sm text-gray-600">Rp 2.000 per trip</p>
                    </div>
                    <label class="switch switch-blue">
                    <input type="checkbox">
                    <span class="slider"></span>
                    </label>
                  </div>
                </div>
                <button class="w-full bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all" onclick="showModal('wakaf-tunai-modal')">
                Wakaf Tunai Sekarang
                </button>
              </div>
            </div>
            <!-- MONTHLY PROGRESS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Progress Bulan Ini</h3>
              <div class="space-y-4">
                <div>
                  <div class="flex justify-between text-sm mb-2">
                    <span>Target Wakaf</span>
                    <span class="font-semibold">Rp 150K / Rp 200K</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill bg-luyu-purple" style="width: 75%"></div>
                  </div>
                  <p class="text-xs text-gray-500 mt-1">75% dari target bulanan</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-gray-800 mb-2">Rincian Wakaf</h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span>Wakaf tunai</span>
                      <span>Rp 100.000</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Wakaf program</span>
                      <span>Rp 50.000</span>
                    </div>
                    <hr class="my-2">
                    <div class="flex justify-between font-semibold">
                      <span>Total</span>
                      <span>Rp 150.000</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- CERTIFICATES -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Sertifikat Wakaf</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-purple/20 rounded-lg flex items-center justify-center mr-3">
                      <svg class="w-4 h-4 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold text-sm">WKF-001</p>
                      <p class="text-xs text-gray-500">Masjid Al-Ikhlas</p>
                    </div>
                  </div>
                  <button class="text-luyu-blue text-xs hover:underline" onclick="downloadWakafCertificate('WKF001')">
                  Unduh
                  </button>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-blue/20 rounded-lg flex items-center justify-center mr-3">
                      <svg class="w-4 h-4 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold text-sm">WKF-002</p>
                      <p class="text-xs text-gray-500">Sekolah Tahfidz</p>
                    </div>
                  </div>
                  <button class="text-luyu-blue text-xs hover:underline" onclick="downloadWakafCertificate('WKF002')">
                  Unduh
                  </button>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-gold/20 rounded-lg flex items-center justify-center mr-3">
                      <svg class="w-4 h-4 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold text-sm">WKF-003</p>
                      <p class="text-xs text-gray-500">Wakaf Tunai</p>
                    </div>
                  </div>
                  <button class="text-luyu-blue text-xs hover:underline" onclick="downloadWakafCertificate('WKF003')">
                  Unduh
                  </button>
                </div>
              </div>
            </div>
            <!-- QUICK ACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all" onclick="showModal('wakaf-tunai-modal')">
                Wakaf Tunai
                </button>
                <button class="w-full bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:bg-luyu-blue/90 transition-all" onclick="showAllWakafPrograms()">
                Jelajahi Program
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                Laporan Wakaf
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="kajian-template">
      <div class="animate-fade-in">
        <!-- KAJIAN HEADER -->
        <div class="bg-gradient-to-r from-luyu-green to-luyu-purple rounded-2xl p-8 text-white mb-8">
          <div class="grid grid-cols-2 gap-8 items-center">
            <div>
              <h2 class="text-2xl font-bold mb-4">Kajian Online</h2>
              <p class="text-white/90 mb-6">Menambah ilmu agama bersama para ustadz terpercaya</p>
              <div class="bg-white/20 p-4 rounded-xl mb-6 backdrop-blur-sm">
                <h3 class="font-semibold mb-3">Kajian Sedang Berlangsung</h3>
                <div class="flex items-center mb-2">
                  <div class="w-3 h-3 bg-red-500 rounded-full mr-3 animate-pulse"></div>
                  <span class="font-medium">Tafsir Al-Baqarah - Ustadz Ahmad Syakir</span>
                </div>
                <p class="text-sm text-white/80">450 peserta sedang mengikuti</p>
              </div>
              <button class="bg-white text-luyu-green font-semibold py-3 px-6 rounded-xl hover:shadow-lg transition-all" onclick="joinLiveKajian('live-tafsir')">
              Ikuti Kajian Live
              </button>
            </div>
            <div class="text-center">
              <div class="bg-white/10 p-6 rounded-2xl backdrop-blur-sm">
                <h3 class="text-lg font-semibold mb-2">Pencapaian Anda</h3>
                <div class="text-3xl font-bold mb-1" id="kajian-hours">127</div>
                <p class="text-sm text-white/80 mb-4">Jam Kajian Diikuti</p>
                <div class="text-xl font-bold mb-1" id="certificates-earned">8</div>
                <p class="text-sm text-white/80">Sertifikat Diperoleh</p>
              </div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN CONTENT -->
          <div class="col-span-8 space-y-6">
            <!-- LIVE KAJIAN -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                  <div class="w-4 h-4 bg-red-500 rounded-full mr-3 animate-pulse"></div>
                  <h3 class="text-xl font-bold text-gray-800">Kajian Live Sekarang</h3>
                </div>
                <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold">LIVE</span>
              </div>
              <div class="bg-gray-1000 rounded-xl overflow-hidden mb-4">
                <div class="aspect-video bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center">
                  <div class="text-center text-white">
                    <div class="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                      <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <h4 class="text-xl font-bold mb-2">Tafsir Surat Al-Baqarah</h4>
                    <p class="text-white/80 mb-4">Ustadz Ahmad Syakir</p>
                    <button class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-all" onclick="joinLiveKajian('live-tafsir')">
                    Bergabung Sekarang
                    </button>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                  <p class="text-2xl font-bold text-gray-800">450</p>
                  <p class="text-sm text-gray-600">Peserta</p>
                </div>
                <div>
                  <p class="text-2xl font-bold text-gray-800">45:32</p>
                  <p class="text-sm text-gray-600">Durasi</p>
                </div>
                <div>
                  <p class="text-2xl font-bold text-gray-800">4.9</p>
                  <p class="text-sm text-gray-600">Rating</p>
                </div>
              </div>
            </div>
            <!-- UPCOMING KAJIAN -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Kajian Mendatang</h3>
                <div class="flex space-x-2">
                  <button class="px-4 py-2 bg-luyu-green text-white rounded-lg text-sm">Semua</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Fiqih</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Tafsir</button>
                  <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Akhlaq</button>
                </div>
              </div>
              <div class="space-y-4">
                <!-- KAJIAN 1 -->
                <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all cursor-pointer" onclick="showKajianDetail('fiqih-muamalah')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center">
                      <div class="w-16 h-16 bg-luyu-blue/10 rounded-xl flex items-center justify-center mr-4">
                        <svg class="w-8 h-8 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                      </div>
                      <div>
                        <h4 class="font-bold text-gray-800">Fiqih Muamalah Modern</h4>
                        <p class="text-sm text-gray-600 mb-1">Ustadz Dr. Mahmud Hasan</p>
                        <div class="flex items-center text-sm text-gray-500">
                          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                          </svg>
                          <span>Besok, 20:00 WIB</span>
                          <span class="mx-2">•</span>
                          <span>90 menit</span>
                        </div>
                      </div>
                    </div>
                    <div class="text-right">
                      <span class="bg-luyu-blue/10 text-luyu-blue px-3 py-1 rounded-full text-sm font-semibold">Fiqih</span>
                      <div class="mt-2">
                        <button class="bg-luyu-blue text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-blue/90 transition-all" onclick="setReminder('fiqih-muamalah'); event.stopPropagation();">
                        Set Reminder
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- KAJIAN 2 -->
                <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all cursor-pointer" onclick="showKajianDetail('akhlaq-keluarga')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center">
                      <div class="w-16 h-16 bg-luyu-green/10 rounded-xl flex items-center justify-center mr-4">
                        <svg class="w-8 h-8 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                      </div>
                      <div>
                        <h4 class="font-bold text-gray-800">Akhlaq dalam Keluarga</h4>
                        <p class="text-sm text-gray-600 mb-1">Ustadzah Dr. Siti Nurhaliza</p>
                        <div class="flex items-center text-sm text-gray-500">
                          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                          </svg>
                          <span>Kamis, 19:30 WIB</span>
                          <span class="mx-2">•</span>
                          <span>75 menit</span>
                        </div>
                      </div>
                    </div>
                    <div class="text-right">
                      <span class="bg-luyu-green/10 text-luyu-green px-3 py-1 rounded-full text-sm font-semibold">Akhlaq</span>
                      <div class="mt-2">
                        <button class="bg-luyu-green text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-green/90 transition-all" onclick="setReminder('akhlaq-keluarga'); event.stopPropagation();">
                        Set Reminder
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- KAJIAN 3 -->
                <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all cursor-pointer" onclick="showKajianDetail('tafsir-yusuf')">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center">
                      <div class="w-16 h-16 bg-luyu-purple/10 rounded-xl flex items-center justify-center mr-4">
                        <svg class="w-8 h-8 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                      </div>
                      <div>
                        <h4 class="font-bold text-gray-800">Tafsir Surat Yusuf</h4>
                        <p class="text-sm text-gray-600 mb-1">Ustadz Prof. Dr. Abdullah Salim</p>
                        <div class="flex items-center text-sm text-gray-500">
                          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                          </svg>
                          <span>Jumat, 21:00 WIB</span>
                          <span class="mx-2">•</span>
                          <span>120 menit</span>
                        </div>
                      </div>
                    </div>
                    <div class="text-right">
                      <span class="bg-luyu-purple/10 text-luyu-purple px-3 py-1 rounded-full text-sm font-semibold">Tafsir</span>
                      <div class="mt-2">
                        <button class="bg-luyu-purple text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-purple/90 transition-all" onclick="setReminder('tafsir-yusuf'); event.stopPropagation();">
                        Set Reminder
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- RECORDED KAJIAN -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Rekaman Kajian Populer</h3>
              <div class="grid grid-cols-2 gap-6">
                <!-- RECORDED 1 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="playRecordedKajian('hadits-40')">
                  <div class="aspect-video bg-gradient-to-br from-luyu-gold to-luyu-green relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute center-0 w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                      <svg class="w-8 h-8 text-white ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <div class="bg-black/50 px-2 py-1 rounded text-xs">2:15:30</div>
                    </div>
                  </div>
                  <div class="p-4">
                    <h4 class="font-bold text-gray-800 mb-2">40 Hadits Nawawi</h4>
                    <p class="text-sm text-gray-600 mb-3">Ustadz Muhammad Hakim</p>
                    <div class="flex items-center justify-between text-sm">
                      <div class="flex items-center text-gray-500">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span>2,847 views</span>
                      </div>
                      <div class="star-rating text-luyu-gold text-sm">★★★★★</div>
                    </div>
                  </div>
                </div>
                <!-- RECORDED 2 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="playRecordedKajian('sirah-nabi')">
                  <div class="aspect-video bg-gradient-to-br from-luyu-blue to-luyu-purple relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute center-0 w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                      <svg class="w-8 h-8 text-white ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <div class="bg-black/50 px-2 py-1 rounded text-xs">1:45:20</div>
                    </div>
                  </div>
                  <div class="p-4">
                    <h4 class="font-bold text-gray-800 mb-2">Sirah Nabawiyah</h4>
                    <p class="text-sm text-gray-600 mb-3">Ustadz Dr. Ahmad Zaki</p>
                    <div class="flex items-center justify-between text-sm">
                      <div class="flex items-center text-gray-500">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span>1,523 views</span>
                      </div>
                      <div class="star-rating text-luyu-gold text-sm">★★★★★</div>
                    </div>
                  </div>
                </div>
                <!-- RECORDED 3 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="playRecordedKajian('fiqih-shalat')">
                  <div class="aspect-video bg-gradient-to-br from-luyu-green to-luyu-blue relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute center-0 w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                      <svg class="w-8 h-8 text-white ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <div class="bg-black/50 px-2 py-1 rounded text-xs">0:55:45</div>
                    </div>
                  </div>
                  <div class="p-4">
                    <h4 class="font-bold text-gray-800 mb-2">Fiqih Shalat Lengkap</h4>
                    <p class="text-sm text-gray-600 mb-3">Ustadz Ridwan Kamil</p>
                    <div class="flex items-center justify-between text-sm">
                      <div class="flex items-center text-gray-500">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span>3,245 views</span>
                      </div>
                      <div class="star-rating text-luyu-gold text-sm">★★★★★</div>
                    </div>
                  </div>
                </div>
                <!-- RECORDED 4 -->
                <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all cursor-pointer" onclick="playRecordedKajian('doa-dzikir')">
                  <div class="aspect-video bg-gradient-to-br from-luyu-purple to-luyu-red relative">
                    <div class="absolute inset-0 bg-black/20"></div>
                    <div class="absolute center-0 w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                      <svg class="w-8 h-8 text-white ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                      <div class="bg-black/50 px-2 py-1 rounded text-xs">1:20:15</div>
                    </div>
                  </div>
                  <div class="p-4">
                    <h4 class="font-bold text-gray-800 mb-2">Doa & Dzikir Harian</h4>
                    <p class="text-sm text-gray-600 mb-3">Ustadzah Fatimah Az-Zahra</p>
                    <div class="flex items-center justify-between text-sm">
                      <div class="flex items-center text-gray-500">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span>1,876 views</span>
                      </div>
                      <div class="star-rating text-luyu-gold text-sm">★★★★★</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR -->
          <div class="col-span-4 space-y-6">
            <!-- MY SCHEDULE -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Jadwal Kajian Saya</h3>
              <div class="space-y-3">
                <div class="flex items-center p-3 bg-luyu-blue/10 rounded-lg">
                  <div class="w-3 h-3 bg-luyu-blue rounded-full mr-3"></div>
                  <div class="flex-1">
                    <p class="font-semibold text-sm">Fiqih Muamalah</p>
                    <p class="text-xs text-gray-500">Besok, 20:00 WIB</p>
                  </div>
                  <svg class="w-4 h-4 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5 5-5h-5m-6 10V4H4v13h5z"/>
                  </svg>
                </div>
                <div class="flex items-center p-3 bg-luyu-green/10 rounded-lg">
                  <div class="w-3 h-3 bg-luyu-green rounded-full mr-3"></div>
                  <div class="flex-1">
                    <p class="font-semibold text-sm">Akhlaq Keluarga</p>
                    <p class="text-xs text-gray-500">Kamis, 19:30 WIB</p>
                  </div>
                  <svg class="w-4 h-4 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5 5-5h-5m-6 10V4H4v13h5z"/>
                  </svg>
                </div>
                <div class="flex items-center p-3 bg-luyu-purple/10 rounded-lg">
                  <div class="w-3 h-3 bg-luyu-purple rounded-full mr-3"></div>
                  <div class="flex-1">
                    <p class="font-semibold text-sm">Tafsir Surat Yusuf</p>
                    <p class="text-xs text-gray-500">Jumat, 21:00 WIB</p>
                  </div>
                  <svg class="w-4 h-4 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5 5-5h-5m-6 10V4H4v13h5z"/>
                  </svg>
                </div>
              </div>
              <div class="mt-4 pt-4 border-t border-gray-100">
                <button class="w-full text-luyu-blue font-semibold text-sm hover:underline">
                Lihat Semua Jadwal
                </button>
              </div>
            </div>
            <!-- USTADZ FAVORIT -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Ustadz Favorit</h3>
              <div class="space-y-4">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center mr-3">
                    <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                  </div>
                  <div class="flex-1">
                    <p class="font-semibold text-gray-800">Ustadz Ahmad Syakir</p>
                    <p class="text-sm text-gray-500">Tafsir & Hadits</p>
                  </div>
                  <button class="text-luyu-green text-sm hover:underline">Follow</button>
                </div>
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center mr-3">
                    <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                  </div>
                  <div class="flex-1">
                    <p class="font-semibold text-gray-800">Dr. Mahmud Hasan</p>
                    <p class="text-sm text-gray-500">Fiqih Muamalah</p>
                  </div>
                  <button class="text-luyu-blue text-sm hover:underline">Follow</button>
                </div>
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-luyu-purple/10 rounded-full flex items-center justify-center mr-3">
                    <svg class="w-6 h-6 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                  </div>
                  <div class="flex-1">
                    <p class="font-semibold text-gray-800">Ustadzah Dr. Siti</p>
                    <p class="text-sm text-gray-500">Akhlaq & Tarbiyah</p>
                  </div>
                  <button class="text-luyu-purple text-sm hover:underline">Follow</button>
                </div>
              </div>
            </div>
            <!-- NOTIFICATIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Pengaturan Notifikasi</h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-gray-800">Reminder Kajian</h4>
                    <p class="text-sm text-gray-600">30 menit sebelum mulai</p>
                  </div>
                  <label class="switch">
                  <input type="checkbox" checked>
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-gray-800">Kajian Baru</h4>
                    <p class="text-sm text-gray-600">Notifikasi ustadz favorit</p>
                  </div>
                  <label class="switch switch-blue">
                  <input type="checkbox" checked>
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-gray-800">Sertifikat</h4>
                    <p class="text-sm text-gray-600">Sertifikat siap diunduh</p>
                  </div>
                  <label class="switch switch-gold">
                  <input type="checkbox" checked>
                  <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>
            <!-- MY CERTIFICATES -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Sertifikat Saya</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-green/20 rounded-lg flex items-center justify-center mr-3">
                      <svg class="w-4 h-4 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold text-sm">Tafsir Al-Baqarah</p>
                      <p class="text-xs text-gray-500">40 jam kajian</p>
                    </div>
                  </div>
                  <button class="text-luyu-green text-xs hover:underline" onclick="downloadCertificate('tafsir-baqarah')">
                  Unduh
                  </button>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-blue/20 rounded-lg flex items-center justify-center mr-3">
                      <svg class="w-4 h-4 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold text-sm">40 Hadits Nawawi</p>
                      <p class="text-xs text-gray-500">35 jam kajian</p>
                    </div>
                  </div>
                  <button class="text-luyu-blue text-xs hover:underline" onclick="downloadCertificate('40-hadits')">
                  Unduh
                  </button>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-luyu-purple/20 rounded-lg flex items-center justify-center mr-3">
                      <svg class="w-4 h-4 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-semibold text-sm">Fiqih Shalat</p>
                      <p class="text-xs text-gray-500">25 jam kajian</p>
                    </div>
                  </div>
                  <button class="text-luyu-purple text-xs hover:underline" onclick="downloadCertificate('fiqih-shalat')">
                  Unduh
                  </button>
                </div>
              </div>
            </div>
            <!-- QUICK ACTIONS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="joinLiveKajian('live-tafsir')">
                Join Kajian Live
                </button>
                <button class="w-full bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:bg-luyu-blue/90 transition-all" onclick="showKajianSchedule()">
                Lihat Jadwal Lengkap
                </button>
                <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="requestKajianTopic()">
                Request Topik Kajian
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <template id="settings-template">
      <div class="animate-fade-in">
        <!-- SETTINGS HEADER -->
        <div class="bg-gradient-to-r from-luyu-gray to-luyu-blue rounded-2xl p-8 text-white mb-8">
          <div class="grid grid-cols-2 gap-8 items-center">
            <div>
              <h2 class="text-2xl font-bold mb-4">Pengaturan</h2>
              <p class="text-white/90 mb-6">Personalisasi aplikasi sesuai kebutuhan Anda</p>
              <div class="bg-white/20 p-4 rounded-xl mb-6 backdrop-blur-sm">
                <h3 class="font-semibold mb-3">Status Akun</h3>
                <div class="flex items-center mb-2">
                  <div class="w-3 h-3 bg-green-400 rounded-full mr-3"></div>
                  <span class="font-medium">Akun Terverifikasi</span>
                </div>
                <p class="text-sm text-white/80">Level 2 • Member sejak Jan 2024</p>
              </div>
              <button class="bg-white text-luyu-blue font-semibold py-3 px-6 rounded-xl hover:shadow-lg transition-all" onclick="showModal('profile-settings-modal')">
              Edit Profile
              </button>
            </div>
            <div class="text-center">
              <div class="bg-white/10 p-6 rounded-2xl backdrop-blur-sm">
                <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <h3 class="text-lg font-semibold mb-1">Ahmad Santoso</h3>
                <p class="text-sm text-white/80 mb-3">ahmad.santoso@email.com</p>
                <div class="text-xs text-white/70">+62 812-3456-7890</div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-12 gap-8">
          <!-- MAIN SETTINGS -->
          <div class="col-span-8 space-y-6">
            <!-- ACCOUNT SETTINGS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Pengaturan Akun</h3>
              <div class="space-y-4">
                <!-- Profile Settings -->
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-all cursor-pointer" onclick="showModal('profile-settings-modal')">
                  <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-blue/10 rounded-xl flex items-center justify-center mr-4">
                      <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-semibold text-gray-800">Informasi Profil</h4>
                      <p class="text-sm text-gray-600">Kelola nama, email, dan foto profil</p>
                    </div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
                <!-- Security Settings -->
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-all cursor-pointer" onclick="showModal('security-settings-modal')">
                  <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-red/10 rounded-xl flex items-center justify-center mr-4">
                      <svg class="w-6 h-6 text-luyu-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-semibold text-gray-800">Keamanan & Privacy</h4>
                      <p class="text-sm text-gray-600">Password, 2FA, dan pengaturan privacy</p>
                    </div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
                <!-- Payment Settings -->
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-all cursor-pointer" onclick="showModal('payment-settings-modal')">
                  <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-green/10 rounded-xl flex items-center justify-center mr-4">
                      <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-semibold text-gray-800">Metode Pembayaran</h4>
                      <p class="text-sm text-gray-600">Kelola kartu dan e-wallet</p>
                    </div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
                <!-- Islamic Settings -->
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-all cursor-pointer" onclick="showModal('islamic-settings-modal')">
                  <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-gold/10 rounded-xl flex items-center justify-center mr-4">
                      <svg class="w-6 h-6 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-semibold text-gray-800">Pengaturan Syariah</h4>
                      <p class="text-sm text-gray-600">Qiblat, jadwal sholat, dan dzikir</p>
                    </div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
              </div>
            </div>
            <!-- APP PREFERENCES -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Preferensi Aplikasi</h3>
              <div class="space-y-6">
                <!-- Notifications -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-4">Notifikasi</h4>
                  <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                      <div>
                        <h5 class="font-medium text-gray-800">Push Notifications</h5>
                        <p class="text-sm text-gray-600">Terima notifikasi dari aplikasi</p>
                      </div>
                      <label class="switch">
                      <input type="checkbox" checked id="push-notifications">
                      <span class="slider"></span>
                      </label>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                      <div>
                        <h5 class="font-medium text-gray-800">Email Notifications</h5>
                        <p class="text-sm text-gray-600">Terima notifikasi via email</p>
                      </div>
                      <label class="switch switch-blue">
                      <input type="checkbox" checked id="email-notifications">
                      <span class="slider"></span>
                      </label>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                      <div>
                        <h5 class="font-medium text-gray-800">SMS Notifications</h5>
                        <p class="text-sm text-gray-600">Terima notifikasi via SMS</p>
                      </div>
                      <label class="switch switch-purple">
                      <input type="checkbox" id="sms-notifications">
                      <span class="slider"></span>
                      </label>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                      <div>
                        <h5 class="font-medium text-gray-800">Marketing Notifications</h5>
                        <p class="text-sm text-gray-600">Promosi dan penawaran khusus</p>
                      </div>
                      <label class="switch switch-gold">
                      <input type="checkbox" id="marketing-notifications">
                      <span class="slider"></span>
                      </label>
                    </div>
                  </div>
                </div>
                <!-- Theme & Display -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-4">Tampilan & Theme</h4>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Theme</label>
                      <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="app-theme">
                        <option value="light">Light Mode</option>
                        <option value="dark">Dark Mode</option>
                        <option value="auto">Auto (System)</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Ukuran Font</label>
                      <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="font-size">
                        <option value="small">Kecil</option>
                        <option value="medium" selected>Sedang</option>
                        <option value="large">Besar</option>
                        <option value="extra-large">Sangat Besar</option>
                      </select>
                    </div>
                  </div>
                </div>
                <!-- Language & Region -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-4">Bahasa & Wilayah</h4>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Bahasa</label>
                      <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="app-language">
                        <option value="id" selected>Bahasa Indonesia</option>
                        <option value="ar">العربية</option>
                        <option value="en">English</option>
                        <option value="ms">Bahasa Melayu</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Zona Waktu</label>
                      <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-blue focus:border-transparent" id="timezone">
                        <option value="wib" selected>WIB (Jakarta)</option>
                        <option value="wita">WITA (Makassar)</option>
                        <option value="wit">WIT (Jayapura)</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- DATA & STORAGE -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Data & Penyimpanan</h3>
              <div class="space-y-6">
                <!-- Storage Usage -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-4">Penggunaan Penyimpanan</h4>
                  <div class="space-y-3">
                    <div class="flex justify-between items-center">
                      <span class="text-gray-600">Cache Data</span>
                      <span class="font-semibold">45.2 MB</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill bg-luyu-blue" style="width: 15%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-gray-600">Offline Maps</span>
                      <span class="font-semibold">128.7 MB</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill bg-luyu-green" style="width: 43%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-gray-600">Downloaded Kajian</span>
                      <span class="font-semibold">2.3 GB</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill bg-luyu-purple" style="width: 77%"></div>
                    </div>
                  </div>
                  <div class="mt-4 flex space-x-3">
                    <button class="bg-luyu-red text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-luyu-red/90 transition-all" onclick="clearCache()">
                    Hapus Cache
                    </button>
                    <button class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-gray-50 transition-all" onclick="manageDownloads()">
                    Kelola Download
                    </button>
                  </div>
                </div>
                <!-- Auto Backup -->
                <div class="p-4 bg-luyu-blue/10 border border-luyu-blue/20 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h5 class="font-semibold text-gray-800">Auto Backup</h5>
                      <p class="text-sm text-gray-600">Backup otomatis data ke cloud</p>
                    </div>
                    <label class="switch switch-blue">
                    <input type="checkbox" checked id="auto-backup">
                    <span class="slider"></span>
                    </label>
                  </div>
                  <p class="text-xs text-gray-500">Terakhir backup: 30 Mei 2025, 23:45</p>
                </div>
                <!-- Data Export -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-4">Export Data</h4>
                  <div class="grid grid-cols-2 gap-4">
                    <button class="p-4 border border-gray-300 rounded-lg hover:shadow-md transition-all text-left" onclick="exportUserData()">
                      <div class="flex items-center mb-2">
                        <svg class="w-5 h-5 text-luyu-blue mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span class="font-semibold">Data Profil</span>
                      </div>
                      <p class="text-sm text-gray-600">Export informasi akun dan preferensi</p>
                    </button>
                    <button class="p-4 border border-gray-300 rounded-lg hover:shadow-md transition-all text-left" onclick="exportTransactionData()">
                      <div class="flex items-center mb-2">
                        <svg class="w-5 h-5 text-luyu-green mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span class="font-semibold">Data Transaksi</span>
                      </div>
                      <p class="text-sm text-gray-600">Export riwayat zakat, wakaf, dan trip</p>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- ACCESSIBILITY -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6">Aksesibilitas</h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div>
                    <h5 class="font-medium text-gray-800">Voice Navigation</h5>
                    <p class="text-sm text-gray-600">Navigasi dengan suara</p>
                  </div>
                  <label class="switch">
                  <input type="checkbox" id="voice-navigation">
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div>
                    <h5 class="font-medium text-gray-800">High Contrast</h5>
                    <p class="text-sm text-gray-600">Kontras tinggi untuk kemudahan baca</p>
                  </div>
                  <label class="switch switch-purple">
                  <input type="checkbox" id="high-contrast">
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div>
                    <h5 class="font-medium text-gray-800">Screen Reader</h5>
                    <p class="text-sm text-gray-600">Optimasi untuk pembaca layar</p>
                  </div>
                  <label class="switch switch-blue">
                  <input type="checkbox" id="screen-reader">
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div>
                    <h5 class="font-medium text-gray-800">Reduce Motion</h5>
                    <p class="text-sm text-gray-600">Kurangi animasi dan transisi</p>
                  </div>
                  <label class="switch switch-gold">
                  <input type="checkbox" id="reduce-motion">
                  <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <!-- SIDEBAR -->
          <div class="col-span-4 space-y-6">
            <!-- QUICK SETTINGS -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Pengaturan Cepat</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-sm">Mode Hemat Data</span>
                  <label class="switch">
                  <input type="checkbox" id="data-saver">
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-sm">GPS Tracking</span>
                  <label class="switch switch-blue">
                  <input type="checkbox" checked id="gps-tracking">
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-sm">Background Sync</span>
                  <label class="switch switch-green">
                  <input type="checkbox" checked id="background-sync">
                  <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-sm">Auto-Update</span>
                  <label class="switch switch-purple">
                  <input type="checkbox" checked id="auto-update">
                  <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>
            <!-- ACCOUNT INFO -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Informasi Akun</h3>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-gray-600">User ID</span>
                  <span class="font-semibold">LUYU-2024-001847</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Member Since</span>
                  <span class="font-semibold">15 Jan 2024</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Account Level</span>
                  <span class="font-semibold text-luyu-gold">Level 2</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Verification</span>
                  <span class="font-semibold text-green-600">Verified</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Total Trips</span>
                  <span class="font-semibold">127</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Pahala Points</span>
                  <span class="font-semibold text-luyu-purple">2,847</span>
                </div>
              </div>
            </div>
            <!-- APP INFO -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Informasi Aplikasi</h3>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-gray-600">Versi App</span>
                  <span class="font-semibold">2.4.1</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Build</span>
                  <span class="font-semibold">20250531</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Platform</span>
                  <span class="font-semibold">Web App</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Last Update</span>
                  <span class="font-semibold">30 Mei 2025</span>
                </div>
              </div>
              <div class="mt-4 pt-4 border-t border-gray-100">
                <button class="w-full bg-luyu-blue text-white py-2 rounded-lg text-sm font-semibold hover:bg-luyu-blue/90 transition-all" onclick="checkForUpdates()">
                Cek Update
                </button>
              </div>
            </div>
            <!-- HELP & SUPPORT -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Bantuan & Dukungan</h3>
              <div class="space-y-3">
                <button class="w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-all" onclick="showFAQ()">
                  <div class="flex items-center">
                    <svg class="w-5 h-5 text-luyu-blue mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span class="font-medium">FAQ</span>
                  </div>
                </button>
                <button class="w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-all" onclick="contactSupport()">
                  <div class="flex items-center">
                    <svg class="w-5 h-5 text-luyu-green mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                    <span class="font-medium">Hubungi Support</span>
                  </div>
                </button>
                <button class="w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-all" onclick="showModal('feedback-modal')">
                  <div class="flex items-center">
                    <svg class="w-5 h-5 text-luyu-purple mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                    </svg>
                    <span class="font-medium">Kirim Feedback</span>
                  </div>
                </button>
                <button class="w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-all" onclick="showPrivacyPolicy()">
                  <div class="flex items-center">
                    <svg class="w-5 h-5 text-luyu-gold mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                    <span class="font-medium">Privacy Policy</span>
                  </div>
                </button>
                <button class="w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-all" onclick="showTermsOfService()">
                  <div class="flex items-center">
                    <svg class="w-5 h-5 text-luyu-red mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="font-medium">Terms of Service</span>
                  </div>
                </button>
              </div>
            </div>
            <!-- DANGER ZONE -->
            <div class="bg-white rounded-2xl shadow-lg border border-red-200 p-6">
              <h3 class="text-lg font-bold text-red-600 mb-4">Danger Zone</h3>
              <div class="space-y-3">
                <button class="w-full bg-red-50 text-red-600 py-3 rounded-lg font-semibold hover:bg-red-100 transition-all" onclick="showModal('reset-settings-modal')">
                Reset Semua Pengaturan
                </button>
                <button class="w-full bg-red-100 text-red-700 py-3 rounded-lg font-semibold hover:bg-red-200 transition-all" onclick="showModal('deactivate-account-modal')">
                Nonaktifkan Akun
                </button>
                <button class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition-all" onclick="showModal('delete-account-modal')">
                Hapus Akun Permanen
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <script>
      // Global state management
      let currentPage = 'dashboard';
      let userData = {
      balance: 185000,
      infaqBalance: 35000,
      pahalaPoints: 230,
      totalTrips: 127,
      settings: {
          autoZakat: true,
          autoInfaq: true,
          balanceNotification: true
      }
      };
      
      // Driver data
      const driverData = {
          siti: {
              name: 'Ustadzah Siti',
              cluster: 'C',
              vehicle: 'Honda Beat',
              rating: 4.9,
              distance: '1.2 km',
              status: 'online',
              priority: true,
              earnings: 'Rp 125.000/hari',
              trips: 47,
              phone: '+62 812-3456-7890',
              joinDate: '15 Januari 2024'
          },
          ahmad: {
              name: 'Pak Ahmad',
              cluster: 'C',
              vehicle: 'Yamaha Mio',
              rating: 4.8,
              distance: '1.8 km',
              status: 'online',
              priority: true,
              earnings: 'Rp 118.000/hari',
              trips: 52,
              phone: '+62 813-2345-6789',
              joinDate: '3 Februari 2024'
          },
          budi: {
              name: 'Budi',
              cluster: 'A',
              vehicle: 'Honda Vario',
              rating: 4.7,
              distance: '2.1 km',
              status: 'online',
              priority: false,
              earnings: 'Rp 285.000/hari',
              trips: 128,
              phone: '+62 814-3456-7890',
              joinDate: '10 Desember 2023'
          },
          driver1: { name: 'Driver 1', cluster: 'A', vehicle: 'Honda', rating: 4.5, distance: '3.2 km', status: 'online', priority: false, trips: 34 },
          driver2: { name: 'Driver 2', cluster: 'A', vehicle: 'Yamaha', rating: 4.6, distance: '2.8 km', status: 'online', priority: false, trips: 28 },
          driver3: { name: 'Driver 3', cluster: 'A', vehicle: 'Suzuki', rating: 4.4, distance: '4.1 km', status: 'online', priority: false, trips: 41 },
          driver4: { name: 'Driver 4', cluster: 'B', vehicle: 'Honda', rating: 4.7, distance: '1.9 km', status: 'online', priority: false, trips: 67 },
          driver5: { name: 'Driver 5', cluster: 'B', vehicle: 'Yamaha', rating: 4.8, distance: '2.3 km', status: 'online', priority: false, trips: 53 },
          driver8: { name: 'Driver 8', cluster: 'C', vehicle: 'Honda', rating: 4.9, distance: '1.5 km', status: 'online', priority: true, trips: 72 },
          driver9: { name: 'Driver 9', cluster: 'C', vehicle: 'Yamaha', rating: 4.8, distance: '2.0 km', status: 'online', priority: true, trips: 48 },
          moving1: { name: 'Moving Driver', cluster: 'C', vehicle: 'Honda', rating: 4.7, distance: '1.8 km', status: 'busy', priority: true, trips: 35 }
      };
      
      // Orders data
      const ordersData = {
          'ORD001': {
              id: 'ORD001',
              status: 'ongoing',
              from: 'Jl. Sudirman',
              to: 'Masjid Al-Barokah',
              driver: 'Ustadzah Siti',
              vehicle: 'Honda Beat',
              cluster: 'C',
              price: 15000,
              time: '30 Mei 2025, 14:30',
              progress: 75,
              eta: '8 menit'
          },
          'ORD002': {
              id: 'ORD002',
              status: 'completed',
              from: 'Rumah',
              to: 'Pasar Tradisional',
              driver: 'Pak Ahmad',
              vehicle: 'Yamaha Mio',
              cluster: 'C',
              price: 12500,
              time: '30 Mei 2025, 13:15',
              progress: 100,
              eta: 'Selesai'
          },
          'ORD003': {
              id: 'ORD003',
              status: 'pending',
              from: 'Plaza Indonesia',
              to: 'Kemang',
              driver: null,
              vehicle: null,
              cluster: 'A',
              price: 25000,
              time: '30 Mei 2025, 15:45',
              progress: 20,
              eta: '5 menit'
          },
          'ORD004': {
              id: 'ORD004',
              status: 'pickup',
              from: 'Bandung Station',
              to: 'Dago',
              driver: 'Bu Fatimah',
              vehicle: 'Honda Scoopy',
              cluster: 'B',
              price: 18000,
              time: '30 Mei 2025, 15:20',
              progress: 45,
              eta: 'Driver menuju lokasi'
          },
          'ORD005': {
              id: 'ORD005',
              status: 'cancelled',
              from: 'Tangerang Mall',
              to: 'BSD',
              driver: null,
              vehicle: null,
              cluster: 'C',
              price: 22000,
              time: '30 Mei 2025, 12:00',
              progress: 0,
              eta: 'Dibatalkan'
          }
      };
      
      // Charts instances
      let revenueChart = null;
      let clusterCharts = {};
      let impactChart = null;
      
      // Page management
      function showPage(pageId) {
      try {
      currentPage = pageId;
      
      document.querySelectorAll('.sidebar-item').forEach(item => {
      item.classList.remove('bg-luyu-green/10', 'text-luyu-green');
      item.classList.add('text-gray-700');
      });
      
      const activeItem = document.querySelector(`[data-page="${pageId}"]`);
      if (activeItem) {
      activeItem.classList.remove('text-gray-700');
      activeItem.classList.add('bg-luyu-green/10', 'text-luyu-green');
      }
      
      updatePageHeader(pageId);
      loadPageContent(pageId);
      
      // Close mobile sidebar after navigation
      if (window.innerWidth <= 1024) {
      setTimeout(() => {
          closeMobileSidebar();
      }, 100);
      }
      } catch (error) {
      console.error('Error in showPage:', error);
      showNotification('Terjadi kesalahan saat memuat halaman', 'error');
      }
      }
      
      function updatePageHeader(pageId) {
          try {
              const titles = {
                  dashboard: { title: "Assalamu'alaikum, Ahmad!", subtitle: "Semoga hari ini penuh berkah dan kebaikan" },
                  maps: { title: "Peta Cluster", subtitle: "Monitoring driver dan wilayah real-time" },
                  orders: { title: "Kelola Pesanan", subtitle: "Pantau dan kelola semua pesanan Anda" },
                  wallet: { title: "Dompet Syariah", subtitle: "Kelola keuangan dengan prinsip syariah" },
                  analytics: { title: "Analitik & Laporan", subtitle: "Insight mendalam untuk bisnis yang lebih baik" },
                  zakat: { title: "Zakat & Infaq", subtitle: "Berbagi rezeki dengan sesama" },
                  wakaf: { title: "Wakaf Digital", subtitle: "Investasi akhirat yang berkelanjutan" },
                  kajian: { title: "Kajian Online", subtitle: "Menambah ilmu agama bersama para ustadz" },
                  settings: { title: "Pengaturan", subtitle: "Personalisasi aplikasi sesuai kebutuhan" }
              };
      
              const pageInfo = titles[pageId] || { title: "LUYU Platform", subtitle: "Ojol Syariah Terpercaya" };
              
              const titleElement = document.getElementById('page-title');
              const subtitleElement = document.getElementById('page-subtitle');
              
              if (titleElement) titleElement.textContent = pageInfo.title;
              if (subtitleElement) subtitleElement.textContent = pageInfo.subtitle;
          } catch (error) {
              console.error('Error in updatePageHeader:', error);
          }
      }
      
      function loadPageContent(pageId) {
          try {
              const contentArea = document.getElementById('main-content');
              const template = document.getElementById(`${pageId}-template`);
              
              if (template && contentArea) {
                  contentArea.innerHTML = template.innerHTML;
                  
                  // Initialize page-specific functionality
                  switch(pageId) {
                      case 'analytics':
                          setTimeout(() => initializeAnalytics(), 100);
                          break;
                      case 'wallet':
                          setTimeout(() => initializeWalletEvents(), 100);
                          break;
                      case 'maps':
                          setTimeout(() => initializeMapEvents(), 100);
                          break;
                      case 'orders':
                          setTimeout(() => initializeOrdersEvents(), 100);
                          break;
                      default:
                          break;
                  }
              } else {
                  if (contentArea) {
                      contentArea.innerHTML = generateFallbackContent(pageId);
                  }
              }
          } catch (error) {
              console.error('Error in loadPageContent:', error);
              showNotification('Gagal memuat konten halaman', 'error');
          }
      }
      
      function generateFallbackContent(pageId) {
          return `
              <div class="animate-fade-in">
                  <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 text-center">
                      <div class="w-20 h-20 bg-luyu-green/10 rounded-full mx-auto mb-4 flex items-center justify-center">
                          <svg class="w-10 h-10 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                          </svg>
                      </div>
                      <h2 class="text-2xl font-bold text-gray-800 mb-4">Halaman ${pageId.charAt(0).toUpperCase() + pageId.slice(1)}</h2>
                      <p class="text-gray-600 mb-6">Fitur ini sedang dalam pengembangan dan akan segera tersedia.</p>
                      <button class="bg-luyu-green text-white px-6 py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showPage('dashboard')">
                          Kembali ke Dashboard
                      </button>
                  </div>
              </div>
          `;
      }
      
      // Analytics functionality
      function initializeAnalytics() {
          try {
              initializeCharts();
              startAnalyticsUpdates();
          } catch (error) {
              console.error('Error in initializeAnalytics:', error);
          }
      }
      
      function initializeCharts() {
          try {
              // Revenue Chart
              const revenueCtx = document.getElementById('revenue-chart');
              if (revenueCtx && typeof Chart !== 'undefined') {
                  if (revenueChart) {
                      revenueChart.destroy();
                  }
                  
                  revenueChart = new Chart(revenueCtx, {
                      type: 'line',
                      data: {
                          labels: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'],
                          datasets: [{
                              label: 'Revenue (Juta)',
                              data: [1.2, 1.9, 3.0, 5.0, 2.0, 3.0, 4.5],
                              borderColor: '#2ecc71',
                              backgroundColor: 'rgba(46, 204, 113, 0.1)',
                              tension: 0.4,
                              fill: true
                          }, {
                              label: 'Zakat (Juta)',
                              data: [0.03, 0.048, 0.075, 0.125, 0.05, 0.075, 0.113],
                              borderColor: '#f1c40f',
                              backgroundColor: 'rgba(241, 196, 15, 0.1)',
                              tension: 0.4,
                              fill: true
                          }]
                      },
                      options: {
                          responsive: true,
                          maintainAspectRatio: false,
                          plugins: {
                              legend: {
                                  display: true,
                                  position: 'top'
                              },
                              tooltip: {
                                  mode: 'index',
                                  intersect: false,
                                  callbacks: {
                                      label: function(context) {
                                          return context.dataset.label + ': Rp ' + context.parsed.y + 'M';
                                      }
                                  }
                              }
                          },
                          scales: {
                              x: {
                                  display: true,
                                  title: {
                                      display: true,
                                      text: 'Hari'
                                  }
                              },
                              y: {
                                  display: true,
                                  title: {
                                      display: true,
                                      text: 'Jumlah (Juta Rupiah)'
                                  },
                                  ticks: {
                                      callback: function(value) {
                                          return 'Rp ' + value + 'M';
                                      }
                                  }
                              }
                          }
                      }
                  });
              }
      
              // Cluster Performance Charts
              const clusters = ['a', 'b', 'c'];
              const clusterData = [85, 72, 95];
              const clusterColors = ['#3498db', '#f39c12', '#2ecc71'];
              const clusterLabels = ['Jakarta', 'Bandung', 'Banten'];
              
              clusters.forEach((cluster, index) => {
                  const ctx = document.getElementById(`cluster-${cluster}-chart`);
                  if (ctx && typeof Chart !== 'undefined') {
                      if (clusterCharts[cluster]) {
                          clusterCharts[cluster].destroy();
                      }
                      
                      clusterCharts[cluster] = new Chart(ctx, {
                          type: 'doughnut',
                          data: {
                              datasets: [{
                                  data: [clusterData[index], 100 - clusterData[index]],
                                  backgroundColor: [clusterColors[index], '#f3f4f6'],
                                  borderWidth: 0,
                                  cutout: '70%'
                              }]
                          },
                          options: {
                              responsive: true,
                              maintainAspectRatio: false,
                              plugins: {
                                  legend: {
                                      display: false
                                  },
                                  tooltip: {
                                      callbacks: {
                                          label: function(context) {
                                              if (context.dataIndex === 0) {
                                                  return `${clusterLabels[index]}: ${clusterData[index]}%`;
                                              }
                                              return '';
                                          }
                                      }
                                  }
                              }
                          },
                          plugins: [{
                              beforeDraw: function(chart) {
                                  const ctx = chart.ctx;
                                  ctx.save();
                                  const fontSize = Math.max(chart.height / 8, 12);
                                  ctx.font = fontSize + "px sans-serif";
                                  ctx.textBaseline = "middle";
                                  ctx.fillStyle = clusterColors[index];
                                  
                                  const text = clusterData[index] + "%";
                                  const textX = Math.round((chart.width - ctx.measureText(text).width) / 2);
                                  const textY = chart.height / 2;
                                  
                                  ctx.fillText(text, textX, textY);
                                  ctx.restore();
                              }
                          }]
                      });
                  }
              });
      
              // Impact Chart
              const impactCtx = document.getElementById('impact-chart');
              if (impactCtx && typeof Chart !== 'undefined') {
                  if (impactChart) {
                      impactChart.destroy();
                  }
                  
                  impactChart = new Chart(impactCtx, {
                      type: 'bar',
                      data: {
                          labels: ['Driver Terbantu', 'Zakat Disalurkan', 'Wakaf Terkumpul', 'Mustahiq Dibantu'],
                          datasets: [{
                              label: 'Impact Metrics',
                              data: [1247, 4800000, 1200000, 2847],
                              backgroundColor: ['#2ecc71', '#f1c40f', '#9b59b6', '#3498db'],
                              borderColor: ['#27ae60', '#f39c12', '#8e44ad', '#2980b9'],
                              borderWidth: 1
                          }]
                      },
                      options: {
                          responsive: true,
                          maintainAspectRatio: false,
                          plugins: {
                              legend: {
                                  display: false
                              },
                              tooltip: {
                                  callbacks: {
                                      label: function(context) {
                                          const label = context.label;
                                          const value = context.parsed.y;
                                          
                                          if (label.includes('Zakat') || label.includes('Wakaf')) {
                                              return label + ': Rp ' + (value / 1000000).toFixed(1) + 'M';
                                          }
                                          return label + ': ' + value.toLocaleString();
                                      }
                                  }
                              }
                          },
                          scales: {
                              y: {
                                  beginAtZero: true,
                                  ticks: {
                                      callback: function(value) {
                                          if (value >= 1000000) {
                                              return 'Rp ' + (value / 1000000) + 'M';
                                          } else if (value >= 1000) {
                                              return (value / 1000) + 'K';
                                          }
                                          return value;
                                      }
                                  }
                              }
                          }
                      }
                  });
              }
          } catch (error) {
              console.error('Error in initializeCharts:', error);
          }
      }
      
      function startAnalyticsUpdates() {
          try {
              // Update real-time stats every 5 seconds
              setInterval(() => {
                  updateAnalyticsStats();
              }, 5000);
          } catch (error) {
              console.error('Error in startAnalyticsUpdates:', error);
          }
      }
      
      function updateAnalyticsStats() {
          try {
              const ordersToday = document.getElementById('orders-today');
              const activeDrivers = document.getElementById('active-drivers');
              
              if (ordersToday) {
                  const currentOrders = parseInt(ordersToday.textContent.replace(/[^\d]/g, ''));
                  const newOrders = currentOrders + Math.floor(Math.random() * 3);
                  ordersToday.textContent = newOrders.toLocaleString();
              }
              
              if (activeDrivers) {
                  const currentDrivers = parseInt(activeDrivers.textContent.replace(/[^\d]/g, ''));
                  const variation = Math.floor(Math.random() * 10) - 5;
                  const newDrivers = Math.max(1200, currentDrivers + variation);
                  activeDrivers.textContent = newDrivers.toLocaleString();
              }
          } catch (error) {
              console.error('Error in updateAnalyticsStats:', error);
          }
      }
      
      // Orders functionality
      function initializeOrdersEvents() {
          try {
              updateOrdersList();
              startOrdersUpdates();
          } catch (error) {
              console.error('Error in initializeOrdersEvents:', error);
          }
      }
      
      function updateOrdersList() {
          try {
              const ordersList = document.getElementById('orders-list');
              if (!ordersList) return;
      
              // Orders list is already populated in template
              // This function can be used to refresh the list dynamically
          } catch (error) {
              console.error('Error in updateOrdersList:', error);
          }
      }
      
      function showOrderDetail(orderId) {
          try {
              const order = ordersData[orderId];
              if (!order) {
                  showNotification('Data pesanan tidak ditemukan', 'error');
                  return;
              }
      
              const modal = document.getElementById('order-detail-modal');
              const content = document.getElementById('order-detail-content');
              
              if (!modal || !content) {
                  console.error('Order detail modal elements not found');
                  return;
              }
      
              const statusColors = {
                  pending: 'luyu-gold',
                  confirmed: 'luyu-blue',
                  pickup: 'luyu-purple',
                  ongoing: 'orange-500',
                  completed: 'luyu-green',
                  cancelled: 'luyu-red'
              };
      
              const statusTexts = {
                  pending: 'Menunggu Driver',
                  confirmed: 'Dikonfirmasi',
                  pickup: 'Penjemputan',
                  ongoing: 'Dalam Perjalanan',
                  completed: 'Selesai',
                  cancelled: 'Dibatalkan'
              };
      
              content.innerHTML = `
                  <div class="space-y-6">
                      <!-- Order Header -->
                      <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                          <div>
                              <h3 class="text-xl font-bold text-gray-800">${order.id}</h3>
                              <span class="status-${order.status} px-3 py-1 rounded-full text-sm font-semibold">${statusTexts[order.status]}</span>
                          </div>
                          <div class="text-right">
                              <p class="text-2xl font-bold text-gray-800">Rp ${order.price.toLocaleString()}</p>
                              <p class="text-sm text-gray-500">${order.time}</p>
                          </div>
                      </div>
      
                      <!-- Route Details -->
                      <div class="space-y-4">
                          <div class="flex items-center">
                              <div class="w-4 h-4 bg-luyu-green rounded-full mr-4"></div>
                              <div>
                                  <p class="font-semibold text-gray-800">Lokasi Penjemputan</p>
                                  <p class="text-gray-600">${order.from}</p>
                              </div>
                          </div>
                          <div class="border-l-2 border-gray-300 ml-2 h-8"></div>
                          <div class="flex items-center">
                              <div class="w-4 h-4 bg-luyu-red rounded-full mr-4"></div>
                              <div>
                                  <p class="font-semibold text-gray-800">Tujuan</p>
                                  <p class="text-gray-600">${order.to}</p>
                              </div>
                          </div>
                      </div>
      
                      ${order.driver ? `
                      <!-- Driver Info -->
                      <div class="p-4 bg-luyu-green/10 rounded-lg">
                          <h4 class="font-semibold text-gray-800 mb-3">Informasi Driver</h4>
                          <div class="flex items-center">
                              <div class="w-12 h-12 bg-luyu-green/20 rounded-full flex items-center justify-center mr-4">
                                  <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                  </svg>
                              </div>
                              <div>
                                  <p class="font-semibold text-gray-800">${order.driver}</p>
                                  <p class="text-sm text-gray-600">${order.vehicle} • Cluster ${order.cluster}</p>
                              </div>
                          </div>
                      </div>
                      ` : ''}
      
                      <!-- Progress -->
                      <div>
                          <h4 class="font-semibold text-gray-800 mb-3">Progress Pesanan</h4>
                          <div class="progress-bar">
                              <div class="progress-fill bg-${statusColors[order.status]}" style="width: ${order.progress}%"></div>
                          </div>
                          <p class="text-sm text-gray-600 mt-2">${order.eta}</p>
                      </div>
      
                      <!-- Actions -->
                      <div class="flex space-x-3">
                          ${order.status === 'ongoing' || order.status === 'pickup' ? `
                          <button class="flex-1 bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="trackOrder('${order.id}')">
                              Lacak Pesanan
                          </button>
                          ` : ''}
                          ${order.status === 'pending' ? `
                          <button class="flex-1 bg-luyu-red text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="cancelOrder('${order.id}')">
                              Batalkan Pesanan
                          </button>
                          ` : ''}
                          ${order.status === 'completed' ? `
                          <button class="flex-1 bg-luyu-green text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="rateOrder('${order.id}')">
                              Beri Rating
                          </button>
                          ` : ''}
                          <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="closeModal('order-detail-modal')">
                              Tutup
                          </button>
                      </div>
                  </div>
              `;
              
              showModal('order-detail-modal');
          } catch (error) {
              console.error('Error in showOrderDetail:', error);
              showNotification('Gagal memuat detail pesanan', 'error');
          }
      }
      
      function filterOrders(type, value) {
          try {
              console.log(`Filtering orders by ${type}: ${value}`);
              // Implement filter logic here
              showNotification(`Filter ${type}: ${value}`, 'info');
          } catch (error) {
              console.error('Error in filterOrders:', error);
          }
      }
      
      function searchOrders(query) {
          try {
              if (query.length > 2) {
                  console.log('Searching orders:', query);
                  showNotification(`Mencari pesanan: "${query}"`, 'info');
              }
          } catch (error) {
              console.error('Error in searchOrders:', error);
          }
      }
      
      function refreshOrders() {
          try {
              showLoading();
              setTimeout(() => {
                  hideLoading();
                  updateOrdersList();
                  showNotification('Data pesanan berhasil diperbarui', 'success');
              }, 1500);
          } catch (error) {
              console.error('Error in refreshOrders:', error);
              hideLoading();
              showNotification('Gagal memperbarui data pesanan', 'error');
          }
      }
      
      function trackOrder(orderId) {
          try {
              closeModal('order-detail-modal');
              showPage('maps');
              showNotification(`Melacak pesanan ${orderId}`, 'info');
          } catch (error) {
              console.error('Error in trackOrder:', error);
          }
      }
      
      function cancelOrder(orderId) {
          try {
              if (confirm('Apakah Anda yakin ingin membatalkan pesanan ini?')) {
                  ordersData[orderId].status = 'cancelled';
                  ordersData[orderId].progress = 0;
                  ordersData[orderId].eta = 'Dibatalkan';
                  
                  closeModal('order-detail-modal');
                  showNotification(`Pesanan ${orderId} berhasil dibatalkan`, 'success');
                  
                  if (currentPage === 'orders') {
                      updateOrdersList();
                  }
              }
          } catch (error) {
              console.error('Error in cancelOrder:', error);
              showNotification('Gagal membatalkan pesanan', 'error');
          }
      }
      
      function rateOrder(orderId) {
          try {
              closeModal('order-detail-modal');
              showNotification('Fitur rating akan segera tersedia', 'info');
          } catch (error) {
              console.error('Error in rateOrder:', error);
          }
      }
      
      function startOrdersUpdates() {
          try {
              // Update orders status every 10 seconds
              setInterval(() => {
                  updateOrdersProgress();
              }, 10000);
          } catch (error) {
              console.error('Error in startOrdersUpdates:', error);
          }
      }
      
      function updateOrdersProgress() {
          try {
              // Simulate order progress updates
              Object.keys(ordersData).forEach(orderId => {
                  const order = ordersData[orderId];
                  if (order.status === 'ongoing' || order.status === 'pickup') {
                      const progressIncrease = Math.random() * 10;
                      order.progress = Math.min(100, order.progress + progressIncrease);
                      
                      if (order.progress >= 100 && order.status === 'ongoing') {
                          order.status = 'completed';
                          order.eta = 'Selesai';
                          showNotification(`Pesanan ${orderId} telah selesai`, 'success');
                      }
                  }
              });
          } catch (error) {
              console.error('Error in updateOrdersProgress:', error);
          }
      }
      
      // Driver detail functionality
      function showDriverDetail(driverId) {
          try {
              const driver = driverData[driverId];
              if (!driver) {
                  showNotification('Data driver tidak ditemukan', 'error');
                  return;
              }
      
              const panel = document.getElementById('driver-panel');
              const content = document.getElementById('driver-detail-content');
              
              if (!panel || !content) {
                  console.error('Driver panel elements not found');
                  return;
              }
              
              const clusterColors = {
                  'A': 'luyu-blue',
                  'B': 'orange-500', 
                  'C': 'luyu-green'
              };
              
              const clusterColor = clusterColors[driver.cluster] || 'luyu-gray';
              
              content.innerHTML = `
                  <div class="space-y-6">
                      <!-- Driver Header -->
                      <div class="text-center">
                          <div class="w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                              <svg class="w-10 h-10 text-${clusterColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                              </svg>
                          </div>
                          <h3 class="text-xl font-bold text-gray-800">${driver.name}</h3>
                          <div class="flex items-center justify-center mt-2 space-x-2">
                              <span class="bg-${clusterColor} text-white px-2 py-1 rounded-full text-xs font-bold">Cluster ${driver.cluster}</span>
                              ${driver.priority ? '<span class="bg-luyu-gold text-white px-2 py-1 rounded-full text-xs font-bold">Prioritas</span>' : ''}
                          </div>
                      </div>
      
                      <!-- Driver Stats -->
                      <div class="grid grid-cols-2 gap-4">
                          <div class="bg-gray-50 p-3 rounded-lg text-center">
                              <p class="text-2xl font-bold" style="color: #${clusterColor === 'luyu-blue' ? '3498db' : clusterColor === 'luyu-green' ? '2ecc71' : 'f39c12'}">${driver.rating || 'N/A'}</p>
                              <p class="text-xs text-gray-600">Rating</p>
                          </div>
                          <div class="bg-gray-50 p-3 rounded-lg text-center">
                              <p class="text-2xl font-bold text-gray-800">${driver.trips || 'N/A'}</p>
                              <p class="text-xs text-gray-600">Total Trip</p>
                          </div>
                      </div>
      
                      <!-- Driver Info -->
                      <div class="space-y-3">
                          <div class="flex justify-between">
                              <span class="text-gray-600">Kendaraan</span>
                              <span class="font-semibold">${driver.vehicle || 'N/A'}</span>
                          </div>
                          <div class="flex justify-between">
                              <span class="text-gray-600">Jarak</span>
                              <span class="font-semibold" style="color: #${clusterColor === 'luyu-blue' ? '3498db' : clusterColor === 'luyu-green' ? '2ecc71' : 'f39c12'}">${driver.distance || 'N/A'}</span>
                          </div>
                          <div class="flex justify-between">
                              <span class="text-gray-600">Pendapatan Harian</span>
                              <span class="font-semibold">${driver.earnings || 'N/A'}</span>
                          </div>
                          <div class="flex justify-between">
                              <span class="text-gray-600">Status</span>
                              <span class="bg-luyu-green text-white px-2 py-1 rounded-full text-xs font-semibold">
                                  ${driver.status === 'online' ? 'Online' : driver.status === 'busy' ? 'Sibuk' : 'Offline'}
                              </span>
                          </div>
                          ${driver.phone ? `
                          <div class="flex justify-between">
                              <span class="text-gray-600">Telepon</span>
                              <span class="font-semibold">${driver.phone}</span>
                          </div>
                          ` : ''}
                          ${driver.joinDate ? `
                          <div class="flex justify-between">
                              <span class="text-gray-600">Bergabung</span>
                              <span class="font-semibold">${driver.joinDate}</span>
                          </div>
                          ` : ''}
                      </div>
      
                      <!-- Bagi Hasil Info -->
                      <div class="bg-gray-50 border-l-4 border-${clusterColor} rounded-lg p-4">
                          <h4 class="font-semibold text-gray-800 mb-2">Informasi Bagi Hasil</h4>
                          <div class="text-sm text-gray-600">
                              ${driver.cluster === 'C' ? 
                                  '<p>Driver mendapat <span class="font-bold text-luyu-green">90%</span> dari total tarif</p><p class="mt-1">Platform hanya mengambil 10% untuk operasional</p>' : 
                                  driver.cluster === 'B' ? 
                                  '<p>Driver mendapat <span class="font-bold text-orange-500">80%</span> dari total tarif</p><p class="mt-1">Platform mengambil 20% untuk operasional</p>' :
                                  '<p>Driver mendapat <span class="font-bold text-luyu-blue">70%</span> dari total tarif</p><p class="mt-1">Platform mengambil 30% untuk operasional</p>'
                              }
                          </div>
                      </div>
      
                      <!-- Actions -->
                      <div class="space-y-3">
                          <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="bookDriver('${driverId}')">
                              Pesan ${driver.name}
                          </button>
                          <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="sendInfaq('${driverId}')">
                              Kirim Infaq Langsung
                          </button>
                          ${driver.phone ? `
                          <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="callDriver('${driver.phone}')">
                              Hubungi Driver
                          </button>
                          ` : ''}
                      </div>
                  </div>
              `;
              
              panel.classList.add('active');
          } catch (error) {
              console.error('Error in showDriverDetail:', error);
              showNotification('Gagal memuat detail driver', 'error');
          }
      }
      
      function closeDriverPanel() {
          try {
              const panel = document.getElementById('driver-panel');
              if (panel) {
                  panel.classList.remove('active');
              }
          } catch (error) {
              console.error('Error in closeDriverPanel:', error);
          }
      }
      
      // Driver actions
      function bookDriver(driverId) {
          try {
              const driver = driverData[driverId];
              if (driver) {
                  closeDriverPanel();
                  showOrderModal();
                  showNotification(`Driver ${driver.name} dipilih untuk pesanan Anda`, 'success');
              }
          } catch (error) {
              console.error('Error in bookDriver:', error);
              showNotification('Gagal memesan driver', 'error');
          }
      }
      
      function sendInfaq(driverId) {
          try {
              const driver = driverData[driverId];
              if (driver) {
                  closeDriverPanel();
                  showNotification(`Infaq Rp 5.000 berhasil dikirim ke ${driver.name}`, 'success');
                  userData.infaqBalance += 5000;
              }
          } catch (error) {
              console.error('Error in sendInfaq:', error);
              showNotification('Gagal mengirim infaq', 'error');
          }
      }
      
      function callDriver(phone) {
          try {
              showNotification(`Menghubungkan ke ${phone}...`, 'info');
              setTimeout(() => {
                  showNotification('Panggilan dimulai', 'success');
              }, 2000);
          } catch (error) {
              console.error('Error in callDriver:', error);
              showNotification('Gagal menghubungi driver', 'error');
          }
      }
      
      // Map functionality
      function initializeMapEvents() {
          try {
              document.querySelectorAll('.driver-marker').forEach(marker => {
                  marker.addEventListener('mouseenter', function(e) {
                      showTooltip(e, this.getAttribute('data-driver'));
                  });
                  
                  marker.addEventListener('mouseleave', function() {
                      hideTooltip();
                  });
              });
      
              startLiveActivityUpdates();
          } catch (error) {
              console.error('Error in initializeMapEvents:', error);
          }
      }
      
      function showTooltip(event, driverId) {
          try {
              const driver = driverData[driverId];
              if (!driver) return;
              
              const tooltip = document.getElementById('tooltip');
              if (tooltip) {
                  tooltip.innerHTML = `<strong>${driver.name}</strong><br>${driver.vehicle} • ⭐ ${driver.rating}`;
                  tooltip.style.left = event.pageX + 10 + 'px';
                  tooltip.style.top = event.pageY - 30 + 'px';
                  tooltip.classList.add('show');
              }
          } catch (error) {
              console.error('Error in showTooltip:', error);
          }
      }
      
      function hideTooltip() {
          try {
              const tooltip = document.getElementById('tooltip');
              if (tooltip) {
                  tooltip.classList.remove('show');
              }
          } catch (error) {
              console.error('Error in hideTooltip:', error);
          }
      }
      
      function selectCluster(cluster) {
          try {
              const clusterNames = { a: 'Jakarta', b: 'Bandung', c: 'Banten' };
              const clusterColors = { a: '#3498db', b: '#f39c12', c: '#2ecc71' };
              const clusterRatios = { a: '70:30', b: '80:20', c: '90:10' };
              
              const info = document.getElementById('cluster-info');
              const content = document.getElementById('cluster-info-content');
              
              if (info && content) {
                  content.innerHTML = `
                      <h4 class="font-bold text-gray-800 mb-3">Cluster ${cluster.toUpperCase()} - ${clusterNames[cluster]}</h4>
                      <div class="space-y-2 text-sm">
                          <div class="flex justify-between">
                              <span>Bagi Hasil:</span>
                              <span class="font-bold" style="color: ${clusterColors[cluster]}">${clusterRatios[cluster]}</span>
                          </div>
                          <div class="flex justify-between">
                              <span>Driver Online:</span>
                              <span class="font-bold">${cluster === 'a' ? '342' : cluster === 'b' ? '198' : '707'}</span>
                          </div>
                          <div class="flex justify-between">
                              <span>Rata-rata Pendapatan:</span>
                              <span class="font-bold">${cluster === 'a' ? 'Rp 285K' : cluster === 'b' ? 'Rp 195K' : 'Rp 125K'}</span>
                          </div>
                      </div>
                      <button class="mt-3 w-full text-white py-2 rounded-lg text-sm font-semibold" style="background-color: ${clusterColors[cluster]}" onclick="focusCluster('${cluster}')">
                          Focus ke Cluster ${cluster.toUpperCase()}
                      </button>
                  `;
                  
                  info.classList.remove('hidden');
                  
                  setTimeout(() => {
                      info.classList.add('hidden');
                  }, 5000);
              }
          } catch (error) {
              console.error('Error in selectCluster:', error);
          }
      }
      
      function focusCluster(cluster) {
          try {
              if (cluster === '') {
                  showNotification('Menampilkan semua cluster', 'info');
                  return;
              }
              
              const clusterNames = { a: 'Jakarta', b: 'Bandung', c: 'Banten' };
              showNotification(`Focus ke Cluster ${cluster.toUpperCase()} - ${clusterNames[cluster]}`, 'info');
              
              console.log(`Focusing on cluster ${cluster}`);
          } catch (error) {
              console.error('Error in focusCluster:', error);
          }
      }
      
      function toggleDriverVisibility(type) {
          try {
              console.log(`Toggling ${type} drivers visibility`);
              showNotification(`${type === 'online' ? 'Driver Online' : type === 'offline' ? 'Driver Offline' : 'Driver Prioritas Syariah'} visibility toggled`, 'info');
          } catch (error) {
              console.error('Error in toggleDriverVisibility:', error);
          }
      }
      
      function updateSearchRadius(value) {
          try {
              const radiusElement = document.getElementById('radius-value');
              if (radiusElement) {
                  radiusElement.textContent = `${value} km`;
              }
              console.log(`Search radius updated to ${value} km`);
          } catch (error) {
              console.error('Error in updateSearchRadius:', error);
          }
      }
      
      function refreshMap() {
          try {
              showLoading();
              setTimeout(() => {
                  hideLoading();
                  showNotification('Peta berhasil diperbarui', 'success');
                  updateLiveActivity();
              }, 1500);
          } catch (error) {
              console.error('Error in refreshMap:', error);
              hideLoading();
              showNotification('Gagal memperbarui peta', 'error');
          }
      }
      
      function zoomIn() {
          console.log('Zooming in...');
          showNotification('Zoom in', 'info');
      }
      
      function zoomOut() {
          console.log('Zooming out...');
          showNotification('Zoom out', 'info');
      }
      
      function centerMap() {
          console.log('Centering map...');
          showNotification('Peta dikembalikan ke pusat', 'info');
      }
      
      function startLiveActivityUpdates() {
          try {
              const activities = [
                  { driver: 'Ustadzah Siti', action: 'Menuju pickup', color: 'luyu-green' },
                  { driver: 'Pak Ahmad', action: 'Dalam perjalanan', color: 'luyu-blue' },
                  { driver: 'Bu Fatimah', action: 'Selesai trip', color: 'luyu-gold' },
                  { driver: 'Ustadz Hasan', action: 'Menunggu pesanan', color: 'luyu-purple' },
                  { driver: 'Pak Budi', action: 'Pickup passenger', color: 'luyu-red' }
              ];
      
              let currentIndex = 0;
              
              setInterval(() => {
                  updateLiveActivity(activities[currentIndex]);
                  currentIndex = (currentIndex + 1) % activities.length;
              }, 3000);
          } catch (error) {
              console.error('Error in startLiveActivityUpdates:', error);
          }
      }
      
      function updateLiveActivity(activity = null) {
          try {
              const container = document.getElementById('live-activity');
              if (!container) return;
      
              if (activity) {
                  const newActivity = document.createElement('div');
                  newActivity.className = 'flex items-center notification-enter';
                  newActivity.innerHTML = `
                      <div class="w-2 h-2 bg-${activity.color} rounded-full mr-2 animate-pulse"></div>
                      <span>${activity.driver} - ${activity.action}</span>
                  `;
                  
                  container.insertBefore(newActivity, container.firstChild);
                  
                  if (container.children.length > 3) {
                      container.removeChild(container.lastChild);
                  }
              }
          } catch (error) {
              console.error('Error in updateLiveActivity:', error);
          }
      }
      
      function initializeWalletEvents() {
      try {
          // Listen for topup amount changes
          const topupInput = document.getElementById('topup-amount');
          if (topupInput) {
              topupInput.addEventListener('input', function() {
                  const amount = parseInt(this.value) || 0;
                  updateZakatAmount(amount);
              });
          }
      
          // Initialize switch states from saved preferences
          loadWalletSettings();
          
          // Initialize switch events
          initializeSwitchEvents();
          
          // Check balance alert on page load
          setTimeout(() => checkBalanceAlert(), 1000);
      } catch (error) {
          console.error('Error in initializeWalletEvents:', error);
      }
      }
      
      function loadWalletSettings() {
      try {
          if (userData.settings) {
              const autoZakatSwitch = document.getElementById('auto-zakat-wallet');
              const autoInfaqSwitch = document.getElementById('auto-infaq-wallet');
              const balanceNotificationSwitch = document.getElementById('balance-notification-wallet');
              
              if (autoZakatSwitch) {
                  autoZakatSwitch.checked = userData.settings.autoZakat !== false; // Default true
              }
              
              if (autoInfaqSwitch) {
                  autoInfaqSwitch.checked = userData.settings.autoInfaq !== false; // Default true
              }
              
              if (balanceNotificationSwitch) {
                  balanceNotificationSwitch.checked = userData.settings.balanceNotification !== false; // Default true
              }
          }
      } catch (error) {
          console.error('Error in loadWalletSettings:', error);
      }
      }
      
      // Wallet settings functions
      function toggleAutoZakat(isEnabled) {
      try {
          userData.settings = userData.settings || {};
          userData.settings.autoZakat = isEnabled;
          
          if (isEnabled) {
              showNotification('Auto-zakat diaktifkan - 2.5% akan dipotong otomatis', 'success');
          } else {
              showNotification('Auto-zakat dinonaktifkan', 'warning');
          }
          
          saveUserPreferences();
      } catch (error) {
          console.error('Error in toggleAutoZakat:', error);
          showNotification('Gagal mengubah pengaturan auto-zakat', 'error');
      }
      }
      
      function toggleAutoInfaq(isEnabled) {
      try {
          userData.settings = userData.settings || {};
          userData.settings.autoInfaq = isEnabled;
          
          if (isEnabled) {
              showNotification('Auto-infaq diaktifkan - Rp 1.000 per trip Cluster C', 'success');
          } else {
              showNotification('Auto-infaq dinonaktifkan', 'warning');
          }
          
          saveUserPreferences();
      } catch (error) {
          console.error('Error in toggleAutoInfaq:', error);
          showNotification('Gagal mengubah pengaturan auto-infaq', 'error');
      }
      }
      
      function toggleBalanceNotification(isEnabled) {
      try {
          userData.settings = userData.settings || {};
          userData.settings.balanceNotification = isEnabled;
          
          if (isEnabled) {
              showNotification('Notifikasi saldo diaktifkan - Alert saat saldo < Rp 50.000', 'success');
              checkBalanceAlert(); // Check immediately
          } else {
              showNotification('Notifikasi saldo dinonaktifkan', 'warning');
          }
          
          saveUserPreferences();
      } catch (error) {
          console.error('Error in toggleBalanceNotification:', error);
          showNotification('Gagal mengubah pengaturan notifikasi', 'error');
      }
      }
      
      function checkBalanceAlert() {
      try {
          if (userData.settings?.balanceNotification && userData.balance < 50000) {
              showNotification(`Saldo Anda rendah: Rp ${userData.balance.toLocaleString()}. Silakan top up.`, 'warning');
          }
      } catch (error) {
          console.error('Error in checkBalanceAlert:', error);
      }
      }
      
      function initializeSwitchEvents() {
          try {
              document.querySelectorAll('.switch input[type="checkbox"]').forEach(switchElement => {
                  switchElement.addEventListener('change', function() {
                      const parentSwitch = this.closest('.switch');
                      const isChecked = this.checked;
                      
                      if (parentSwitch) {
                          const slider = parentSwitch.querySelector('.slider');
                          if (slider) {
                              if (isChecked) {
                                  slider.style.boxShadow = '0 0 10px rgba(46, 204, 113, 0.5)';
                              } else {
                                  slider.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.1)';
                              }
                          }
                      }
                      
                      console.log('Switch toggled:', isChecked);
                  });
              });
          } catch (error) {
              console.error('Error in initializeSwitchEvents:', error);
          }
      }
      
      // Modal management
      function showModal(modalId) {
          try {
              const modal = document.getElementById(modalId);
              if (modal) {
                  modal.classList.remove('hidden');
                  modal.classList.add('flex');
                  document.body.style.overflow = 'hidden';
              }
          } catch (error) {
              console.error('Error in showModal:', error);
          }
      }
      
      function closeModal(modalId) {
          try {
              const modal = document.getElementById(modalId);
              if (modal) {
                  modal.classList.add('hidden');
                  modal.classList.remove('flex');
                  document.body.style.overflow = 'auto';
              }
          } catch (error) {
              console.error('Error in closeModal:', error);
          }
      }
      
      function showOrderModal() {
          showModal('order-modal');
      }
      
      function showNotifications() {
          try {
              const notifications = [
                  'Pesanan baru dari Cluster C tersedia',
                  'Saldo Anda mencukupi untuk 8 trip lagi',
                  'Ustadzah Siti memberikan rating 5 bintang',
                  'Auto-zakat berhasil disalurkan Rp 2.500',
                  'Pahala points Anda bertambah +15'
              ];
              
              notifications.forEach((notif, index) => {
                  setTimeout(() => {
                      showNotification(notif, 'info');
                  }, index * 1000);
              });
          } catch (error) {
              console.error('Error in showNotifications:', error);
          }
      }
      
      function showUserMenu() {
          try {
              const menuOptions = [
                  'Edit Profile',
                  'Pengaturan Akun',
                  'Riwayat Aktivitas',
                  'Bantuan & Support',
                  'Logout'
              ];
              
              showNotification('Menu pengguna: ' + menuOptions.join(', '), 'info');
          } catch (error) {
              console.error('Error in showUserMenu:', error);
          }
      }
      
      // Notification system
      function showNotification(message, type = 'success') {
          try {
              const container = document.getElementById('notification-container');
              if (!container) return;
      
              const notification = document.createElement('div');
              
              const colors = {
                  success: 'bg-luyu-green',
                  error: 'bg-luyu-red',
                  warning: 'bg-luyu-gold',
                  info: 'bg-luyu-blue'
              };
              
              const icons = {
                  success: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>`,
                  error: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>`,
                  warning: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"/>`,
                  info: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>`
              };
              
              notification.className = `notification-enter ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg flex items-center max-w-sm`;
              notification.innerHTML = `
                  <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      ${icons[type]}
                  </svg>
                  <span class="flex-1">${message}</span>
                  <button onclick="this.parentElement.remove()" class="ml-4 hover:bg-white/20 rounded p-1 flex-shrink-0">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                  </button>
              `;
              
              container.appendChild(notification);
              
              setTimeout(() => {
                  if (notification.parentElement) {
                      notification.style.opacity = '0';
                      notification.style.transform = 'translateX(100%)';
                      setTimeout(() => {
                          if (notification.parentElement) {
                              notification.remove();
                          }
                      }, 300);
                  }
              }, 5000);
          } catch (error) {
              console.error('Error in showNotification:', error);
          }
      }
      
      // Loading overlay
      function showLoading() {
          try {
              const overlay = document.getElementById('loading-overlay');
              if (overlay) {
                  overlay.classList.remove('hidden');
                  overlay.classList.add('flex');
              }
          } catch (error) {
              console.error('Error in showLoading:', error);
          }
      }
      
      function hideLoading() {
          try {
              const overlay = document.getElementById('loading-overlay');
              if (overlay) {
                  overlay.classList.add('hidden');
                  overlay.classList.remove('flex');
              }
          } catch (error) {
              console.error('Error in hideLoading:', error);
          }
      }
      
      // Search functionality
      function handleSearch(query) {
          try {
              if (query.length > 2) {
                  console.log('Searching for:', query);
                  
                  const searchResults = [
                      'Ustadzah Siti (Driver Cluster C)',
                      'Rute ke Masjid Al-Barokah',
                      'Driver terdekat di Banten',
                      'Cluster C - Prioritas Syariah'
                  ].filter(item => item.toLowerCase().includes(query.toLowerCase()));
                  
                  if (searchResults.length > 0) {
                      showNotification(`Ditemukan ${searchResults.length} hasil untuk "${query}"`, 'info');
                  } else {
                      showNotification(`Tidak ada hasil untuk "${query}"`, 'warning');
                  }
              }
          } catch (error) {
              console.error('Error in handleSearch:', error);
          }
      }
      
      // Order processing
      function processOrder() {
          try {
              const fromInput = document.querySelector('input[placeholder="Lokasi penjemputan..."]');
              const toInput = document.querySelector('input[placeholder="Tujuan..."]');
              
              const fromLocation = fromInput ? fromInput.value : '';
              const toLocation = toInput ? toInput.value : '';
              
              if (!fromLocation || !toLocation) {
                  showNotification('Mohon lengkapi lokasi penjemputan dan tujuan', 'error');
                  return;
              }
              
              showLoading();
              
              setTimeout(() => {
                  hideLoading();
                  closeModal('order-modal');
                  
                  if (fromInput) fromInput.value = '';
                  if (toInput) toInput.value = '';
                  
                  showNotification('Pesanan berhasil dibuat! Driver sedang menuju lokasi Anda.', 'success');
                  
                  userData.totalTrips++;
                  
                  setTimeout(() => {
                      showNotification('Driver telah mengkonfirmasi pesanan Anda', 'info');
                  }, 3000);
                  
                  setTimeout(() => {
                      showNotification('Driver sedang dalam perjalanan ke lokasi pickup', 'info');
                  }, 8000);
              }, 2000);
          } catch (error) {
              console.error('Error in processOrder:', error);
              hideLoading();
              showNotification('Terjadi kesalahan saat memproses pesanan', 'error');
          }
      }
      
      // Top up functionality
      function setTopupAmount(amount) {
          try {
              const input = document.getElementById('topup-amount');
              if (input) {
                  input.value = amount;
                  updateZakatAmount(amount);
              }
          } catch (error) {
              console.error('Error in setTopupAmount:', error);
          }
      }
      
      function updateZakatAmount(amount) {
          try {
              const zakatAmount = Math.floor(amount * 0.025);
              const zakatElement = document.getElementById('zakat-amount');
              if (zakatElement) {
                  zakatElement.textContent = `Rp ${zakatAmount.toLocaleString()}`;
              }
          } catch (error) {
              console.error('Error in updateZakatAmount:', error);
          }
      }
      
      function processTopup() {
          try {
              const amountInput = document.getElementById('topup-amount');
              const autoZakatInput = document.getElementById('auto-zakat');
              
              const amount = amountInput ? parseInt(amountInput.value) : 0;
              const autoZakat = autoZakatInput ? autoZakatInput.checked : false;
              
              if (!amount || amount < 10000) {
                  showNotification('Minimum top up adalah Rp 10.000', 'error');
                  return;
              }
              
              if (amount > 10000000) {
                  showNotification('Maximum top up adalah Rp 10.000.000', 'error');
                  return;
              }
              
              showLoading();
              
              setTimeout(() => {
                  hideLoading();
                  closeModal('topup-modal');
                  
                  userData.balance += amount;
                  if (autoZakat) {
                      const zakatAmount = Math.floor(amount * 0.025);
                      userData.balance -= zakatAmount;
                      showNotification(`Berhasil top up Rp ${amount.toLocaleString()}. Zakat Rp ${zakatAmount.toLocaleString()} telah disalurkan.`, 'success');
                  } else {
                      showNotification(`Berhasil top up Rp ${amount.toLocaleString()}`, 'success');
                  }
                  
                  if (amountInput) amountInput.value = '';
                  updateZakatAmount(0);
                  
                  if (currentPage === 'wallet') {
                      setTimeout(() => {
                          loadPageContent('wallet');
                      }, 1000);
                  }
              }, 2000);
          } catch (error) {
              console.error('Error in processTopup:', error);
              hideLoading();
              showNotification('Terjadi kesalahan saat memproses top up', 'error');
          }
      }
      
      // Data simulation and real-time updates
      function startDataSimulation() {
          try {
              setInterval(() => {
                  const driverCountElement = document.getElementById('driver-count');
                  if (driverCountElement) {
                      const variation = Math.floor(Math.random() * 20) - 10;
                      const newCount = 1247 + variation;
                      driverCountElement.textContent = newCount.toLocaleString();
                  }
              }, 30000);
      
              setInterval(() => {
                  userData.pahalaPoints += Math.floor(Math.random() * 5) + 1;
                  const pahalaElement = document.getElementById('pahala-count');
                  if (pahalaElement) {
                      pahalaElement.textContent = userData.pahalaPoints.toLocaleString();
                  }
              }, 60000);
      
              setInterval(() => {
                  if (Math.random() < 0.3) {
                      showNotification('Pesanan baru tersedia di sekitar Anda!', 'info');
                  }
              }, 45000);
          } catch (error) {
              console.error('Error in startDataSimulation:', error);
          }
      }
      
      // Keyboard shortcuts
      function setupKeyboardShortcuts() {
          try {
              document.addEventListener('keydown', function(e) {
                  if (e.key === 'Escape') {
                      document.querySelectorAll('.modal:not(.hidden)').forEach(modal => {
                          closeModal(modal.id);
                      });
                      closeDriverPanel();
                  }
                  
                  if (e.ctrlKey && e.key === 'o') {
                      e.preventDefault();
                      showOrderModal();
                  }
                  
                  if (e.ctrlKey && e.key === 't') {
                      e.preventDefault();
                      showModal('topup-modal');
                  }
                  
                  if (e.key >= '1' && e.key <= '9') {
                      const pages = ['dashboard', 'maps', 'orders', 'wallet', 'analytics', 'zakat', 'wakaf', 'kajian', 'settings'];
                      const pageIndex = parseInt(e.key) - 1;
                      if (pages[pageIndex]) {
                          showPage(pages[pageIndex]);
                      }
                  }
              });
          } catch (error) {
              console.error('Error in setupKeyboardShortcuts:', error);
          }
      }
      
      // Accessibility improvements
      function setupAccessibility() {
          try {
              document.addEventListener('keydown', function(e) {
                  if (e.key === 'Tab') {
                      document.body.classList.add('keyboard-navigation');
                  }
              });
      
              document.addEventListener('mousedown', function() {
                  document.body.classList.remove('keyboard-navigation');
              });
      
              document.querySelectorAll('button').forEach(button => {
                  if (!button.getAttribute('aria-label') && button.textContent.trim()) {
                      button.setAttribute('aria-label', button.textContent.trim());
                  }
              });
          } catch (error) {
              console.error('Error in setupAccessibility:', error);
          }
      }
      
      // Performance optimization
      function optimizePerformance() {
          try {
              if ('IntersectionObserver' in window) {
                  const imageObserver = new IntersectionObserver((entries, observer) => {
                      entries.forEach(entry => {
                          if (entry.isIntersecting) {
                              const img = entry.target;
                              if (img.dataset.src) {
                                  img.src = img.dataset.src;
                                  img.classList.remove('lazy');
                                  observer.unobserve(img);
                              }
                          }
                      });
                  });
      
                  document.querySelectorAll('img[data-src]').forEach(img => {
                      imageObserver.observe(img);
                  });
              }
      
              let searchTimeout;
              const searchInput = document.querySelector('input[placeholder="Cari driver, rute..."]');
              if (searchInput) {
                  searchInput.addEventListener('input', function() {
                      clearTimeout(searchTimeout);
                      searchTimeout = setTimeout(() => {
                          handleSearch(this.value);
                      }, 300);
                  });
              }
          } catch (error) {
              console.error('Error in optimizePerformance:', error);
          }
      }
      
      // Local storage management
      function saveUserPreferences() {
          try {
              const preferences = {
                  currentPage: currentPage,
                  lastLogin: new Date().toISOString(),
                  userData: userData
              };
              localStorage.setItem('luyu_preferences', JSON.stringify(preferences));
          } catch (error) {
              console.error('Error in saveUserPreferences:', error);
          }
      }
      
      function loadUserPreferences() {
          try {
              const preferences = localStorage.getItem('luyu_preferences');
              if (preferences) {
                  const prefs = JSON.parse(preferences);
                  
                  if (prefs.userData) {
                      userData = { ...userData, ...prefs.userData };
                  }
                  
                  if (prefs.lastLogin) {
                      const lastLogin = new Date(prefs.lastLogin);
                      const now = new Date();
                      const daysDiff = Math.floor((now - lastLogin) / (1000 * 60 * 60 * 24));
                      
                      if (daysDiff > 0) {
                          setTimeout(() => {
                              showNotification(`Selamat datang kembali! Terakhir login ${daysDiff} hari yang lalu`, 'info');
                          }, 2000);
                      }
                  }
              }
          } catch (error) {
              console.error('Error in loadUserPreferences:', error);
          }
      }
      
      // Error handling
      function setupErrorHandling() {
          try {
              window.addEventListener('error', function(e) {
                  console.error('Application error:', e.error);
                  showNotification('Terjadi kesalahan sistem. Tim teknis akan segera memperbaiki.', 'error');
              });
      
              window.addEventListener('unhandledrejection', function(e) {
                  console.error('Unhandled promise rejection:', e.reason);
                  showNotification('Koneksi bermasalah. Silakan coba lagi.', 'warning');
              });
          } catch (error) {
              console.error('Error in setupErrorHandling:', error);
          }
      }
      
      // Initialize app
      document.addEventListener('DOMContentLoaded', function() {
          try {
              console.log('LUYU Enhanced Application with Analytics & Orders Loaded Successfully');
              
              loadUserPreferences();
              
              showPage('dashboard');
              setupKeyboardShortcuts();
              setupAccessibility();
              optimizePerformance();
              setupErrorHandling();
              
              document.querySelectorAll('.modal').forEach(modal => {
                  modal.addEventListener('click', function(e) {
                      if (e.target === this) {
                          closeModal(this.id);
                      }
                  });
              });
              
              initializeSwitchEvents();
              startDataSimulation();
              
              setTimeout(() => {
                  showNotification('Selamat datang di LUYU Platform! 🌟', 'success');
              }, 1000);
              
              window.addEventListener('beforeunload', saveUserPreferences);
              setInterval(saveUserPreferences, 5 * 60 * 1000);
          } catch (error) {
              console.error('Error during app initialization:', error);
              showNotification('Terjadi kesalahan saat memuat aplikasi', 'error');
          }
      });
      
      // Zakat & Infaq functionality
      function updateZakatCalculation() {
      try {
      const type = document.getElementById('zakat-type').value;
      const amount = parseInt(document.getElementById('zakat-amount').value) || 0;
      let zakatAmount = 0;
      
      switch(type) {
      case 'mal':
      case 'penghasilan':
      case 'perdagangan':
          zakatAmount = amount * 0.025; // 2.5%
          break;
      case 'emas':
          zakatAmount = amount * 0.025;
          break;
      default:
          zakatAmount = amount * 0.025;
      }
      
      const resultElement = document.getElementById('zakat-result');
      if (resultElement) {
      resultElement.textContent = `Rp ${zakatAmount.toLocaleString()}`;
      }
      
      } catch (error) {
      console.error('Error in updateZakatCalculation:', error);
      }
      }
      
      function payZakat() {
      try {
      const amount = parseInt(document.getElementById('zakat-amount').value) || 0;
      const zakatAmount = amount * 0.025;
      
      if (zakatAmount < 1000) {
      showNotification('Minimum pembayaran zakat adalah Rp 1.000', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification(`Zakat sebesar Rp ${zakatAmount.toLocaleString()} berhasil dibayar dan disalurkan`, 'success');
      
      // Update monthly zakat
      const monthlyZakat = document.getElementById('monthly-zakat');
      if (monthlyZakat) {
          const current = parseInt(monthlyZakat.textContent.replace(/[^\d]/g, ''));
          monthlyZakat.textContent = `Rp ${(current + zakatAmount).toLocaleString()}`;
      }
      
      // Clear form
      document.getElementById('zakat-amount').value = '';
      updateZakatCalculation();
      
      }, 2000);
      
      } catch (error) {
      console.error('Error in payZakat:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses pembayaran zakat', 'error');
      }
      }
      
      function processManualZakat() {
      try {
      const type = document.getElementById('manual-zakat-type').value;
      const amount = parseInt(document.getElementById('manual-zakat-amount').value) || 0;
      
      if (amount < 1000) {
      showNotification('Minimum pembayaran zakat adalah Rp 1.000', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('zakat-manual-modal');
      showNotification(`Zakat ${type} sebesar Rp ${amount.toLocaleString()} berhasil dibayar`, 'success');
      
      // Clear form
      document.getElementById('manual-zakat-amount').value = '';
      
      }, 2000);
      
      } catch (error) {
      console.error('Error in processManualZakat:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses zakat manual', 'error');
      }
      }
      
      function selectDriverForInfaq(driverId) {
      try {
      const modal = document.getElementById('infaq-modal');
      const recipientDiv = document.getElementById('infaq-recipient');
      
      let driverInfo = '';
      
      if (driverId === 'random') {
      driverInfo = `
          <div class="flex items-center">
              <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center mr-3">
                  <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
              </div>
              <div>
                  <h4 class="font-semibold">Driver Random</h4>
                  <p class="text-sm text-gray-600">Sistem akan memilih driver yang membutuhkan</p>
              </div>
          </div>
      `;
      } else {
      const driver = driverData[driverId];
      if (driver) {
          driverInfo = `
              <div class="flex items-center">
                  <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center mr-3">
                      <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                      </svg>
                  </div>
                  <div>
                      <h4 class="font-semibold">${driver.name}</h4>
                      <p class="text-sm text-gray-600">Cluster ${driver.cluster} • ${driver.vehicle}</p>
                  </div>
              </div>
          `;
      }
      }
      
      if (recipientDiv) {
      recipientDiv.innerHTML = driverInfo;
      }
      
      showModal('infaq-modal');
      
      } catch (error) {
      console.error('Error in selectDriverForInfaq:', error);
      }
      }
      
      function setInfaqAmount(amount) {
      try {
      const input = document.getElementById('infaq-amount');
      if (input) {
      input.value = amount;
      }
      } catch (error) {
      console.error('Error in setInfaqAmount:', error);
      }
      }
      
      function processInfaq() {
      try {
      const amount = parseInt(document.getElementById('infaq-amount').value) || 0;
      const message = document.getElementById('infaq-message').value;
      
      if (amount < 1000) {
      showNotification('Minimum infaq adalah Rp 1.000', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('infaq-modal');
      showNotification(`Infaq sebesar Rp ${amount.toLocaleString()} berhasil dikirim`, 'success');
      
      // Clear form
      document.getElementById('infaq-amount').value = '';
      document.getElementById('infaq-message').value = '';
      
      }, 2000);
      
      } catch (error) {
      console.error('Error in processInfaq:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses infaq', 'error');
      }
      }
      
      function quickInfaq(amount) {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification(`Infaq cepat Rp ${amount.toLocaleString()} berhasil dikirim ke driver random`, 'success');
      }, 1500);
      
      } catch (error) {
      console.error('Error in quickInfaq:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses infaq cepat', 'error');
      }
      }
      
      function randomInfaq() {
      try {
      const amounts = [5000, 10000, 15000, 25000];
      const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification(`Infaq random Rp ${randomAmount.toLocaleString()} berhasil dikirim`, 'success');
      }, 1500);
      
      } catch (error) {
      console.error('Error in randomInfaq:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses infaq random', 'error');
      }
      }
      
      // Wakaf Digital functionality
      const wakafPrograms = {
      'masjid-al-ikhlas': {
      name: 'Masjid Al-Ikhlas',
      location: 'Tangerang Selatan',
      category: 'Masjid',
      target: 1200000000,
      collected: 847000000,
      description: 'Pembangunan masjid untuk 500 jamaah dengan fasilitas lengkap',
      benefits: ['Tempat ibadah 500 jamaah', 'Madrasah untuk 100 santri', 'Perpustakaan Islam'],
      userContribution: 250000
      },
      'sekolah-tahfidz': {
      name: 'Sekolah Tahfidz',
      location: 'Bekasi',
      category: 'Pendidikan',
      target: 800000000,
      collected: 320000000,
      description: 'Sekolah tahfidz untuk anak-anak kurang mampu',
      benefits: ['Pendidikan gratis 200 santri', 'Asrama dan makan', 'Beasiswa penuh'],
      userContribution: 150000
      },
      'sumur-wakaf': {
      name: 'Sumur Wakaf',
      location: 'Lombok Timur',
      category: 'Sosial',
      target: 150000000,
      collected: 125000000,
      description: 'Sumur bor untuk masyarakat yang kesulitan air bersih',
      benefits: ['Air bersih 500 keluarga', 'Kebersihan lingkungan', 'Kesehatan masyarakat'],
      userContribution: 100000
      },
      'ambulance-gratis': {
      name: 'Ambulance Gratis',
      location: 'Jakarta Selatan',
      category: 'Kesehatan',
      target: 500000000,
      collected: 180000000,
      description: 'Layanan ambulance gratis untuk masyarakat kurang mampu',
      benefits: ['Layanan 24 jam', 'Gratis untuk dhuafa', 'Peralatan medis lengkap'],
      userContribution: 75000
      }
      };
      
      function setWakafAmount(amount) {
      try {
      const input = document.getElementById('wakaf-amount');
      if (input) {
      input.value = amount;
      }
      } catch (error) {
      console.error('Error in setWakafAmount:', error);
      }
      }
      
      function processWakafTunai() {
      try {
      const type = document.getElementById('wakaf-type').value;
      const amount = parseInt(document.getElementById('wakaf-amount').value) || 0;
      const recurring = document.getElementById('wakaf-recurring').checked;
      const intention = document.getElementById('wakaf-intention').value;
      
      if (amount < 10000) {
      showNotification('Minimum wakaf adalah Rp 10.000', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('wakaf-tunai-modal');
      
      const recurringText = recurring ? ' (Bulanan)' : '';
      showNotification(`Wakaf tunai Rp ${amount.toLocaleString()}${recurringText} berhasil dibayar`, 'success');
      
      // Update total wakaf
      const totalWakafElement = document.getElementById('total-wakaf');
      if (totalWakafElement) {
          const currentTotal = parseInt(totalWakafElement.textContent.replace(/[^\d]/g, ''));
          totalWakafElement.textContent = `Rp ${(currentTotal + amount).toLocaleString()}`;
      }
      
      // Clear form
      document.getElementById('wakaf-amount').value = '';
      document.getElementById('wakaf-intention').value = '';
      document.getElementById('wakaf-recurring').checked = false;
      
      // Generate certificate
      setTimeout(() => {
          showNotification('Sertifikat wakaf telah diterbitkan dan dapat diunduh', 'info');
      }, 3000);
      
      }, 2500);
      
      } catch (error) {
      console.error('Error in processWakafTunai:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses wakaf', 'error');
      }
      }
      
      function contributeWakaf(programId) {
      try {
      const program = wakafPrograms[programId];
      if (!program) {
      showNotification('Program wakaf tidak ditemukan', 'error');
      return;
      }
      
      const modal = document.getElementById('wakaf-program-modal');
      const content = document.getElementById('wakaf-program-content');
      
      const remainingAmount = program.target - program.collected;
      const progressPercentage = ((program.collected / program.target) * 100).toFixed(1);
      
      content.innerHTML = `
      <div class="space-y-6">
          <!-- Program Info -->
          <div class="p-4 bg-gray-50 rounded-lg">
              <h3 class="text-xl font-bold text-gray-800 mb-2">${program.name}</h3>
              <p class="text-gray-600 mb-3">${program.description}</p>
              <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                      <span class="text-gray-500">Lokasi:</span>
                      <span class="font-semibold ml-2">${program.location}</span>
                  </div>
                  <div>
                      <span class="text-gray-500">Kategori:</span>
                      <span class="font-semibold ml-2">${program.category}</span>
                  </div>
              </div>
          </div>
      
          <!-- Progress -->
          <div>
              <div class="flex justify-between text-sm mb-2">
                  <span>Progress Terkumpul</span>
                  <span class="font-semibold">Rp ${(program.collected / 1000000).toFixed(0)}M / Rp ${(program.target / 1000000).toFixed(0)}M</span>
              </div>
              <div class="progress-bar mb-2">
                  <div class="progress-fill bg-luyu-purple" style="width: ${progressPercentage}%"></div>
              </div>
              <p class="text-xs text-gray-500">${progressPercentage}% tercapai • Sisa Rp ${(remainingAmount / 1000000).toFixed(1)}M lagi</p>
          </div>
      
          <!-- Benefits -->
          <div>
              <h4 class="font-semibold text-gray-800 mb-3">Manfaat Program</h4>
              <ul class="space-y-2">
                  ${program.benefits.map(benefit => `
                      <li class="flex items-center text-sm">
                          <svg class="w-4 h-4 text-luyu-green mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                          </svg>
                          ${benefit}
                      </li>
                  `).join('')}
              </ul>
          </div>
      
          <!-- Contribution Form -->
          <div class="border-t pt-6">
              <h4 class="font-semibold text-gray-800 mb-4">Kontribusi Anda</h4>
              <div class="space-y-4">
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Kontribusi</label>
                      <input type="number" placeholder="Masukkan jumlah..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-purple focus:border-transparent" id="program-contribution-amount">
                  </div>
      
                  <div class="grid grid-cols-4 gap-3">
                      <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setProgramContribution(50000)">50K</button>
                      <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setProgramContribution(100000)">100K</button>
                      <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setProgramContribution(250000)">250K</button>
                      <button class="py-2 px-3 border border-gray-300 rounded-lg hover:border-luyu-purple hover:text-luyu-purple transition-all text-sm" onclick="setProgramContribution(500000)">500K</button>
                  </div>
      
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Pesan Dukungan (Opsional)</label>
                      <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-purple focus:border-transparent" rows="3" placeholder="Tulis pesan dukungan..." id="program-support-message"></textarea>
                  </div>
              </div>
          </div>
      
          <!-- Actions -->
          <div class="flex space-x-4">
              <button class="flex-1 bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all" onclick="processProgramContribution('${programId}')">
                  Kontribusi Sekarang
              </button>
              <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('wakaf-program-modal')">
                  Batal
              </button>
          </div>
      </div>
      `;
      
      showModal('wakaf-program-modal');
      
      } catch (error) {
      console.error('Error in contributeWakaf:', error);
      showNotification('Gagal memuat detail program wakaf', 'error');
      }
      }
      
      function setProgramContribution(amount) {
      try {
      const input = document.getElementById('program-contribution-amount');
      if (input) {
      input.value = amount;
      }
      } catch (error) {
      console.error('Error in setProgramContribution:', error);
      }
      }
      
      function processProgramContribution(programId) {
      try {
      const amount = parseInt(document.getElementById('program-contribution-amount').value) || 0;
      const message = document.getElementById('program-support-message').value;
      const program = wakafPrograms[programId];
      
      if (amount < 10000) {
      showNotification('Minimum kontribusi adalah Rp 10.000', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('wakaf-program-modal');
      
      showNotification(`Kontribusi Rp ${amount.toLocaleString()} untuk ${program.name} berhasil`, 'success');
      
      // Update program data
      wakafPrograms[programId].collected += amount;
      wakafPrograms[programId].userContribution += amount;
      
      // Update total wakaf
      const totalWakafElement = document.getElementById('total-wakaf');
      if (totalWakafElement) {
          const currentTotal = parseInt(totalWakafElement.textContent.replace(/[^\d]/g, ''));
          totalWakafElement.textContent = `Rp ${(currentTotal + amount).toLocaleString()}`;
      }
      
      // Refresh current page if on wakaf page
      if (currentPage === 'wakaf') {
          setTimeout(() => {
              loadPageContent('wakaf');
          }, 1000);
      }
      
      }, 2500);
      
      } catch (error) {
      console.error('Error in processProgramContribution:', error);
      hideLoading();
      showNotification('Terjadi kesalahan saat memproses kontribusi', 'error');
      }
      }
      
      function showWakafDetail(programId) {
      try {
      const program = wakafPrograms[programId];
      if (!program) {
      showNotification('Program wakaf tidak ditemukan', 'error');
      return;
      }
      
      const modal = document.getElementById('wakaf-detail-modal');
      const content = document.getElementById('wakaf-detail-content');
      
      const progressPercentage = ((program.collected / program.target) * 100).toFixed(1);
      
      content.innerHTML = `
      <div class="space-y-6">
          <!-- Hero Image -->
          <div class="h-64 bg-gradient-to-br from-luyu-purple to-luyu-blue rounded-2xl relative overflow-hidden">
              <div class="absolute inset-0 bg-black/20"></div>
              <div class="absolute bottom-6 left-6 text-white">
                  <h3 class="text-2xl font-bold">${program.name}</h3>
                  <p class="text-white/90">${program.location}</p>
              </div>
              <div class="absolute top-6 right-6">
                  <span class="bg-white/90 text-luyu-purple px-4 py-2 rounded-full text-sm font-semibold">${program.category}</span>
              </div>
          </div>
      
          <!-- Description -->
          <div>
              <h4 class="text-lg font-bold text-gray-800 mb-3">Deskripsi Program</h4>
              <p class="text-gray-600 leading-relaxed">${program.description}</p>
          </div>
      
          <!-- Progress Detail -->
          <div class="bg-gray-50 p-6 rounded-xl">
              <h4 class="text-lg font-bold text-gray-800 mb-4">Progress Pembangunan</h4>
              <div class="space-y-4">
                  <div class="flex justify-between items-center">
                      <span class="text-gray-600">Target:</span>
                      <span class="font-bold text-gray-800">Rp ${(program.target / 1000000).toFixed(0)} Miliar</span>
                  </div>
                  <div class="flex justify-between items-center">
                      <span class="text-gray-600">Terkumpul:</span>
                      <span class="font-bold text-luyu-purple">Rp ${(program.collected / 1000000).toFixed(0)} Miliar</span>
                  </div>
                  <div class="progress-bar h-4">
                      <div class="progress-fill bg-luyu-purple" style="width: ${progressPercentage}%"></div>
                  </div>
                  <div class="flex justify-between items-center text-sm">
                      <span class="text-gray-500">${progressPercentage}% tercapai</span>
                      <span class="text-gray-500">Sisa: Rp ${((program.target - program.collected) / 1000000).toFixed(1)}M</span>
                  </div>
              </div>
          </div>
      
          <!-- Benefits Grid -->
          <div>
              <h4 class="text-lg font-bold text-gray-800 mb-4">Manfaat Program</h4>
              <div class="grid grid-cols-1 gap-3">
                  ${program.benefits.map(benefit => `
                      <div class="flex items-center p-3 bg-luyu-purple/10 rounded-lg">
                          <svg class="w-5 h-5 text-luyu-purple mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                          </svg>
                          <span class="text-gray-700">${benefit}</span>
                      </div>
                  `).join('')}
              </div>
          </div>
      
          <!-- Your Contribution -->
          <div class="bg-luyu-purple/10 p-6 rounded-xl">
              <h4 class="text-lg font-bold text-gray-800 mb-3">Kontribusi Anda</h4>
              <div class="flex items-center justify-between">
                  <span class="text-gray-600">Total kontribusi:</span>
                  <span class="text-2xl font-bold text-luyu-purple">Rp ${program.userContribution.toLocaleString()}</span>
              </div>
          </div>
      
          <!-- Actions -->
          <div class="flex space-x-4">
              <button class="flex-1 bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all" onclick="closeModal('wakaf-detail-modal'); contributeWakaf('${programId}');">
                  Tambah Kontribusi
              </button>
              <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="shareWakafProgram('${programId}')">
                  Bagikan
              </button>
          </div>
      </div>
      `;
      
      showModal('wakaf-detail-modal');
      
      } catch (error) {
      console.error('Error in showWakafDetail:', error);
      showNotification('Gagal memuat detail program wakaf', 'error');
      }
      }
      
      function downloadWakafCertificate(certificateId) {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification(`Sertifikat ${certificateId} berhasil diunduh`, 'success');
      
      // Simulate download
      const link = document.createElement('a');
      link.href = '#';
      link.download = `sertifikat-wakaf-${certificateId}.pdf`;
      link.click();
      
      }, 2000);
      
      } catch (error) {
      console.error('Error in downloadWakafCertificate:', error);
      hideLoading();
      showNotification('Gagal mengunduh sertifikat', 'error');
      }
      }
      
      function shareWakafProgram(programId) {
      try {
      const program = wakafPrograms[programId];
      if (navigator.share) {
      navigator.share({
          title: `Wakaf ${program.name}`,
          text: `Mari berwakaf untuk ${program.name} di ${program.location}. ${program.description}`,
          url: window.location.href
      });
      } else {
      showNotification('Program wakaf berhasil disalin ke clipboard', 'success');
      }
      } catch (error) {
      console.error('Error in shareWakafProgram:', error);
      showNotification('Gagal membagikan program wakaf', 'error');
      }
      }
      
      function showAllWakafPrograms() {
      try {
      showNotification('Fitur jelajah semua program wakaf akan segera tersedia', 'info');
      } catch (error) {
      console.error('Error in showAllWakafPrograms:', error);
      }
      }
      
      // Kajian Online functionality
      const kajianData = {
      'fiqih-muamalah': {
      title: 'Fiqih Muamalah Modern',
      ustadz: 'Ustadz Dr. Mahmud Hasan',
      category: 'Fiqih',
      datetime: 'Besok, 20:00 WIB',
      duration: '90 menit',
      description: 'Kajian mendalam tentang fiqih muamalah dalam konteks modern, mencakup transaksi digital, e-commerce, dan keuangan syariah',
      topics: ['Transaksi Digital', 'E-commerce Syariah', 'Keuangan Modern', 'Cryptocurrency'],
      prerequisites: 'Dasar fiqih',
      maxParticipants: 500,
      currentParticipants: 347
      },
      'akhlaq-keluarga': {
      title: 'Akhlaq dalam Keluarga',
      ustadz: 'Ustadzah Dr. Siti Nurhaliza',
      category: 'Akhlaq',
      datetime: 'Kamis, 19:30 WIB',
      duration: '75 menit',
      description: 'Membangun keluarga yang sakinah mawaddah wa rahmah melalui akhlaq yang mulia',
      topics: ['Akhlaq Suami-Istri', 'Mendidik Anak', 'Hubungan dengan Mertua', 'Komunikasi Efektif'],
      prerequisites: 'Tidak ada',
      maxParticipants: 300,
      currentParticipants: 256
      },
      'tafsir-yusuf': {
      title: 'Tafsir Surat Yusuf',
      ustadz: 'Ustadz Prof. Dr. Abdullah Salim',
      category: 'Tafsir',
      datetime: 'Jumat, 21:00 WIB',
      duration: '120 menit',
      description: 'Tafsir komprehensif Surat Yusuf dengan pelajaran kehidupan yang dapat diambil',
      topics: ['Kisah Nabi Yusuf', 'Hikmah dan Pelajaran', 'Aplikasi dalam Kehidupan', 'Tafsir Kontemporer'],
      prerequisites: 'Dasar ilmu tafsir',
      maxParticipants: 1000,
      currentParticipants: 789
      }
      };
      
      const recordedKajian = {
      'hadits-40': {
      title: '40 Hadits Nawawi',
      ustadz: 'Ustadz Muhammad Hakim',
      duration: '2:15:30',
      views: 2847,
      rating: 5.0,
      description: 'Penjelasan lengkap 40 hadits pilihan Imam Nawawi'
      },
      'sirah-nabi': {
      title: 'Sirah Nabawiyah',
      ustadz: 'Ustadz Dr. Ahmad Zaki', 
      duration: '1:45:20',
      views: 1523,
      rating: 4.9,
      description: 'Sejarah kehidupan Rasulullah SAW yang penuh hikmah'
      },
      'fiqih-shalat': {
      title: 'Fiqih Shalat Lengkap',
      ustadz: 'Ustadz Ridwan Kamil',
      duration: '0:55:45',
      views: 3245,
      rating: 4.8,
      description: 'Panduan lengkap fiqih shalat dari A sampai Z'
      },
      'doa-dzikir': {
      title: 'Doa & Dzikir Harian',
      ustadz: 'Ustadzah Fatimah Az-Zahra',
      duration: '1:20:15',
      views: 1876,
      rating: 4.9,
      description: 'Kumpulan doa dan dzikir yang diamalkan sehari-hari'
      }
      };
      
      // Enhanced Live Kajian functionality
      let chatMessages = [];
      let isMobileChatOpen = false;
      let messageCount = 0;
      
      function joinLiveKajian(kajianId) {
      try {
      const modal = document.getElementById('live-kajian-modal');
      showModal('live-kajian-modal');
      
      // Initialize chat
      initializeLiveChat();
      
      // Update UI elements
      document.getElementById('live-kajian-title').textContent = 'Tafsir Surat Al-Baqarah';
      document.getElementById('live-kajian-ustadz').textContent = 'Ustadz Ahmad Syakir';
      updateParticipantCount(450);
      updateDuration('45:32');
      
      showNotification('Bergabung dengan kajian live', 'success');
      
      // Start live updates
      startLiveUpdates();
      
      // Add event listeners
      setupChatEventListeners();
      
      } catch (error) {
      console.error('Error in joinLiveKajian:', error);
      showNotification('Gagal bergabung dengan kajian live', 'error');
      }
      }
      
      function initializeLiveChat() {
      try {
      // Initial messages
      chatMessages = [
      {
          user: 'Ahmad_123',
          message: 'Barakallahu fiikum ustadz atas penjelasan yang sangat bermanfaat',
          timestamp: new Date()
      },
      {
          user: 'Siti_Muslimah', 
          message: 'Subhanallah, penjelasan yang sangat jelas dan mudah dipahami',
          timestamp: new Date()
      },
      {
          user: 'AbdulRahman',
          message: 'Ustadz, bagaimana dengan ayat selanjutnya? Apakah ada hubungannya dengan ayat sebelumnya?',
          timestamp: new Date()
      }
      ];
      
      messageCount = chatMessages.length;
      updateChatDisplay();
      updateChatCount();
      
      // Start message simulation
      setTimeout(() => {
      simulateLiveChat();
      }, 5000);
      
      } catch (error) {
      console.error('Error in initializeLiveChat:', error);
      }
      }
      
      function setupChatEventListeners() {
      try {
      // Desktop chat input
      const chatInput = document.getElementById('chat-input');
      if (chatInput) {
      chatInput.addEventListener('input', updateCharCount);
      chatInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
              sendChatMessage();
          }
      });
      }
      
      // Mobile chat input
      const mobileChatInput = document.getElementById('mobile-chat-input');
      if (mobileChatInput) {
      mobileChatInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
              sendMobileChatMessage();
          }
      });
      }
      
      } catch (error) {
      console.error('Error in setupChatEventListeners:', error);
      }
      }
      
      function updateCharCount() {
      try {
      const input = document.getElementById('chat-input');
      const counter = document.getElementById('char-count');
      
      if (input && counter) {
      const length = input.value.length;
      counter.textContent = `${length}/500`;
      
      if (length > 450) {
          counter.classList.add('text-red-500');
      } else {
          counter.classList.remove('text-red-500');
      }
      }
      } catch (error) {
      console.error('Error in updateCharCount:', error);
      }
      }
      
      function sendChatMessage() {
      try {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      
      if (message && message.length <= 500) {
      // Add message to array
      chatMessages.push({
          user: 'Anda',
          message: message,
          timestamp: new Date(),
          isOwn: true
      });
      
      messageCount++;
      updateChatDisplay();
      updateChatCount();
      
      // Clear input
      input.value = '';
      updateCharCount();
      
      showNotification('Pesan terkirim', 'success');
      } else if (message.length > 500) {
      showNotification('Pesan terlalu panjang (maksimal 500 karakter)', 'error');
      }
      
      } catch (error) {
      console.error('Error in sendChatMessage:', error);
      }
      }
      
      function sendMobileChatMessage() {
      try {
      const input = document.getElementById('mobile-chat-input');
      const message = input.value.trim();
      
      if (message && message.length <= 500) {
      // Add message to array
      chatMessages.push({
          user: 'Anda',
          message: message,
          timestamp: new Date(),
          isOwn: true
      });
      
      messageCount++;
      updateChatDisplay();
      updateChatCount();
      
      // Clear input
      input.value = '';
      
      showNotification('Pesan terkirim', 'success');
      }
      
      } catch (error) {
      console.error('Error in sendMobileChatMessage:', error);
      }
      }
      
      function updateChatDisplay() {
      try {
      const desktopChat = document.getElementById('chat-messages');
      const mobileChat = document.getElementById('mobile-chat-messages');
      
      const chatHTML = chatMessages.map(msg => {
      const isOwn = msg.isOwn || false;
      const bgClass = isOwn ? 'bg-luyu-green/10 border-l-4 border-luyu-green' : 'bg-gray-100';
      const userClass = isOwn ? 'text-luyu-green font-semibold' : 'text-gray-500';
      
      return `
          <div class="chat-message">
              <div class="text-xs ${userClass} mb-1">${msg.user}</div>
              <div class="${bgClass} rounded-lg p-3 text-sm text-gray-700 break-words">
                  ${msg.message}
              </div>
          </div>
      `;
      }).join('');
      
      if (desktopChat) {
      desktopChat.innerHTML = `<div class="space-y-3">${chatHTML}</div>`;
      desktopChat.scrollTop = desktopChat.scrollHeight;
      }
      
      if (mobileChat) {
      mobileChat.innerHTML = `<div class="space-y-3">${chatHTML}</div>`;
      mobileChat.scrollTop = mobileChat.scrollHeight;
      }
      
      } catch (error) {
      console.error('Error in updateChatDisplay:', error);
      }
      }
      
      function updateChatCount() {
      try {
      const counter = document.getElementById('chat-count');
      if (counter) {
      counter.textContent = `${messageCount} pesan`;
      }
      } catch (error) {
      console.error('Error in updateChatCount:', error);
      }
      }
      
      function updateParticipantCount(count) {
      try {
      const elements = ['live-participants', 'mobile-participants'];
      elements.forEach(id => {
      const element = document.getElementById(id);
      if (element) {
          element.textContent = id.includes('mobile') ? count : `${count} peserta`;
      }
      });
      } catch (error) {
      console.error('Error in updateParticipantCount:', error);
      }
      }
      
      function updateDuration(duration) {
      try {
      const elements = ['live-duration', 'mobile-duration'];
      elements.forEach(id => {
      const element = document.getElementById(id);
      if (element) {
          element.textContent = duration;
      }
      });
      } catch (error) {
      console.error('Error in updateDuration:', error);
      }
      }
      
      function toggleMobileChat() {
      try {
      if (isMobileChatOpen) {
      closeMobileChat();
      } else {
      openMobileChat();
      }
      } catch (error) {
      console.error('Error in toggleMobileChat:', error);
      }
      }
      
      function openMobileChat() {
      try {
      const overlay = document.getElementById('mobile-chat-overlay');
      if (overlay) {
      overlay.classList.remove('hidden');
      updateChatDisplay();
      isMobileChatOpen = true;
      
      // Focus on input
      setTimeout(() => {
          const input = document.getElementById('mobile-chat-input');
          if (input) input.focus();
      }, 300);
      }
      } catch (error) {
      console.error('Error in openMobileChat:', error);
      }
      }
      
      function closeMobileChat() {
      try {
      const overlay = document.getElementById('mobile-chat-overlay');
      if (overlay) {
      overlay.classList.add('hidden');
      isMobileChatOpen = false;
      }
      } catch (error) {
      console.error('Error in closeMobileChat:', error);
      }
      }
      
      function simulateLiveChat() {
      try {
      const simulatedMessages = [
      { user: 'Fatimah_22', message: 'Alhamdulillah, penjelasan yang sangat bermanfaat' },
      { user: 'Abu_Bakar', message: 'Barakallahu fiikum ustadz' },
      { user: 'Aisyah_Muslimah', message: 'Mohon dijelaskan tentang ayat 255' },
      { user: 'Muhammad_87', message: 'Subhanallah, semakin paham sekarang' },
      { user: 'Khadijah_90', message: 'Jazakallahu khairan atas ilmunya' }
      ];
      
      let messageIndex = 0;
      const addMessage = () => {
      if (messageIndex < simulatedMessages.length) {
          const newMessage = {
              ...simulatedMessages[messageIndex],
              timestamp: new Date()
          };
          
          chatMessages.push(newMessage);
          messageCount++;
          updateChatDisplay();
          updateChatCount();
          
          messageIndex++;
          
          // Random interval between 3-8 seconds
          const nextInterval = 3000 + Math.random() * 5000;
          setTimeout(addMessage, nextInterval);
      }
      };
      
      addMessage();
      
      } catch (error) {
      console.error('Error in simulateLiveChat:', error);
      }
      }
      
      function startLiveUpdates() {
      try {
      // Update participant count every 30 seconds
      setInterval(() => {
      const currentCount = parseInt(document.getElementById('live-participants').textContent.match(/\d+/)[0]);
      const newCount = currentCount + Math.floor(Math.random() * 10) - 2; // +/- random
      if (newCount > 0) {
          updateParticipantCount(Math.max(newCount, 1));
      }
      }, 30000);
      
      // Update duration every second
      setInterval(() => {
      const durationElement = document.getElementById('live-duration');
      if (durationElement) {
          const timeMatch = durationElement.textContent.match(/(\d+):(\d+)/);
          if (timeMatch) {
              let minutes = parseInt(timeMatch[1]);
              let seconds = parseInt(timeMatch[2]) + 1;
              
              if (seconds >= 60) {
                  minutes += 1;
                  seconds = 0;
              }
              
              const formattedTime = `${minutes}:${seconds.toString().padStart(2, '0')}`;
              updateDuration(formattedTime);
          }
      }
      }, 1000);
      
      } catch (error) {
      console.error('Error in startLiveUpdates:', error);
      }
      }
      
      // Enhanced modal close function
      const originalCloseModal = closeModal;
      closeModal = function(modalId) {
      if (modalId === 'live-kajian-modal') {
      closeMobileChat();
      }
      originalCloseModal(modalId);
      };
      
      
      function setReminder(kajianId) {
      try {
      const kajian = kajianData[kajianId];
      if (kajian) {
      showNotification(`Reminder diset untuk kajian "${kajian.title}"`, 'success');
      }
      } catch (error) {
      console.error('Error in setReminder:', error);
      showNotification('Gagal mengatur reminder', 'error');
      }
      }
      
      function showKajianDetail(kajianId) {
      try {
      const kajian = kajianData[kajianId];
      if (!kajian) {
      showNotification('Data kajian tidak ditemukan', 'error');
      return;
      }
      
      const modal = document.getElementById('kajian-detail-modal');
      const content = document.getElementById('kajian-detail-content');
      
      content.innerHTML = `
      <div class="space-y-6">
          <!-- Header Info -->
          <div class="text-center p-6 bg-gradient-to-br from-luyu-green to-luyu-blue rounded-xl text-white">
              <h3 class="text-2xl font-bold mb-2">${kajian.title}</h3>
              <p class="text-white/90 mb-4">${kajian.ustadz}</p>
              <div class="flex justify-center items-center space-x-6 text-sm">
                  <span>${kajian.datetime}</span>
                  <span>•</span>
                  <span>${kajian.duration}</span>
                  <span>•</span>
                  <span>${kajian.currentParticipants}/${kajian.maxParticipants} peserta</span>
              </div>
          </div>
      
          <!-- Description -->
          <div>
              <h4 class="text-lg font-bold text-gray-800 mb-3">Deskripsi Kajian</h4>
              <p class="text-gray-600 leading-relaxed">${kajian.description}</p>
          </div>
      
          <!-- Topics -->
          <div>
              <h4 class="text-lg font-bold text-gray-800 mb-3">Topik Pembahasan</h4>
              <div class="grid grid-cols-2 gap-3">
                  ${kajian.topics.map(topic => `
                      <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                          <svg class="w-4 h-4 text-luyu-green mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                          </svg>
                          <span class="text-gray-700">${topic}</span>
                      </div>
                  `).join('')}
              </div>
          </div>
      
          <!-- Prerequisites -->
          <div class="bg-luyu-blue/10 p-4 rounded-xl">
              <h4 class="font-bold text-gray-800 mb-2">Prasyarat</h4>
              <p class="text-gray-600">${kajian.prerequisites}</p>
          </div>
      
          <!-- Actions -->
          <div class="flex space-x-4">
              <button class="flex-1 bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="setReminder('${kajianId}')">
                  <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5 5-5h-5m-6 10V4H4v13h5z"/>
                  </svg>
                  Set Reminder
              </button>
              <button class="flex-1 bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:bg-luyu-blue/90 transition-all" onclick="shareKajian('${kajianId}')">
                  <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                  </svg>
                  Bagikan
              </button>
          </div>
      </div>
      `;
      
      showModal('kajian-detail-modal');
      
      } catch (error) {
      console.error('Error in showKajianDetail:', error);
      showNotification('Gagal memuat detail kajian', 'error');
      }
      }
      
      function playRecordedKajian(videoId) {
      try {
      const video = recordedKajian[videoId];
      if (!video) {
      showNotification('Video tidak ditemukan', 'error');
      return;
      }
      
      const modal = document.getElementById('video-player-modal');
      document.getElementById('video-title').textContent = video.title;
      document.getElementById('playing-title').textContent = video.title;
      document.getElementById('playing-ustadz').textContent = video.ustadz;
      document.getElementById('video-views').textContent = `${video.views.toLocaleString()} views • ${video.rating}/5 ⭐`;
      
      showModal('video-player-modal');
      showNotification(`Memutar: ${video.title}`, 'success');
      
      } catch (error) {
      console.error('Error in playRecordedKajian:', error);
      showNotification('Gagal memutar video', 'error');
      }
      }
      
      function downloadCertificate(certificateId) {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification(`Sertifikat ${certificateId} berhasil diunduh`, 'success');
      
      // Simulate download
      const link = document.createElement('a');
      link.href = '#';
      link.download = `sertifikat-kajian-${certificateId}.pdf`;
      link.click();
      
      }, 2000);
      
      } catch (error) {
      console.error('Error in downloadCertificate:', error);
      hideLoading();
      showNotification('Gagal mengunduh sertifikat', 'error');
      }
      }
      
      function toggleBookmark() {
      try {
      showNotification('Kajian ditambahkan ke bookmark', 'success');
      } catch (error) {
      console.error('Error in toggleBookmark:', error);
      }
      }
      
      function shareKajian(kajianId = null) {
      try {
      if (navigator.share) {
      navigator.share({
          title: 'Kajian Islam Online',
          text: 'Mari ikuti kajian Islam online di platform LUYU',
          url: window.location.href
      });
      } else {
      showNotification('Link kajian berhasil disalin', 'success');
      }
      } catch (error) {
      console.error('Error in shareKajian:', error);
      showNotification('Gagal membagikan kajian', 'error');
      }
      }
      
      function showKajianSchedule() {
      try {
      showNotification('Fitur jadwal lengkap akan segera tersedia', 'info');
      } catch (error) {
      console.error('Error in showKajianSchedule:', error);
      }
      }
      
      function requestKajianTopic() {
      try {
      showNotification('Fitur request topik kajian akan segera tersedia', 'info');
      } catch (error) {
      console.error('Error in requestKajianTopic:', error);
      }
      }
      
      // Simulate real-time updates for live kajian
      function startKajianUpdates() {
      try {
      setInterval(() => {
      // Update participant count
      const participantElement = document.getElementById('live-participants');
      if (participantElement) {
          const currentCount = parseInt(participantElement.textContent.match(/\d+/)[0]);
          const newCount = currentCount + Math.floor(Math.random() * 5);
          participantElement.textContent = `${newCount} peserta`;
      }
      
      // Update duration
      const durationElement = document.getElementById('live-duration');
      if (durationElement) {
          const timeMatch = durationElement.textContent.match(/(\d+):(\d+)/);
          if (timeMatch) {
              let minutes = parseInt(timeMatch[1]);
              let seconds = parseInt(timeMatch[2]) + 1;
              
              if (seconds >= 60) {
                  minutes += 1;
                  seconds = 0;
              }
              
              durationElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
          }
      }
      }, 1000);
      } catch (error) {
      console.error('Error in startKajianUpdates:', error);
      }
      }
      
      // Initialize kajian features when page loads
      document.addEventListener('DOMContentLoaded', function() {
      try {
      startKajianUpdates();
      } catch (error) {
      console.error('Error initializing kajian features:', error);
      }
      });
      
      // Settings functionality
      let currentRating = 0;
      
      function saveProfileSettings() {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('profile-settings-modal');
      showNotification('Profil berhasil diperbarui', 'success');
      }, 2000);
      
      } catch (error) {
      console.error('Error in saveProfileSettings:', error);
      hideLoading();
      showNotification('Gagal memperbarui profil', 'error');
      }
      }
      
      function changePassword() {
      try {
      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      if (!currentPassword || !newPassword || !confirmPassword) {
      showNotification('Mohon lengkapi semua field password', 'error');
      return;
      }
      
      if (newPassword !== confirmPassword) {
      showNotification('Konfirmasi password tidak cocok', 'error');
      return;
      }
      
      if (newPassword.length < 8) {
      showNotification('Password baru minimal 8 karakter', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification('Password berhasil diubah', 'success');
      
      // Clear form
      document.getElementById('current-password').value = '';
      document.getElementById('new-password').value = '';
      document.getElementById('confirm-password').value = '';
      }, 2500);
      
      } catch (error) {
      console.error('Error in changePassword:', error);
      hideLoading();
      showNotification('Gagal mengubah password', 'error');
      }
      }
      
      function addPaymentMethod(type) {
      try {
      if (type === 'card') {
      showNotification('Fitur tambah kartu akan segera tersedia', 'info');
      } else {
      showNotification(`Fitur tambah ${type} akan segera tersedia`, 'info');
      }
      } catch (error) {
      console.error('Error in addPaymentMethod:', error);
      }
      }
      
      function clearCache() {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification('Cache berhasil dihapus', 'success');
      }, 2000);
      
      } catch (error) {
      console.error('Error in clearCache:', error);
      hideLoading();
      showNotification('Gagal menghapus cache', 'error');
      }
      }
      
      function manageDownloads() {
      try {
      showNotification('Fitur kelola download akan segera tersedia', 'info');
      } catch (error) {
      console.error('Error in manageDownloads:', error);
      }
      }
      
      function exportUserData() {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification('Data profil berhasil di-export', 'success');
      
      // Simulate download
      const link = document.createElement('a');
      link.href = '#';
      link.download = 'luyu-profile-data.json';
      link.click();
      }, 2500);
      
      } catch (error) {
      console.error('Error in exportUserData:', error);
      hideLoading();
      showNotification('Gagal export data profil', 'error');
      }
      }
      
      function exportTransactionData() {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification('Data transaksi berhasil di-export', 'success');
      
      // Simulate download
      const link = document.createElement('a');
      link.href = '#';
      link.download = 'luyu-transaction-data.csv';
      link.click();
      }, 3000);
      
      } catch (error) {
      console.error('Error in exportTransactionData:', error);
      hideLoading();
      showNotification('Gagal export data transaksi', 'error');
      }
      }
      
      function checkForUpdates() {
      try {
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      showNotification('Aplikasi sudah versi terbaru', 'success');
      }, 2000);
      
      } catch (error) {
      console.error('Error in checkForUpdates:', error);
      hideLoading();
      showNotification('Gagal cek update', 'error');
      }
      }
      
      function showFAQ() {
      try {
      showNotification('Membuka halaman FAQ...', 'info');
      setTimeout(() => {
      window.open('#', '_blank');
      }, 1000);
      } catch (error) {
      console.error('Error in showFAQ:', error);
      }
      }
      
      function contactSupport() {
      try {
      showNotification('Menghubungkan ke customer support...', 'info');
      setTimeout(() => {
      showNotification('Support tersedia 24/7 via WhatsApp: +62 811-LUYU-001', 'success');
      }, 1500);
      } catch (error) {
      console.error('Error in contactSupport:', error);
      }
      }
      
      function showPrivacyPolicy() {
      try {
      showNotification('Membuka Privacy Policy...', 'info');
      setTimeout(() => {
      window.open('#', '_blank');
      }, 1000);
      } catch (error) {
      console.error('Error in showPrivacyPolicy:', error);
      }
      }
      
      function showTermsOfService() {
      try {
      showNotification('Membuka Terms of Service...', 'info');
      setTimeout(() => {
      window.open('#', '_blank');
      }, 1000);
      } catch (error) {
      console.error('Error in showTermsOfService:', error);
      }
      }
      
      function setRating(rating) {
      try {
      currentRating = rating;
      
      // Update star display
      const stars = document.querySelectorAll('#feedback-modal button[onclick*="setRating"]');
      stars.forEach((star, index) => {
      if (index < rating) {
          star.className = 'text-3xl text-luyu-gold transition-all';
      } else {
          star.className = 'text-3xl text-gray-300 hover:text-luyu-gold transition-all';
      }
      });
      
      } catch (error) {
      console.error('Error in setRating:', error);
      }
      }
      
      function submitFeedback() {
      try {
      const category = document.getElementById('feedback-category').value;
      const message = document.getElementById('feedback-message').value;
      const allowContact = document.getElementById('feedback-contact').checked;
      
      if (!message.trim()) {
      showNotification('Mohon tulis pesan feedback', 'error');
      return;
      }
      
      if (currentRating === 0) {
      showNotification('Mohon berikan rating untuk aplikasi', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('feedback-modal');
      showNotification('Terima kasih atas feedback Anda!', 'success');
      
      // Clear form
      document.getElementById('feedback-message').value = '';
      document.getElementById('feedback-contact').checked = false;
      currentRating = 0;
      
      // Reset stars
      const stars = document.querySelectorAll('#feedback-modal button[onclick*="setRating"]');
      stars.forEach(star => {
          star.className = 'text-3xl text-gray-300 hover:text-luyu-gold transition-all';
      });
      
      }, 2500);
      
      } catch (error) {
      console.error('Error in submitFeedback:', error);
      hideLoading();
      showNotification('Gagal mengirim feedback', 'error');
      }
      }
      
      function resetSettings() {
      try {
      const resetNotifications = document.getElementById('reset-notifications').checked;
      const resetPrivacy = document.getElementById('reset-privacy').checked;
      const resetIslamic = document.getElementById('reset-islamic').checked;
      const resetDisplay = document.getElementById('reset-display').checked;
      
      if (!resetNotifications && !resetPrivacy && !resetIslamic && !resetDisplay) {
      showNotification('Pilih minimal satu kategori untuk direset', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('reset-settings-modal');
      showNotification('Pengaturan berhasil direset ke default', 'success');
      
      // Reset checkboxes
      document.getElementById('reset-notifications').checked = false;
      document.getElementById('reset-privacy').checked = false;
      document.getElementById('reset-islamic').checked = false;
      document.getElementById('reset-display').checked = false;
      
      }, 3000);
      
      } catch (error) {
      console.error('Error in resetSettings:', error);
      hideLoading();
      showNotification('Gagal reset pengaturan', 'error');
      }
      }
      
      function deactivateAccount() {
      try {
      const reason = document.getElementById('deactivate-reason').value;
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('deactivate-account-modal');
      showNotification('Akun berhasil dinonaktifkan', 'success');
      
      // Redirect to login after 3 seconds
      setTimeout(() => {
          showNotification('Mengarahkan ke halaman login...', 'info');
      }, 3000);
      
      }, 2500);
      
      } catch (error) {
      console.error('Error in deactivateAccount:', error);
      hideLoading();
      showNotification('Gagal menonaktifkan akun', 'error');
      }
      }
      
      function deleteAccount() {
      try {
      const confirmation = document.getElementById('delete-confirmation').value;
      const password = document.getElementById('delete-password').value;
      
      if (confirmation !== 'HAPUS AKUN') {
      showNotification('Mohon ketik "HAPUS AKUN" untuk konfirmasi', 'error');
      return;
      }
      
      if (!password) {
      showNotification('Mohon masukkan password Anda', 'error');
      return;
      }
      
      showLoading();
      
      setTimeout(() => {
      hideLoading();
      closeModal('delete-account-modal');
      showNotification('Akun berhasil dihapus. Terima kasih telah menggunakan LUYU.', 'success');
      
      // Redirect after 5 seconds
      setTimeout(() => {
          showNotification('Mengarahkan ke halaman utama...', 'info');
      }, 5000);
      
      }, 3000);
      
      } catch (error) {
      console.error('Error in deleteAccount:', error);
      hideLoading();
      showNotification('Gagal menghapus akun', 'error');
      }
      }
      
      // Settings auto-save functionality
      function initializeSettingsAutoSave() {
      try {
      // Listen to all switch changes and save automatically
      document.addEventListener('change', function(e) {
      if (e.target.type === 'checkbox' && e.target.closest('.switch')) {
          const settingId = e.target.id;
          const isChecked = e.target.checked;
          
          // Save to localStorage
          localStorage.setItem(`luyu_setting_${settingId}`, isChecked);
          
          // Show brief notification for important settings
          if (['push-notifications', 'gps-tracking', 'auto-backup'].includes(settingId)) {
              const settingName = settingId.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
              showNotification(`${settingName} ${isChecked ? 'diaktifkan' : 'dinonaktifkan'}`, 'info');
          }
      }
      });
      
      // Listen to select changes
      document.addEventListener('change', function(e) {
      if (e.target.tagName === 'SELECT') {
          const settingId = e.target.id;
          const value = e.target.value;
          
          localStorage.setItem(`luyu_setting_${settingId}`, value);
          
          // Handle specific settings
          switch(settingId) {
              case 'app-theme':
                  applyTheme(value);
                  break;
              case 'app-language':
                  applyLanguage(value);
                  break;
              case 'font-size':
                  applyFontSize(value);
                  break;
          }
      }
      });
      
      } catch (error) {
      console.error('Error in initializeSettingsAutoSave:', error);
      }
      }
      
      function loadSavedSettings() {
      try {
      // Load saved settings from localStorage
      const settings = {};
      for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      if (key.startsWith('luyu_setting_')) {
          const settingId = key.replace('luyu_setting_', '');
          const value = localStorage.getItem(key);
          settings[settingId] = value;
      }
      }
      
      // Apply saved settings
      Object.keys(settings).forEach(settingId => {
      const element = document.getElementById(settingId);
      if (element) {
          if (element.type === 'checkbox') {
              element.checked = settings[settingId] === 'true';
          } else {
              element.value = settings[settingId];
          }
      }
      });
      
      } catch (error) {
      console.error('Error in loadSavedSettings:', error);
      }
      }
      
      function applyTheme(theme) {
      try {
      document.body.className = document.body.className.replace(/theme-\w+/g, '');
      if (theme !== 'light') {
      document.body.classList.add(`theme-${theme}`);
      }
      showNotification(`Theme diubah ke ${theme}`, 'info');
      } catch (error) {
      console.error('Error in applyTheme:', error);
      }
      }
      
      function applyLanguage(language) {
      try {
      document.documentElement.lang = language;
      showNotification('Bahasa aplikasi akan berubah setelah restart', 'info');
      } catch (error) {
      console.error('Error in applyLanguage:', error);
      }
      }
      
      function applyFontSize(size) {
      try {
      document.body.className = document.body.className.replace(/font-size-\w+/g, '');
      document.body.classList.add(`font-size-${size}`);
      showNotification(`Ukuran font diubah ke ${size}`, 'info');
      } catch (error) {
      console.error('Error in applyFontSize:', error);
      }
      }
      
      // Initialize settings when page loads
      document.addEventListener('DOMContentLoaded', function() {
      try {
      initializeSettingsAutoSave();
      loadSavedSettings();
      } catch (error) {
      console.error('Error initializing settings:', error);
      }
      });
      
      // Mobile responsive functionality
      let isMobileSidebarOpen = false;
      
      function toggleMobileSidebar() {
      try {
      const sidebar = document.querySelector('aside');
      const overlay = document.getElementById('mobile-overlay');
      const hamburger = document.querySelector('.hamburger-menu');
      
      if (isMobileSidebarOpen) {
      closeMobileSidebar();
      } else {
      openMobileSidebar();
      }
      } catch (error) {
      console.error('Error in toggleMobileSidebar:', error);
      }
      }
      
      function openMobileSidebar() {
      try {
      const sidebar = document.querySelector('aside');
      const overlay = document.getElementById('mobile-overlay');
      const hamburger = document.querySelector('.hamburger-menu');
      
      sidebar.classList.add('mobile-open');
      overlay.classList.add('active');
      hamburger.classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
      
      isMobileSidebarOpen = true;
      } catch (error) {
      console.error('Error in openMobileSidebar:', error);
      }
      }
      
      function closeMobileSidebar() {
      try {
      const sidebar = document.querySelector('aside');
      const overlay = document.getElementById('mobile-overlay');
      const hamburger = document.querySelector('.hamburger-menu');
      
      sidebar.classList.remove('mobile-open');
      overlay.classList.remove('active');
      hamburger.classList.remove('active');
      document.body.style.overflow = 'auto'; // Re-enable background scrolling
      
      isMobileSidebarOpen = false;
      } catch (error) {
      console.error('Error in closeMobileSidebar:', error);
      }
      }
      
      // Close sidebar when clicking on sidebar items (mobile)
      function handleSidebarItemClick() {
      if (window.innerWidth <= 1024) {
      closeMobileSidebar();
      }
      }
      
      // Touch gesture support for mobile sidebar
      let touchStartX = 0;
      let touchEndX = 0;
      
      function handleTouchStart(e) {
      touchStartX = e.changedTouches[0].screenX;
      }
      
      function handleTouchEnd(e) {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipeGesture();
      }
      
      function handleSwipeGesture() {
      const swipeThreshold = 50;
      const swipeDistance = touchEndX - touchStartX;
      
      // Swipe right to open sidebar (from left edge)
      if (swipeDistance > swipeThreshold && touchStartX < 50 && !isMobileSidebarOpen) {
      openMobileSidebar();
      }
      
      // Swipe left to close sidebar
      if (swipeDistance < -swipeThreshold && isMobileSidebarOpen) {
      closeMobileSidebar();
      }
      }
      
      // Initialize mobile responsiveness
      function initializeMobileResponsiveness() {
      try {
      // Add touch event listeners
      document.addEventListener('touchstart', handleTouchStart, { passive: true });
      document.addEventListener('touchend', handleTouchEnd, { passive: true });
      
      // Close sidebar on window resize to desktop
      window.addEventListener('resize', function() {
      if (window.innerWidth > 1024 && isMobileSidebarOpen) {
          closeMobileSidebar();
      }
      });
      
      // Add click handlers to sidebar items for mobile
      document.querySelectorAll('.sidebar-item').forEach(item => {
      item.addEventListener('click', handleSidebarItemClick);
      });
      
      // Prevent body scroll when modals are open on mobile
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
      modal.addEventListener('click', function(e) {
          if (e.target === this) {
              document.body.style.overflow = 'auto';
          }
      });
      });
      
      } catch (error) {
      console.error('Error in initializeMobileResponsiveness:', error);
      }
      }
      
      // Enhanced showPage function for mobile
      const originalShowPage = showPage;
      showPage = function(pageId) {
      originalShowPage(pageId);
      
      // Close mobile sidebar when navigating on mobile
      if (window.innerWidth <= 1024) {
      setTimeout(() => {
      closeMobileSidebar();
      }, 100);
      }
      };
      
      // Initialize when page loads
      document.addEventListener('DOMContentLoaded', function() {
      initializeMobileResponsiveness();
      });
      
      // Dark Mode Functionality - FIXED
      let isDarkMode = false;
      
      function initializeDarkMode() {
      try {
      // Check saved preference or system preference
      const savedTheme = localStorage.getItem('luyu-theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      isDarkMode = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
      
      // Apply theme without animation on initial load
      document.documentElement.classList.add('theme-transition');
      
      if (isDarkMode) {
      document.documentElement.classList.add('dark');
      }
      
      // Update icons and tooltip immediately
      updateThemeIcons();
      updateThemeTooltip();
      
      // Listen for system theme changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', handleSystemThemeChange);
      
      } catch (error) {
      console.error('Error initializing dark mode:', error);
      }
      }
      
      function toggleDarkMode() {
      try {
      // Add loading state
      const toggleButton = document.getElementById('dark-mode-toggle');
      toggleButton.style.pointerEvents = 'none';
      
      // Add icon animation
      const sunIcon = document.getElementById('sun-icon');
      const moonIcon = document.getElementById('moon-icon');
      
      // Trigger animation
      sunIcon.classList.add('theme-icon-animation');
      moonIcon.classList.add('theme-icon-animation');
      
      // Toggle theme
      isDarkMode = !isDarkMode;
      
      if (isDarkMode) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('luyu-theme', 'dark');
      showNotification('Switched to Dark Mode', 'success');
      } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('luyu-theme', 'light');
      showNotification('Switched to Light Mode', 'success');
      }
      
      // Update icons and tooltip
      updateThemeIcons();
      updateThemeTooltip();
      
      // Re-enable button after animation
      setTimeout(() => {
      toggleButton.style.pointerEvents = 'auto';
      sunIcon.classList.remove('theme-icon-animation');
      moonIcon.classList.remove('theme-icon-animation');
      }, 500);
      
      // Update any dynamic content that needs theme adjustment
      updateThemeSpecificContent();
      
      } catch (error) {
      console.error('Error toggling dark mode:', error);
      showNotification('Failed to switch theme', 'error');
      }
      }
      
      function updateThemeIcons() {
      try {
      const sunIcon = document.getElementById('sun-icon');
      const moonIcon = document.getElementById('moon-icon');
      
      if (isDarkMode) {
      // Dark mode active - show moon
      sunIcon.style.opacity = '0';
      sunIcon.style.transform = 'rotate(90deg) scale(0)';
      moonIcon.style.opacity = '1';
      moonIcon.style.transform = 'rotate(0deg) scale(1)';
      } else {
      // Light mode active - show sun
      sunIcon.style.opacity = '1';
      sunIcon.style.transform = 'rotate(0deg) scale(1)';
      moonIcon.style.opacity = '0';
      moonIcon.style.transform = 'rotate(90deg) scale(0)';
      }
      } catch (error) {
      console.error('Error updating theme icons:', error);
      }
      }
      
      function updateThemeTooltip() {
      try {
      const tooltip = document.getElementById('theme-tooltip');
      if (tooltip) {
      tooltip.textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
      }
      } catch (error) {
      console.error('Error updating theme tooltip:', error);
      }
      }
      
      function updateThemeSpecificContent() {
      try {
      // Update dashboard numbers to ensure they're visible
      updateDashboardNumbers();
      
      // Update map colors if on maps page
      if (currentPage === 'maps') {
      updateMapTheme(isDarkMode);
      }
      
      // Update any other theme-dependent components
      updateComponentThemes();
      
      } catch (error) {
      console.error('Error updating theme-specific content:', error);
      }
      }
      
      function updateDashboardNumbers() {
      try {
      // Force update dashboard numbers color
      const dashboardNumbers = document.querySelectorAll('.text-3xl, .text-2xl, .text-xl');
      dashboardNumbers.forEach(element => {
      if (element.closest('.bg-white')) {
          if (isDarkMode) {
              element.style.color = '#f9fafb';
          } else {
              element.style.color = '';
          }
      }
      });
      
      // Update specific dashboard stat elements
      const statElements = document.querySelectorAll('[class*="font-bold"]');
      statElements.forEach(element => {
      if (element.closest('.bg-white') && !element.closest('.text-luyu-')) {
          if (isDarkMode) {
              element.style.color = '#f9fafb';
          } else {
              element.style.color = '';
          }
      }
      });
      
      } catch (error) {
      console.error('Error updating dashboard numbers:', error);
      }
      }
      
      // Map theme updates - FIXED for Cluster B
      function updateMapTheme(isDark) {
      try {
      // Update SVG map colors
      const mapSvg = document.querySelector('#interactive-map svg');
      if (mapSvg) {
      // Update background
      const bgRect = mapSvg.querySelector('rect');
      if (bgRect) {
          bgRect.setAttribute('fill', isDark ? '#374151' : '#f8f9fa');
      }
      
      // Update Cluster B specifically
      const clusterB = mapSvg.querySelector('.cluster-zone[data-cluster="b"] rect');
      if (clusterB) {
          if (isDark) {
              clusterB.setAttribute('fill', 'rgba(251, 191, 36, 0.15)');
              clusterB.setAttribute('stroke', '#fbbf24');
          } else {
              clusterB.setAttribute('fill', '#f39c1220');
              clusterB.setAttribute('stroke', '#f39c12');
          }
      }
      
      // Update Cluster B text
      const clusterBTexts = mapSvg.querySelectorAll('.cluster-zone[data-cluster="b"] text');
      clusterBTexts.forEach(text => {
          if (isDark) {
              text.setAttribute('fill', '#fbbf24');
          } else {
              text.classList.add('fill-orange-600');
          }
      });
      
      // Update driver markers
      const orangeMarkers = mapSvg.querySelectorAll('.driver-marker[fill="#f39c12"]');
      orangeMarkers.forEach(marker => {
          if (isDark) {
              marker.setAttribute('fill', '#fbbf24');
              marker.setAttribute('stroke', '#1f2937');
          } else {
              marker.setAttribute('fill', '#f39c12');
              marker.setAttribute('stroke', 'white');
          }
      });
      }
      
      } catch (error) {
      console.error('Error updating map theme:', error);
      }
      }
      
      // Enhanced page loading with theme fixes
      const originalLoadPageContent = loadPageContent;
      loadPageContent = function(pageId) {
      originalLoadPageContent(pageId);
      
      // Apply theme fixes after page loads
      setTimeout(() => {
      updateThemeSpecificContent();
      }, 100);
      };
      
      // Initialize dark mode when page loads
      document.addEventListener('DOMContentLoaded', function() {
      initializeDarkMode();
      
      // Additional fix for initial load
      setTimeout(() => {
      updateThemeSpecificContent();
      }, 500);
      });
      
      class PreloaderManager {
      constructor(options = {}) {
        this.options = {
            duration: 3000,
            showProgress: true,
            autoHide: true,
            customLogo: null,
            appName: 'LUYU',
            tagline: 'Ojek Online Syariah',
            loadingTexts: [
                'Memuat aplikasi...',
                'Menyiapkan interface...',
                'Menghubungkan server...',
                'Hampir selesai...'
            ],
            onComplete: null,
            ...options
        };
        
        this.currentProgress = 0;
        this.currentTextIndex = 0;
        this.progressInterval = null;
        this.textInterval = null;
        
        this.init();
      }
      
      init() {
        this.setupCustomization();
        this.startProgress();
        this.startTextRotation();
        
        if (this.options.autoHide) {
            this.startAutoHide();
        }
      }
      
      setupCustomization() {
        const appNameEl = document.getElementById('app-name');
        const taglineEl = document.getElementById('app-tagline');
        
        if (appNameEl) appNameEl.textContent = this.options.appName;
        if (taglineEl) taglineEl.textContent = this.options.tagline;
        
        if (this.options.customLogo) {
            this.setCustomLogo(this.options.customLogo);
        }
      }
      
      setCustomLogo(logoSrc) {
        const defaultLogo = document.getElementById('default-logo');
        const customLogo = document.getElementById('custom-logo');
        const customImg = document.getElementById('custom-logo-img');
        
        if (defaultLogo && customLogo && customImg) {
            defaultLogo.classList.add('hidden');
            customLogo.classList.remove('hidden');
            customImg.src = logoSrc;
        }
      }
      
      startProgress() {
        if (!this.options.showProgress) return;
        
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-percentage');
        
        this.progressInterval = setInterval(() => {
            if (this.currentProgress < 100) {
                const increment = Math.random() * 15 + 5;
                this.currentProgress = Math.min(100, this.currentProgress + increment);
                
                if (progressFill) {
                    progressFill.style.width = `${this.currentProgress}%`;
                }
                
                if (progressText) {
                    progressText.textContent = `${Math.round(this.currentProgress)}%`;
                }
                
                if (this.currentProgress > 90) {
                    clearInterval(this.progressInterval);
                    this.finishProgress();
                }
            }
        }, 100);
      }
      
      finishProgress() {
        setTimeout(() => {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-percentage');
            
            if (progressFill) progressFill.style.width = '100%';
            if (progressText) progressText.textContent = '100%';
            
            if (this.options.onComplete) {
                this.options.onComplete();
            }
        }, 200);
      }
      
      startTextRotation() {
        if (this.options.loadingTexts.length <= 1) return;
        
        const loadingTextEl = document.getElementById('loading-text');
        
        this.textInterval = setInterval(() => {
            this.currentTextIndex = (this.currentTextIndex + 1) % this.options.loadingTexts.length;
            
            if (loadingTextEl) {
                loadingTextEl.style.opacity = '0';
                
                setTimeout(() => {
                    loadingTextEl.textContent = this.options.loadingTexts[this.currentTextIndex];
                    loadingTextEl.style.opacity = '1';
                }, 200);
            }
        }, 800);
      }
      
      startAutoHide() {
        setTimeout(() => {
            this.hide();
        }, this.options.duration);
      }
      
      hide() {
        if (this.progressInterval) clearInterval(this.progressInterval);
        if (this.textInterval) clearInterval(this.textInterval);
        
        const preloader = document.getElementById('preloader');
        if (preloader) {
            preloader.classList.add('fade-out');
            
            setTimeout(() => {
                preloader.style.display = 'none';
                document.body.style.overflow = 'auto';
                this.onPreloaderComplete();
            }, 800);
        }
      }
      
      onPreloaderComplete() {
        console.log('LUYU Preloader completed!');
        
        // Initialize app jika diperlukan
        if (typeof initializeApp === 'function') {
            initializeApp();
        }
      }
      
      // Public methods
      setProgress(percentage) {
        this.currentProgress = Math.max(0, Math.min(100, percentage));
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-percentage');
        
        if (progressFill) progressFill.style.width = `${this.currentProgress}%`;
        if (progressText) progressText.textContent = `${Math.round(this.currentProgress)}%`;
      }
      
      setLoadingText(text) {
        const loadingTextEl = document.getElementById('loading-text');
        if (loadingTextEl) {
            loadingTextEl.textContent = text;
        }
      }
      }
      
      // Global instance
      let preloaderInstance = null;
      
      // Auto-initialize when DOM ready
      document.addEventListener('DOMContentLoaded', function() {
      // Prevent body scroll
      document.body.style.overflow = 'hidden';
      
      // Initialize preloader
      preloaderInstance = new PreloaderManager({
        duration: 3500,
        showProgress: true,
        autoHide: true,
        onComplete: function() {
            console.log('App loaded successfully!');
        }
      });
      });
      
      // Utility functions
      function hidePreloader() {
      if (preloaderInstance) preloaderInstance.hide();
      }
      
      function setPreloaderProgress(percentage) {
      if (preloaderInstance) preloaderInstance.setProgress(percentage);
      }
      
      function updatePreloaderText(text) {
      if (preloaderInstance) preloaderInstance.setLoadingText(text);
      }
    </script>
  </body>
</html>
