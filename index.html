<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUYU - Platform Ojol Syariah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'luyu-green': '#2ecc71',
                        'luyu-gold': '#f1c40f',
                        'luyu-blue': '#3498db',
                        'luyu-red': '#e74c3c',
                        'luyu-purple': '#9b59b6',
                        'luyu-gray': '#95a5a6'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-right': 'slideRight 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideRight {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #d1d5db;
            transition: all 0.4s ease;
            border-radius: 24px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: all 0.4s ease;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        input:checked + .slider {
            background-color: #2ecc71;
            box-shadow: inset 0 2px 4px rgba(46, 204, 113, 0.3);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* Enhanced switch variants */
        .switch-gold input:checked + .slider {
            background-color: #f1c40f;
            box-shadow: inset 0 2px 4px rgba(241, 196, 15, 0.3);
        }
        
        .switch-blue input:checked + .slider {
            background-color: #3498db;
            box-shadow: inset 0 2px 4px rgba(52, 152, 219, 0.3);
        }
        
        .switch-purple input:checked + .slider {
            background-color: #9b59b6;
            box-shadow: inset 0 2px 4px rgba(155, 89, 182, 0.3);
        }

        .sidebar-item:hover {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .gradient-text {
            background: linear-gradient(135deg, #2ecc71, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .modal:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }

        .notification-enter {
            animation: slideUp 0.3s ease-out;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2ecc71;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-table {
            overflow-x: auto;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .data-table th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .data-table tr:hover {
            background-color: #f9fafb;
        }

        /* Driver panel styles */
        .driver-panel {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .driver-panel.active {
            transform: translateX(0);
        }

        /* Interactive map styles */
        .cluster-zone {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cluster-zone:hover {
            opacity: 0.8;
            stroke-width: 3;
        }

        .driver-marker {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .driver-marker:hover {
            transform: scale(1.2);
        }

        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        /* Status badges */
        .status-pending {
            background-color: #f1c40f;
            color: #856404;
        }

        .status-confirmed {
            background-color: #3498db;
            color: #1a365d;
        }

        .status-pickup {
            background-color: #9b59b6;
            color: #4a1a4a;
        }

        .status-ongoing {
            background-color: #e67e22;
            color: #8b4513;
        }

        .status-completed {
            background-color: #2ecc71;
            color: #155724;
        }

        .status-cancelled {
            background-color: #e74c3c;
            color: #721c24;
        }

        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #3498db);
            transition: width 0.3s ease;
        }

        /* Chart containers */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .chart-container canvas {
            max-height: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

<!-- NOTIFICATION SYSTEM -->
<div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- LOADING OVERLAY -->
<div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center">
    <div class="bg-white rounded-lg p-6 flex items-center">
        <div class="loading-spinner mr-3"></div>
        <span class="text-gray-700">Memproses...</span>
    </div>
</div>

<!-- TOOLTIP -->
<div id="tooltip" class="tooltip"></div>

<!-- MAIN CONTAINER -->
<div class="flex min-h-screen">

    <!-- ========== SIDEBAR ========== -->
    <aside class="w-72 bg-white border-r border-gray-200 shadow-lg">
        <!-- LOGO & BRAND -->
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-gradient-to-r from-luyu-green to-luyu-blue rounded-xl flex items-center justify-center">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <div class="ml-3">
                    <h1 class="text-xl font-bold gradient-text">LUYU</h1>
                    <p class="text-sm text-gray-500">Ojol Syariah Platform</p>
                </div>
            </div>
        </div>

        <!-- NAVIGATION MENU -->
        <nav class="p-4">
            <div class="space-y-2">
                <a href="#" onclick="showPage('dashboard')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="dashboard">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span class="font-medium">Dashboard</span>
                </a>

                <a href="#" onclick="showPage('maps')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="maps">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"/>
                    </svg>
                    <span class="font-medium">Peta Cluster</span>
                </a>

                <a href="#" onclick="showPage('orders')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="orders">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                    </svg>
                    <span class="font-medium">Pesanan</span>
                    <span class="ml-auto bg-luyu-red text-white text-xs px-2 py-1 rounded-full">3</span>
                </a>

                <a href="#" onclick="showPage('wallet')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="wallet">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                    </svg>
                    <span class="font-medium">Dompet Syariah</span>
                </a>

                <a href="#" onclick="showPage('analytics')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="analytics">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <span class="font-medium">Analitik</span>
                </a>

                <div class="border-t border-gray-100 my-4 pt-4">
                    <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-3 px-4">Syariah</p>
                    
                    <a href="#" onclick="showPage('zakat')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="zakat">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span class="font-medium">Zakat & Infaq</span>
                    </a>

                    <a href="#" onclick="showPage('wakaf')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="wakaf">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                        <span class="font-medium">Wakaf Digital</span>
                    </a>

                    <a href="#" onclick="showPage('kajian')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="kajian">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        <span class="font-medium">Kajian Online</span>
                    </a>
                </div>

                <div class="border-t border-gray-100 my-4 pt-4">
                    <a href="#" onclick="showPage('settings')" class="sidebar-item flex items-center px-4 py-3 rounded-xl text-gray-700 hover:text-luyu-green transition-all duration-200" data-page="settings">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span class="font-medium">Pengaturan</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- USER PROFILE -->
        <div class="absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100">
            <div class="flex items-center">
                <div class="w-10 h-10 bg-gradient-to-r from-luyu-green to-luyu-blue rounded-full flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
                <div class="ml-3 flex-1">
                    <p class="font-semibold text-gray-800">Ahmad Santoso</p>
                    <p class="text-xs text-gray-500">Level 2 • 230 Pahala</p>
                </div>
                <button class="p-2 hover:bg-gray-100 rounded-lg" onclick="showUserMenu()">
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </aside>

    <!-- ========== MAIN CONTENT ========== -->
    <main class="flex-1 overflow-hidden relative">
        
        <!-- TOP HEADER -->
        <header class="bg-white border-b border-gray-200 px-8 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 id="page-title" class="text-2xl font-bold text-gray-800">Assalamu'alaikum, Ahmad!</h1>
                    <p id="page-subtitle" class="text-gray-600">Semoga hari ini penuh berkah dan kebaikan</p>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- SEARCH -->
                    <div class="relative">
                        <input type="text" placeholder="Cari driver, rute..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent" onkeyup="handleSearch(this.value)">
                        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>

                    <!-- NOTIFICATIONS -->
                    <button class="relative p-2 text-gray-600 hover:text-luyu-green hover:bg-gray-100 rounded-lg" onclick="showNotifications()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5 5-5h-5m-6 10V4H4v13h5z"/>
                        </svg>
                        <span class="absolute -top-1 -right-1 w-5 h-5 bg-luyu-red text-white text-xs rounded-full flex items-center justify-center pulse-slow">5</span>
                    </button>

                    <!-- QUICK ACTIONS -->
                    <button class="bg-gradient-to-r from-luyu-green to-luyu-blue text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="showOrderModal()">
                        Pesan Ojek
                    </button>
                </div>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <div id="main-content" class="p-8 h-full overflow-y-auto">
            <!-- Dynamic content will be loaded here -->
        </div>

        <!-- DRIVER DETAIL PANEL -->
        <div id="driver-panel" class="driver-panel fixed top-0 right-0 w-96 h-full bg-white shadow-2xl border-l border-gray-200 z-30">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Detail Driver</h2>
                    <button onclick="closeDriverPanel()" class="p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div id="driver-detail-content">
                    <!-- Driver details will be loaded here -->
                </div>
            </div>
        </div>
    </main>
</div>

<!-- ========== MODALS ========== -->

<!-- ORDER MODAL -->
<div id="order-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Pesan Ojek Syariah</h2>
            <button onclick="closeModal('order-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <div class="grid grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Dari</label>
                <input type="text" placeholder="Lokasi penjemputan..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ke</label>
                <input type="text" placeholder="Tujuan..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent">
            </div>
        </div>

        <div class="mt-6">
            <div class="bg-luyu-green/10 border border-luyu-green/20 rounded-xl p-4">
                <div class="flex items-center justify-between mb-3">
                    <span class="font-medium text-gray-800">Prioritas Driver Daerah Berkembang</span>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <p class="text-sm text-gray-600">Otomatis memilih driver dari Cluster C (90% untuk driver)</p>
            </div>
        </div>

        <div class="mt-6 flex space-x-4">
            <button class="flex-1 bg-gradient-to-r from-luyu-green to-luyu-blue text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="processOrder()">
                Pesan Sekarang
            </button>
            <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('order-modal')">
                Batal
            </button>
        </div>
    </div>
</div>

<!-- TOP UP MODAL -->
<div id="topup-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Top Up Saldo</h2>
            <button onclick="closeModal('topup-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Top Up</label>
                <input type="number" placeholder="100000" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luyu-green focus:border-transparent" id="topup-amount">
            </div>

            <div class="grid grid-cols-3 gap-3">
                <button class="py-2 px-4 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all" onclick="setTopupAmount(50000)">50K</button>
                <button class="py-2 px-4 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all" onclick="setTopupAmount(100000)">100K</button>
                <button class="py-2 px-4 border border-gray-300 rounded-lg hover:border-luyu-green hover:text-luyu-green transition-all" onclick="setTopupAmount(200000)">200K</button>
            </div>

            <div class="bg-luyu-gold/10 border border-luyu-gold/30 rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-gray-800">Auto-Zakat (2.5%)</span>
                    <label class="switch switch-gold">
                        <input type="checkbox" checked id="auto-zakat">
                        <span class="slider"></span>
                    </label>
                </div>
                <p class="text-sm text-gray-600">Zakat akan dipotong otomatis: <span id="zakat-amount">Rp 2.500</span></p>
            </div>
        </div>

        <div class="mt-6 flex space-x-4">
            <button class="flex-1 bg-gradient-to-r from-luyu-green to-luyu-blue text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="processTopup()">
                Top Up Sekarang
            </button>
            <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all" onclick="closeModal('topup-modal')">
                Batal
            </button>
        </div>
    </div>
</div>

<!-- ORDER DETAIL MODAL -->
<div id="order-detail-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Detail Pesanan</h2>
            <button onclick="closeModal('order-detail-modal')" class="p-2 hover:bg-gray-100 rounded-lg">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div id="order-detail-content">
            <!-- Order details will be loaded here -->
        </div>
    </div>
</div>

<!-- PAGE TEMPLATES -->
<template id="dashboard-template">
    <div class="animate-fade-in">
        <!-- QUICK STATS -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-green/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Total Trip</p>
                        <p class="text-2xl font-bold text-gray-900" id="trip-count">127</p>
                        <p class="text-xs text-luyu-green">+12 bulan ini</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-gold/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Zakat Terkumpul</p>
                        <p class="text-2xl font-bold text-gray-900">Rp 4.8M</p>
                        <p class="text-xs text-luyu-gold">+25% dari target</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-red/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Driver Aktif</p>
                        <p class="text-2xl font-bold text-gray-900" id="driver-count">1,247</p>
                        <p class="text-xs text-luyu-red">89% Cluster C</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 card-hover transition-all duration-300">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-luyu-blue/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Pahala Points</p>
                        <p class="text-2xl font-bold text-gray-900" id="pahala-count">2,340</p>
                        <p class="text-xs text-luyu-blue">Level 2 progress</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- QUICK ORDER SECTION -->
        <div class="bg-gradient-to-r from-luyu-green to-luyu-blue rounded-2xl p-8 text-white mb-8">
            <div class="grid grid-cols-2 gap-8 items-center">
                <div>
                    <h2 class="text-2xl font-bold mb-4">Pesan Ojek Syariah</h2>
                    <p class="text-white/90 mb-6">Dukung driver di wilayah berkembang dengan prioritas syariah</p>
                    
                    <div class="bg-white/20 p-4 rounded-xl mb-6 backdrop-blur-sm">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-medium">Prioritas Driver Daerah Berkembang</span>
                            <label class="switch switch-gold">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p class="text-xs text-white/80">Otomatis memilih driver dari Cluster C (Banten, Lampung)</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <button class="bg-white text-luyu-green font-semibold py-3 px-6 rounded-xl hover:shadow-lg transition-all" onclick="showOrderModal()">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Pesan Ojek
                        </button>
                        <button class="bg-white/20 text-white font-semibold py-3 px-6 rounded-xl hover:bg-white/30 transition-all">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                            Berbagi Berkah
                        </button>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="bg-white/10 p-6 rounded-2xl backdrop-blur-sm">
                        <h3 class="text-lg font-semibold mb-2">Impact Hari Ini</h3>
                        <div class="text-3xl font-bold mb-1" id="impact-count">23</div>
                        <p class="text-sm text-white/80">Driver dibantu</p>
                        <div class="mt-4 pt-4 border-t border-white/20">
                            <p class="text-xs">Sedekah terkumpul</p>
                            <p class="text-xl font-bold" id="sedekah-count">Rp 127.500</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DRIVER TERDEKAT -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Driver Terdekat</h3>
                <button class="text-luyu-green font-semibold text-sm hover:underline" onclick="showPage('maps')">
                    Lihat di Peta
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="driver-card border border-gray-200 rounded-xl p-4 hover:border-luyu-green/30 hover:shadow-md transition-all cursor-pointer" onclick="showDriverDetail('siti')">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="ml-3 flex-1">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-800">Ustadzah Siti</h4>
                                <span class="text-xs bg-luyu-green text-white px-2 py-1 rounded-full">1.2 km</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600 mt-1">
                                <span>Honda Beat • ⭐ 4.9</span>
                                <span class="ml-2 bg-luyu-red text-white px-1 py-0.5 rounded text-xs">C</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500">
                        <span class="bg-luyu-green/10 text-luyu-green px-2 py-1 rounded-full">Online • Prioritas Syariah</span>
                    </div>
                </div>

                <div class="driver-card border border-gray-200 rounded-xl p-4 hover:border-luyu-green/30 hover:shadow-md transition-all cursor-pointer" onclick="showDriverDetail('ahmad')">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="ml-3 flex-1">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-800">Pak Ahmad</h4>
                                <span class="text-xs bg-luyu-green text-white px-2 py-1 rounded-full">1.8 km</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600 mt-1">
                                <span>Yamaha Mio • ⭐ 4.8</span>
                                <span class="ml-2 bg-luyu-red text-white px-1 py-0.5 rounded text-xs">C</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500">
                        <span class="bg-luyu-green/10 text-luyu-green px-2 py-1 rounded-full">Online • Prioritas Syariah</span>
                    </div>
                </div>

                <div class="driver-card border border-gray-200 rounded-xl p-4 hover:border-luyu-blue/30 hover:shadow-md transition-all cursor-pointer" onclick="showDriverDetail('budi')">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="ml-3 flex-1">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-800">Budi</h4>
                                <span class="text-xs bg-luyu-blue text-white px-2 py-1 rounded-full">2.1 km</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600 mt-1">
                                <span>Honda Vario • ⭐ 4.7</span>
                                <span class="ml-2 bg-luyu-blue text-white px-1 py-0.5 rounded text-xs">A</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500">
                        <span class="bg-luyu-blue/10 text-luyu-blue px-2 py-1 rounded-full">Online • Standar</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="analytics-template">
    <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-8">
            <!-- MAIN CHARTS -->
            <div class="col-span-8 space-y-6">
                <!-- OVERVIEW METRICS -->
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Revenue</p>
                                <p class="text-2xl font-bold text-luyu-green">Rp 15.2M</p>
                                <p class="text-xs text-green-600">↑ +12.5%</p>
                            </div>
                            <div class="w-10 h-10 bg-luyu-green/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Zakat Collected</p>
                                <p class="text-2xl font-bold text-luyu-gold">Rp 4.8M</p>
                                <p class="text-xs text-yellow-600">↑ +8.2%</p>
                            </div>
                            <div class="w-10 h-10 bg-luyu-gold/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Active Users</p>
                                <p class="text-2xl font-bold text-luyu-blue">8,247</p>
                                <p class="text-xs text-blue-600">↑ +5.7%</p>
                            </div>
                            <div class="w-10 h-10 bg-luyu-blue/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Driver Satisfaction</p>
                                <p class="text-2xl font-bold text-luyu-purple">4.87</p>
                                <p class="text-xs text-purple-600">↑ +0.3</p>
                            </div>
                            <div class="w-10 h-10 bg-luyu-purple/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- REVENUE CHART -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Trend Revenue & Zakat</h3>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-luyu-green text-white rounded-lg text-sm font-semibold">7 Hari</button>
                            <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">30 Hari</button>
                            <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">1 Tahun</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenue-chart"></canvas>
                    </div>
                </div>

                <!-- CLUSTER PERFORMANCE -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Performa Cluster Wilayah</h3>
                    <div class="grid grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="chart-container h-32 mb-4">
                                <canvas id="cluster-a-chart"></canvas>
                            </div>
                            <h4 class="font-semibold text-gray-800">Cluster A</h4>
                            <p class="text-sm text-gray-600">342 Driver • Jakarta</p>
                            <div class="mt-2">
                                <div class="progress-bar">
                                    <div class="progress-fill bg-luyu-blue" style="width: 85%"></div>
                                </div>
                                <p class="text-xs mt-1 text-gray-500">Target Achievement: 85%</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="chart-container h-32 mb-4">
                                <canvas id="cluster-b-chart"></canvas>
                            </div>
                            <h4 class="font-semibold text-gray-800">Cluster B</h4>
                            <p class="text-sm text-gray-600">198 Driver • Bandung</p>
                            <div class="mt-2">
                                <div class="progress-bar">
                                    <div class="progress-fill bg-orange-500" style="width: 72%"></div>
                                </div>
                                <p class="text-xs mt-1 text-gray-500">Target Achievement: 72%</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="chart-container h-32 mb-4">
                                <canvas id="cluster-c-chart"></canvas>
                            </div>
                            <h4 class="font-semibold text-gray-800">Cluster C</h4>
                            <p class="text-sm text-gray-600">707 Driver • Banten</p>
                            <div class="mt-2">
                                <div class="progress-bar">
                                    <div class="progress-fill bg-luyu-green" style="width: 95%"></div>
                                </div>
                                <p class="text-xs mt-1 text-gray-500">Target Achievement: 95%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IMPACT METRICS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Impact Sosial</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="chart-container">
                            <canvas id="impact-chart"></canvas>
                        </div>
                        <div class="space-y-4">
                            <div class="p-4 bg-luyu-green/10 rounded-lg">
                                <h4 class="font-semibold text-luyu-green">Driver Terbantu</h4>
                                <p class="text-2xl font-bold text-gray-800">1,247</p>
                                <p class="text-sm text-gray-600">Cluster C mendapat prioritas</p>
                            </div>
                            <div class="p-4 bg-luyu-gold/10 rounded-lg">
                                <h4 class="font-semibold text-luyu-gold">Zakat Disalurkan</h4>
                                <p class="text-2xl font-bold text-gray-800">Rp 4.8M</p>
                                <p class="text-sm text-gray-600">Untuk 2,847 mustahiq</p>
                            </div>
                            <div class="p-4 bg-luyu-purple/10 rounded-lg">
                                <h4 class="font-semibold text-luyu-purple">Wakaf Terkumpul</h4>
                                <p class="text-2xl font-bold text-gray-800">Rp 1.2M</p>
                                <p class="text-sm text-gray-600">Untuk masjid & sekolah</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR METRICS -->
            <div class="col-span-4 space-y-6">
                <!-- REALTIME STATS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Real-time Stats</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Orders Today</span>
                            <span class="font-bold text-luyu-green" id="orders-today">1,847</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Active Drivers</span>
                            <span class="font-bold text-luyu-blue" id="active-drivers">1,247</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Avg Response Time</span>
                            <span class="font-bold text-luyu-purple">2.3 min</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Customer Satisfaction</span>
                            <span class="font-bold text-luyu-gold">4.9/5</span>
                        </div>
                    </div>
                </div>

                <!-- TOP PERFORMERS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Top Performing Drivers</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-luyu-green rounded-full flex items-center justify-center text-white font-bold text-sm">1</div>
                                <div class="ml-3">
                                    <p class="font-semibold text-sm">Ustadzah Siti</p>
                                    <p class="text-xs text-gray-500">Cluster C • 47 trips</p>
                                </div>
                            </div>
                            <span class="text-luyu-green font-bold">⭐ 4.9</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-luyu-blue rounded-full flex items-center justify-center text-white font-bold text-sm">2</div>
                                <div class="ml-3">
                                    <p class="font-semibold text-sm">Pak Ahmad</p>
                                    <p class="text-xs text-gray-500">Cluster C • 52 trips</p>
                                </div>
                            </div>
                            <span class="text-luyu-blue font-bold">⭐ 4.8</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-luyu-gold rounded-full flex items-center justify-center text-white font-bold text-sm">3</div>
                                <div class="ml-3">
                                    <p class="font-semibold text-sm">Bu Fatimah</p>
                                    <p class="text-xs text-gray-500">Cluster B • 38 trips</p>
                                </div>
                            </div>
                            <span class="text-luyu-gold font-bold">⭐ 4.8</span>
                        </div>
                    </div>
                </div>

                <!-- RECENT TRANSACTIONS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Transaksi Terbaru</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-luyu-green rounded-full mr-3"></div>
                                <div>
                                    <p class="text-sm font-medium">Trip Completed</p>
                                    <p class="text-xs text-gray-500">15:30 • Cluster C</p>
                                </div>
                            </div>
                            <span class="font-semibold text-luyu-green">+Rp 15.000</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-luyu-gold rounded-full mr-3"></div>
                                <div>
                                    <p class="text-sm font-medium">Auto Zakat</p>
                                    <p class="text-xs text-gray-500">15:28 • Ahmad S.</p>
                                </div>
                            </div>
                            <span class="font-semibold text-luyu-gold">-Rp 375</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-luyu-blue rounded-full mr-3"></div>
                                <div>
                                    <p class="text-sm font-medium">Top Up Saldo</p>
                                    <p class="text-xs text-gray-500">14:45 • Bu Siti</p>
                                </div>
                            </div>
                            <span class="font-semibold text-luyu-blue">+Rp 100.000</span>
                        </div>
                    </div>
                </div>

                <!-- EXPORT OPTIONS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Export Reports</h3>
                    <div class="space-y-3">
                        <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all">
                            Download Revenue Report
                        </button>
                        <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all">
                            Download Zakat Report
                        </button>
                        <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                            Custom Report Builder
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="orders-template">
    <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-8">
            <!-- MAIN ORDER LIST -->
            <div class="col-span-8 space-y-6">
                <!-- ORDER FILTERS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Filter Pesanan</h3>
                        <button class="bg-luyu-green text-white px-4 py-2 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showOrderModal()">
                            + Buat Pesanan Baru
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-4">
                        <select class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterOrders('status', this.value)">
                            <option value="">Semua Status</option>
                            <option value="pending">Menunggu</option>
                            <option value="confirmed">Dikonfirmasi</option>
                            <option value="pickup">Penjemputan</option>
                            <option value="ongoing">Dalam Perjalanan</option>
                            <option value="completed">Selesai</option>
                            <option value="cancelled">Dibatalkan</option>
                        </select>
                        
                        <select class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterOrders('cluster', this.value)">
                            <option value="">Semua Cluster</option>
                            <option value="A">Cluster A</option>
                            <option value="B">Cluster B</option>
                            <option value="C">Cluster C</option>
                        </select>
                        
                        <input type="date" class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterOrders('date', this.value)">
                        
                        <input type="text" placeholder="Cari driver atau tujuan..." class="border border-gray-300 rounded-lg px-3 py-2" onkeyup="searchOrders(this.value)">
                    </div>
                </div>

                <!-- ORDER LIST -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <h3 class="text-xl font-bold text-gray-800">Daftar Pesanan</h3>
                    </div>
                    
                    <div class="divide-y divide-gray-100" id="orders-list">
                        <!-- ORDER ITEM 1 -->
                        <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD001')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-luyu-green/10 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="font-semibold text-gray-800">#ORD001</h4>
                                            <span class="status-ongoing px-2 py-1 rounded-full text-xs font-semibold">Dalam Perjalanan</span>
                                            <span class="bg-luyu-green text-white px-2 py-1 rounded-full text-xs font-bold">C</span>
                                        </div>
                                        <p class="text-sm text-gray-600">Jl. Sudirman → Masjid Al-Barokah</p>
                                        <p class="text-xs text-gray-500">Driver: Ustadzah Siti • Honda Beat</p>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <p class="font-bold text-gray-800">Rp 15.000</p>
                                    <p class="text-xs text-gray-500">30 Mei 2025, 14:30</p>
                                    <div class="mt-2">
                                        <div class="progress-bar w-32">
                                            <div class="progress-fill bg-orange-500" style="width: 75%"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">ETA: 8 menit</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ORDER ITEM 2 -->
                        <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD002')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-luyu-blue/10 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-luyu-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="font-semibold text-gray-800">#ORD002</h4>
                                            <span class="status-completed px-2 py-1 rounded-full text-xs font-semibold">Selesai</span>
                                            <span class="bg-luyu-red text-white px-2 py-1 rounded-full text-xs font-bold">C</span>
                                        </div>
                                        <p class="text-sm text-gray-600">Rumah → Pasar Tradisional</p>
                                        <p class="text-xs text-gray-500">Driver: Pak Ahmad • Yamaha Mio</p>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <p class="font-bold text-gray-800">Rp 12.500</p>
                                    <p class="text-xs text-gray-500">30 Mei 2025, 13:15</p>
                                    <div class="mt-2 flex items-center text-xs text-luyu-green">
                                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        Trip Completed
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ORDER ITEM 3 -->
                        <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD003')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-luyu-gold/10 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-luyu-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="font-semibold text-gray-800">#ORD003</h4>
                                            <span class="status-pending px-2 py-1 rounded-full text-xs font-semibold">Menunggu Driver</span>
                                            <span class="bg-luyu-blue text-white px-2 py-1 rounded-full text-xs font-bold">A</span>
                                        </div>
                                        <p class="text-sm text-gray-600">Plaza Indonesia → Kemang</p>
                                        <p class="text-xs text-gray-500">Mencari driver terdekat...</p>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <p class="font-bold text-gray-800">Rp 25.000</p>
                                    <p class="text-xs text-gray-500">30 Mei 2025, 15:45</p>
                                    <div class="mt-2">
                                        <div class="progress-bar w-32">
                                            <div class="progress-fill bg-luyu-gold" style="width: 20%"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Estimasi: 5 menit</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ORDER ITEM 4 -->
                        <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD004')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-luyu-purple/10 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-luyu-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="font-semibold text-gray-800">#ORD004</h4>
                                            <span class="status-pickup px-2 py-1 rounded-full text-xs font-semibold">Penjemputan</span>
                                            <span class="bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-bold">B</span>
                                        </div>
                                        <p class="text-sm text-gray-600">Bandung Station → Dago</p>
                                        <p class="text-xs text-gray-500">Driver: Bu Fatimah • Honda Scoopy</p>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <p class="font-bold text-gray-800">Rp 18.000</p>
                                    <p class="text-xs text-gray-500">30 Mei 2025, 15:20</p>
                                    <div class="mt-2">
                                        <div class="progress-bar w-32">
                                            <div class="progress-fill bg-luyu-purple" style="width: 45%"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Driver menuju lokasi</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ORDER ITEM 5 -->
                        <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="showOrderDetail('ORD005')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-luyu-red/10 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-luyu-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="font-semibold text-gray-800">#ORD005</h4>
                                            <span class="status-cancelled px-2 py-1 rounded-full text-xs font-semibold">Dibatalkan</span>
                                            <span class="bg-luyu-green text-white px-2 py-1 rounded-full text-xs font-bold">C</span>
                                        </div>
                                        <p class="text-sm text-gray-600">Tangerang Mall → BSD</p>
                                        <p class="text-xs text-gray-500">Dibatalkan oleh pelanggan</p>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <p class="font-bold text-gray-400 line-through">Rp 22.000</p>
                                    <p class="text-xs text-gray-500">30 Mei 2025, 12:00</p>
                                    <div class="mt-2 text-xs text-luyu-red">
                                        Refund: Rp 22.000
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="col-span-4 space-y-6">
                <!-- ORDER STATS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Statistik Pesanan</h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Total Hari Ini</span>
                            <span class="font-bold text-luyu-green">23</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Sedang Berlangsung</span>
                            <span class="font-bold text-orange-500">3</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Selesai Hari Ini</span>
                            <span class="font-bold text-luyu-blue">18</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Dibatalkan</span>
                            <span class="font-bold text-luyu-red">2</span>
                        </div>
                    </div>

                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <h4 class="font-semibold text-gray-800 mb-3">Success Rate</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 91%"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">91% pesanan berhasil diselesaikan</p>
                    </div>
                </div>

                <!-- ACTIVE ORDERS MAP -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Pesanan Aktif</h3>
                    
                    <div class="relative h-48 bg-gray-100 rounded-lg overflow-hidden mb-4">
                        <svg viewBox="0 0 300 200" class="absolute inset-0 w-full h-full">
                            <rect width="300" height="200" fill="#f8f9fa"/>
                            
                            <!-- Routes -->
                            <path d="M50 50 Q 150 100 250 150" stroke="#2ecc71" stroke-width="3" fill="none" stroke-dasharray="5,5" opacity="0.8"/>
                            <path d="M80 80 Q 180 120 220 160" stroke="#9b59b6" stroke-width="3" fill="none" stroke-dasharray="5,5" opacity="0.8"/>
                            
                            <!-- Driver positions -->
                            <circle cx="150" cy="100" r="6" fill="#2ecc71" stroke="white" stroke-width="2">
                                <animate attributeName="r" values="6;8;6" dur="2s" repeatCount="indefinite"/>
                            </circle>
                            <circle cx="180" cy="120" r="6" fill="#9b59b6" stroke="white" stroke-width="2">
                                <animate attributeName="r" values="6;8;6" dur="2s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- Destinations -->
                            <rect x="245" y="145" width="10" height="10" fill="#e74c3c" rx="2"/>
                            <rect x="215" y="155" width="10" height="10" fill="#e74c3c" rx="2"/>
                        </svg>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-luyu-green rounded-full mr-2"></div>
                                <span>ORD001 - Ustadzah Siti</span>
                            </div>
                            <span class="text-gray-500">8 min</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-luyu-purple rounded-full mr-2"></div>
                                <span>ORD004 - Bu Fatimah</span>
                            </div>
                            <span class="text-gray-500">3 min</span>
                        </div>
                    </div>
                </div>

                <!-- QUICK ACTIONS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
                    
                    <div class="space-y-3">
                        <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showOrderModal()">
                            Buat Pesanan Baru
                        </button>
                        <button class="w-full bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:bg-luyu-blue/90 transition-all" onclick="refreshOrders()">
                            Refresh Data
                        </button>
                        <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                            Export Laporan
                        </button>
                    </div>
                </div>

                <!-- DRIVER AVAILABILITY -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Ketersediaan Driver</h3>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-luyu-blue rounded-full mr-2"></div>
                                <span class="text-sm">Cluster A</span>
                            </div>
                            <div class="text-right">
                                <span class="font-bold text-luyu-blue">87</span>
                                <span class="text-xs text-gray-500 ml-1">online</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                                <span class="text-sm">Cluster B</span>
                            </div>
                            <div class="text-right">
                                <span class="font-bold text-orange-500">45</span>
                                <span class="text-xs text-gray-500 ml-1">online</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-luyu-green rounded-full mr-2"></div>
                                <span class="text-sm">Cluster C</span>
                            </div>
                            <div class="text-right">
                                <span class="font-bold text-luyu-green">134</span>
                                <span class="text-xs text-gray-500 ml-1">online</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Total Online</span>
                                <span class="font-bold text-luyu-green">266 driver</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="maps-template">
    <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-6 h-full">
            <!-- MAP AREA -->
            <div class="col-span-8">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 h-full overflow-hidden">
                    <div class="p-4 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold text-gray-800">Peta Cluster Real-time</h3>
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center text-sm">
                                    <div class="w-3 h-3 bg-luyu-green rounded-full mr-2"></div>
                                    <span>Online (1,247)</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                                    <span>Offline (423)</span>
                                </div>
                                <button class="bg-luyu-green text-white px-4 py-2 rounded-lg text-sm font-semibold" onclick="refreshMap()">
                                    Refresh
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative h-[600px] bg-gray-100" id="interactive-map">
                        <!-- INTERACTIVE MAP -->
                        <svg viewBox="0 0 1000 600" class="absolute inset-0 w-full h-full">
                            <!-- Background -->
                            <rect width="1000" height="600" fill="#f8f9fa"/>
                            
                            <!-- Cluster Areas -->
                            <g class="cluster-zone" data-cluster="a" onclick="selectCluster('a')">
                                <rect x="100" y="80" width="250" height="180" fill="#3498db20" stroke="#3498db" stroke-width="3" rx="15" />
                                <text x="225" y="175" text-anchor="middle" class="text-lg font-bold fill-blue-600">Jakarta</text>
                                <text x="225" y="195" text-anchor="middle" class="text-sm fill-blue-500">Cluster A</text>
                            </g>
                            
                            <g class="cluster-zone" data-cluster="b" onclick="selectCluster('b')">
                                <rect x="400" y="120" width="200" height="140" fill="#f39c1220" stroke="#f39c12" stroke-width="3" rx="15" />
                                <text x="500" y="185" text-anchor="middle" class="text-lg font-bold fill-orange-600">Bandung</text>
                                <text x="500" y="205" text-anchor="middle" class="text-sm fill-orange-500">Cluster B</text>
                            </g>
                            
                            <g class="cluster-zone" data-cluster="c" onclick="selectCluster('c')">
                                <rect x="650" y="150" width="280" height="220" fill="#2ecc7120" stroke="#2ecc71" stroke-width="3" rx="15" />
                                <text x="790" y="260" text-anchor="middle" class="text-lg font-bold fill-green-600">Banten</text>
                                <text x="790" y="280" text-anchor="middle" class="text-sm fill-green-500">Cluster C</text>
                            </g>
                            
                            <!-- Driver Markers -->
                            <g class="driver-markers">
                                <!-- Cluster A Drivers -->
                                <circle class="driver-marker" cx="180" cy="140" r="8" fill="#3498db" stroke="white" stroke-width="3" data-driver="driver1" onclick="showDriverDetail('driver1')" />
                                <circle class="driver-marker" cx="220" cy="160" r="8" fill="#3498db" stroke="white" stroke-width="3" data-driver="driver2" onclick="showDriverDetail('driver2')" />
                                <circle class="driver-marker" cx="280" cy="190" r="8" fill="#3498db" stroke="white" stroke-width="3" data-driver="driver3" onclick="showDriverDetail('driver3')" />
                                
                                <!-- Cluster B Drivers -->
                                <circle class="driver-marker" cx="450" cy="170" r="8" fill="#f39c12" stroke="white" stroke-width="3" data-driver="driver4" onclick="showDriverDetail('driver4')" />
                                <circle class="driver-marker" cx="520" cy="200" r="8" fill="#f39c12" stroke="white" stroke-width="3" data-driver="driver5" onclick="showDriverDetail('driver5')" />
                                
                                <!-- Cluster C Drivers -->
                                <circle class="driver-marker" cx="720" cy="200" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="siti" onclick="showDriverDetail('siti')" />
                                <circle class="driver-marker" cx="780" cy="240" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="ahmad" onclick="showDriverDetail('ahmad')" />
                                <circle class="driver-marker" cx="850" cy="280" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="driver8" onclick="showDriverDetail('driver8')" />
                                <circle class="driver-marker" cx="880" cy="320" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="driver9" onclick="showDriverDetail('driver9')" />
                                
                                <!-- Moving drivers animation -->
                                <circle class="driver-marker" cx="300" cy="300" r="8" fill="#2ecc71" stroke="white" stroke-width="3" data-driver="moving1">
                                    <animateTransform attributeName="transform" type="translate" values="0,0; 50,0; 50,-50; 0,-50; 0,0" dur="10s" repeatCount="indefinite"/>
                                </circle>
                            </g>
                            
                            <!-- Routes -->
                            <path d="M180 140 Q 400 200 720 200" stroke="#2ecc71" stroke-width="4" fill="none" stroke-dasharray="8,4" opacity="0.6"/>
                            <path d="M450 170 Q 600 180 780 240" stroke="#f39c12" stroke-width="4" fill="none" stroke-dasharray="8,4" opacity="0.6"/>
                        </svg>

                        <!-- MAP CONTROLS -->
                        <div class="absolute top-4 left-4 bg-white rounded-lg shadow-lg p-2 space-y-1">
                            <button class="block p-2 hover:bg-gray-100 rounded text-gray-600" onclick="zoomIn()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                            </button>
                            <button class="block p-2 hover:bg-gray-100 rounded text-gray-600" onclick="zoomOut()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                </svg>
                            </button>
                            <button class="block p-2 hover:bg-gray-100 rounded text-gray-600" onclick="centerMap()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                </svg>
                            </button>
                        </div>

                        <!-- CLUSTER INFO PANEL -->
                        <div id="cluster-info" class="absolute bottom-4 left-4 bg-white rounded-xl shadow-lg p-4 max-w-sm hidden">
                            <div id="cluster-info-content">
                                <!-- Dynamic cluster info -->
                            </div>
                        </div>

                        <!-- LIVE ACTIVITY -->
                        <div class="absolute bottom-4 right-4 bg-white rounded-xl shadow-lg p-4 max-w-sm">
                            <h4 class="font-semibold text-gray-800 mb-3">Aktivitas Real-time</h4>
                            <div class="space-y-2 text-sm" id="live-activity">
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-luyu-green rounded-full mr-2 animate-pulse"></div>
                                    <span>Ustadzah Siti - Menuju pickup</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-luyu-blue rounded-full mr-2 animate-pulse"></div>
                                    <span>Pak Ahmad - Dalam perjalanan</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-luyu-gold rounded-full mr-2 animate-pulse"></div>
                                    <span>3 pesanan baru diterima</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR INFO -->
            <div class="col-span-4 space-y-6">
                <!-- CLUSTER OVERVIEW -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Overview Cluster</h3>
                    
                    <div class="space-y-4">
                        <div class="cluster-stat p-4 bg-luyu-blue/5 border-l-4 border-luyu-blue rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-800">Cluster A</h4>
                                <span class="text-luyu-blue font-bold">70:30</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">Driver Online</span>
                                    <p class="font-bold text-luyu-blue">342</p>
                                </div>
                                <div>
                                    <span class="text-gray-600">Avg Income</span>
                                    <p class="font-bold">Rp 285K</p>
                                </div>
                            </div>
                        </div>

                        <div class="cluster-stat p-4 bg-orange-50 border-l-4 border-orange-500 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-800">Cluster B</h4>
                                <span class="text-orange-500 font-bold">80:20</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">Driver Online</span>
                                    <p class="font-bold text-orange-500">198</p>
                                </div>
                                <div>
                                    <span class="text-gray-600">Avg Income</span>
                                    <p class="font-bold">Rp 195K</p>
                                </div>
                            </div>
                        </div>

                        <div class="cluster-stat p-4 bg-luyu-green/5 border-l-4 border-luyu-green rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-800">Cluster C</h4>
                                <span class="text-luyu-green font-bold">90:10</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">Driver Online</span>
                                    <p class="font-bold text-luyu-green">707</p>
                                </div>
                                <div>
                                    <span class="text-gray-600">Avg Income</span>
                                    <p class="font-bold">Rp 125K</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FILTER & CONTROLS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Filter & Kontrol</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tampilkan Driver</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2" onchange="toggleDriverVisibility('online')">
                                    <span class="text-sm">Online (1,247)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" onchange="toggleDriverVisibility('offline')">
                                    <span class="text-sm">Offline (423)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2" onchange="toggleDriverVisibility('priority')">
                                    <span class="text-sm">Prioritas Syariah</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cluster Focus</label>
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2" onchange="focusCluster(this.value)">
                                <option value="">Semua Cluster</option>
                                <option value="a">Cluster A - Jakarta</option>
                                <option value="b">Cluster B - Bandung</option>
                                <option value="c">Cluster C - Banten</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Radius Pencarian</label>
                            <input type="range" min="1" max="50" value="10" class="w-full" onchange="updateSearchRadius(this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>1 km</span>
                                <span id="radius-value">10 km</span>
                                <span>50 km</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QUICK ACTIONS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
                    
                    <div class="space-y-3">
                        <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showOrderModal()">
                            Pesan Ojek Terdekat
                        </button>
                        <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all">
                            Berikan Infaq Langsung
                        </button>
                        <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                            Export Data Cluster
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="wallet-template">
    <div class="animate-fade-in">
        <div class="grid grid-cols-12 gap-8">
            <!-- MAIN WALLET -->
            <div class="col-span-8 space-y-6">
                <!-- BALANCE OVERVIEW -->
                <div class="bg-gradient-to-r from-luyu-green to-luyu-blue rounded-2xl p-8 text-white">
                    <h2 class="text-2xl font-bold mb-6">Dompet Syariah</h2>
                    <div class="grid grid-cols-2 gap-8">
                        <div class="bg-white/20 p-6 rounded-xl backdrop-blur-sm">
                            <h3 class="text-lg font-semibold mb-2">Saldo Utama</h3>
                            <p class="text-3xl font-bold mb-2" id="main-balance">Rp 185.000</p>
                            <p class="text-sm text-white/80">+Rp 25.000 hari ini</p>
                            <button class="mt-4 bg-white text-luyu-green px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all" onclick="showModal('topup-modal')">
                                Top Up
                            </button>
                        </div>
                        
                        <div class="bg-white/20 p-6 rounded-xl backdrop-blur-sm">
                            <h3 class="text-lg font-semibold mb-2">Saldo Infaq</h3>
                            <p class="text-3xl font-bold mb-2" id="infaq-balance">Rp 35.000</p>
                            <p class="text-sm text-white/80">Siap disalurkan</p>
                            <button class="mt-4 bg-luyu-gold text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all">
                                Salurkan
                            </button>
                        </div>
                    </div>
                </div>

                <!-- TRANSACTION HISTORY -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Riwayat Transaksi</h3>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-luyu-green text-white rounded-lg text-sm">Semua</button>
                            <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Masuk</button>
                            <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">Keluar</button>
                        </div>
                    </div>
                    
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Deskripsi</th>
                                    <th>Kategori</th>
                                    <th>Jumlah</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>30 Mei 2025</td>
                                    <td>Ojek ke Masjid Al-Barokah</td>
                                    <td><span class="bg-luyu-green/10 text-luyu-green px-2 py-1 rounded-full text-xs">Trip</span></td>
                                    <td class="font-semibold text-luyu-red">-Rp 12.500</td>
                                    <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                                </tr>
                                <tr>
                                    <td>30 Mei 2025</td>
                                    <td>Auto Zakat - Trip</td>
                                    <td><span class="bg-luyu-gold/10 text-luyu-gold px-2 py-1 rounded-full text-xs">Zakat</span></td>
                                    <td class="font-semibold text-luyu-red">-Rp 312</td>
                                    <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                                </tr>
                                <tr>
                                    <td>29 Mei 2025</td>
                                    <td>Infaq untuk Ustadzah Siti</td>
                                    <td><span class="bg-luyu-purple/10 text-luyu-purple px-2 py-1 rounded-full text-xs">Infaq</span></td>
                                    <td class="font-semibold text-luyu-red">-Rp 25.000</td>
                                    <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                                </tr>
                                <tr>
                                    <td>29 Mei 2025</td>
                                    <td>Top Up Saldo</td>
                                    <td><span class="bg-luyu-blue/10 text-luyu-blue px-2 py-1 rounded-full text-xs">Top Up</span></td>
                                    <td class="font-semibold text-luyu-green">+Rp 100.000</td>
                                    <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                                </tr>
                                <tr>
                                    <td>28 Mei 2025</td>
                                    <td>Wakaf Quran Digital</td>
                                    <td><span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-xs">Wakaf</span></td>
                                    <td class="font-semibold text-luyu-red">-Rp 50.000</td>
                                    <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Selesai</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="col-span-4 space-y-6">
                <!-- AUTO SETTINGS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Pengaturan Otomatis</h3>
                    
                    <div class="space-y-4">
                        <div class="p-4 bg-luyu-gold/10 border border-luyu-gold/20 rounded-lg">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">Auto-Zakat</h4>
                                    <p class="text-sm text-gray-600">2.5% dari setiap transaksi</p>
                                </div>
                                <label class="switch switch-gold">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-luyu-purple/10 border border-luyu-purple/20 rounded-lg">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">Auto-Infaq</h4>
                                    <p class="text-sm text-gray-600">Rp 1.000 per trip Cluster C</p>
                                </div>
                                <label class="switch switch-purple">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-luyu-blue/10 border border-luyu-blue/20 rounded-lg">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">Notifikasi Saldo</h4>
                                    <p class="text-sm text-gray-600">Alert jika saldo < Rp 50.000</p>
                                </div>
                                <label class="switch switch-blue">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MONTHLY SUMMARY -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Ringkasan Bulan Ini</h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Total Pengeluaran</span>
                            <span class="font-bold text-luyu-red">Rp 425.000</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Total Top Up</span>
                            <span class="font-bold text-luyu-green">Rp 500.000</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Zakat Dibayar</span>
                            <span class="font-bold text-luyu-gold">Rp 12.500</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Infaq Disalurkan</span>
                            <span class="font-bold text-luyu-purple">Rp 75.000</span>
                        </div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center">
                                <span class="font-semibold text-gray-800">Pahala Earned</span>
                                <span class="font-bold text-luyu-blue">+185 Points</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QUICK ACTIONS -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Aksi Cepat</h3>
                    
                    <div class="space-y-3">
                        <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showModal('topup-modal')">
                            Top Up Saldo
                        </button>
                        <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:bg-luyu-gold/90 transition-all">
                            Bayar Zakat Manual
                        </button>
                        <button class="w-full bg-luyu-purple text-white py-3 rounded-lg font-semibold hover:bg-luyu-purple/90 transition-all">
                            Salurkan Infaq
                        </button>
                        <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all">
                            Unduh Laporan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    // Global state management
    let currentPage = 'dashboard';
    let userData = {
        balance: 185000,
        infaqBalance: 35000,
        pahalaPoints: 230,
        totalTrips: 127
    };

    // Driver data
    const driverData = {
        siti: {
            name: 'Ustadzah Siti',
            cluster: 'C',
            vehicle: 'Honda Beat',
            rating: 4.9,
            distance: '1.2 km',
            status: 'online',
            priority: true,
            earnings: 'Rp 125.000/hari',
            trips: 47,
            phone: '+62 812-3456-7890',
            joinDate: '15 Januari 2024'
        },
        ahmad: {
            name: 'Pak Ahmad',
            cluster: 'C',
            vehicle: 'Yamaha Mio',
            rating: 4.8,
            distance: '1.8 km',
            status: 'online',
            priority: true,
            earnings: 'Rp 118.000/hari',
            trips: 52,
            phone: '+62 813-2345-6789',
            joinDate: '3 Februari 2024'
        },
        budi: {
            name: 'Budi',
            cluster: 'A',
            vehicle: 'Honda Vario',
            rating: 4.7,
            distance: '2.1 km',
            status: 'online',
            priority: false,
            earnings: 'Rp 285.000/hari',
            trips: 128,
            phone: '+62 814-3456-7890',
            joinDate: '10 Desember 2023'
        },
        driver1: { name: 'Driver 1', cluster: 'A', vehicle: 'Honda', rating: 4.5, distance: '3.2 km', status: 'online', priority: false, trips: 34 },
        driver2: { name: 'Driver 2', cluster: 'A', vehicle: 'Yamaha', rating: 4.6, distance: '2.8 km', status: 'online', priority: false, trips: 28 },
        driver3: { name: 'Driver 3', cluster: 'A', vehicle: 'Suzuki', rating: 4.4, distance: '4.1 km', status: 'online', priority: false, trips: 41 },
        driver4: { name: 'Driver 4', cluster: 'B', vehicle: 'Honda', rating: 4.7, distance: '1.9 km', status: 'online', priority: false, trips: 67 },
        driver5: { name: 'Driver 5', cluster: 'B', vehicle: 'Yamaha', rating: 4.8, distance: '2.3 km', status: 'online', priority: false, trips: 53 },
        driver8: { name: 'Driver 8', cluster: 'C', vehicle: 'Honda', rating: 4.9, distance: '1.5 km', status: 'online', priority: true, trips: 72 },
        driver9: { name: 'Driver 9', cluster: 'C', vehicle: 'Yamaha', rating: 4.8, distance: '2.0 km', status: 'online', priority: true, trips: 48 },
        moving1: { name: 'Moving Driver', cluster: 'C', vehicle: 'Honda', rating: 4.7, distance: '1.8 km', status: 'busy', priority: true, trips: 35 }
    };

    // Orders data
    const ordersData = {
        'ORD001': {
            id: 'ORD001',
            status: 'ongoing',
            from: 'Jl. Sudirman',
            to: 'Masjid Al-Barokah',
            driver: 'Ustadzah Siti',
            vehicle: 'Honda Beat',
            cluster: 'C',
            price: 15000,
            time: '30 Mei 2025, 14:30',
            progress: 75,
            eta: '8 menit'
        },
        'ORD002': {
            id: 'ORD002',
            status: 'completed',
            from: 'Rumah',
            to: 'Pasar Tradisional',
            driver: 'Pak Ahmad',
            vehicle: 'Yamaha Mio',
            cluster: 'C',
            price: 12500,
            time: '30 Mei 2025, 13:15',
            progress: 100,
            eta: 'Selesai'
        },
        'ORD003': {
            id: 'ORD003',
            status: 'pending',
            from: 'Plaza Indonesia',
            to: 'Kemang',
            driver: null,
            vehicle: null,
            cluster: 'A',
            price: 25000,
            time: '30 Mei 2025, 15:45',
            progress: 20,
            eta: '5 menit'
        },
        'ORD004': {
            id: 'ORD004',
            status: 'pickup',
            from: 'Bandung Station',
            to: 'Dago',
            driver: 'Bu Fatimah',
            vehicle: 'Honda Scoopy',
            cluster: 'B',
            price: 18000,
            time: '30 Mei 2025, 15:20',
            progress: 45,
            eta: 'Driver menuju lokasi'
        },
        'ORD005': {
            id: 'ORD005',
            status: 'cancelled',
            from: 'Tangerang Mall',
            to: 'BSD',
            driver: null,
            vehicle: null,
            cluster: 'C',
            price: 22000,
            time: '30 Mei 2025, 12:00',
            progress: 0,
            eta: 'Dibatalkan'
        }
    };

    // Charts instances
    let revenueChart = null;
    let clusterCharts = {};
    let impactChart = null;

    // Page management
    function showPage(pageId) {
        try {
            currentPage = pageId;
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('bg-luyu-green/10', 'text-luyu-green');
                item.classList.add('text-gray-700');
            });
            
            const activeItem = document.querySelector(`[data-page="${pageId}"]`);
            if (activeItem) {
                activeItem.classList.remove('text-gray-700');
                activeItem.classList.add('bg-luyu-green/10', 'text-luyu-green');
            }

            updatePageHeader(pageId);
            loadPageContent(pageId);
        } catch (error) {
            console.error('Error in showPage:', error);
            showNotification('Terjadi kesalahan saat memuat halaman', 'error');
        }
    }

    function updatePageHeader(pageId) {
        try {
            const titles = {
                dashboard: { title: "Assalamu'alaikum, Ahmad!", subtitle: "Semoga hari ini penuh berkah dan kebaikan" },
                maps: { title: "Peta Cluster", subtitle: "Monitoring driver dan wilayah real-time" },
                orders: { title: "Kelola Pesanan", subtitle: "Pantau dan kelola semua pesanan Anda" },
                wallet: { title: "Dompet Syariah", subtitle: "Kelola keuangan dengan prinsip syariah" },
                analytics: { title: "Analitik & Laporan", subtitle: "Insight mendalam untuk bisnis yang lebih baik" },
                zakat: { title: "Zakat & Infaq", subtitle: "Berbagi rezeki dengan sesama" },
                wakaf: { title: "Wakaf Digital", subtitle: "Investasi akhirat yang berkelanjutan" },
                kajian: { title: "Kajian Online", subtitle: "Menambah ilmu agama bersama para ustadz" },
                settings: { title: "Pengaturan", subtitle: "Personalisasi aplikasi sesuai kebutuhan" }
            };

            const pageInfo = titles[pageId] || { title: "LUYU Platform", subtitle: "Ojol Syariah Terpercaya" };
            
            const titleElement = document.getElementById('page-title');
            const subtitleElement = document.getElementById('page-subtitle');
            
            if (titleElement) titleElement.textContent = pageInfo.title;
            if (subtitleElement) subtitleElement.textContent = pageInfo.subtitle;
        } catch (error) {
            console.error('Error in updatePageHeader:', error);
        }
    }

    function loadPageContent(pageId) {
        try {
            const contentArea = document.getElementById('main-content');
            const template = document.getElementById(`${pageId}-template`);
            
            if (template && contentArea) {
                contentArea.innerHTML = template.innerHTML;
                
                // Initialize page-specific functionality
                switch(pageId) {
                    case 'analytics':
                        setTimeout(() => initializeAnalytics(), 100);
                        break;
                    case 'wallet':
                        setTimeout(() => initializeWalletEvents(), 100);
                        break;
                    case 'maps':
                        setTimeout(() => initializeMapEvents(), 100);
                        break;
                    case 'orders':
                        setTimeout(() => initializeOrdersEvents(), 100);
                        break;
                    default:
                        break;
                }
            } else {
                if (contentArea) {
                    contentArea.innerHTML = generateFallbackContent(pageId);
                }
            }
        } catch (error) {
            console.error('Error in loadPageContent:', error);
            showNotification('Gagal memuat konten halaman', 'error');
        }
    }

    function generateFallbackContent(pageId) {
        return `
            <div class="animate-fade-in">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 text-center">
                    <div class="w-20 h-20 bg-luyu-green/10 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Halaman ${pageId.charAt(0).toUpperCase() + pageId.slice(1)}</h2>
                    <p class="text-gray-600 mb-6">Fitur ini sedang dalam pengembangan dan akan segera tersedia.</p>
                    <button class="bg-luyu-green text-white px-6 py-3 rounded-lg font-semibold hover:bg-luyu-green/90 transition-all" onclick="showPage('dashboard')">
                        Kembali ke Dashboard
                    </button>
                </div>
            </div>
        `;
    }

    // Analytics functionality
    function initializeAnalytics() {
        try {
            initializeCharts();
            startAnalyticsUpdates();
        } catch (error) {
            console.error('Error in initializeAnalytics:', error);
        }
    }

    function initializeCharts() {
        try {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenue-chart');
            if (revenueCtx && typeof Chart !== 'undefined') {
                if (revenueChart) {
                    revenueChart.destroy();
                }
                
                revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'],
                        datasets: [{
                            label: 'Revenue (Juta)',
                            data: [1.2, 1.9, 3.0, 5.0, 2.0, 3.0, 4.5],
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Zakat (Juta)',
                            data: [0.03, 0.048, 0.075, 0.125, 0.05, 0.075, 0.113],
                            borderColor: '#f1c40f',
                            backgroundColor: 'rgba(241, 196, 15, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': Rp ' + context.parsed.y + 'M';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Hari'
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Jumlah (Juta Rupiah)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return 'Rp ' + value + 'M';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Cluster Performance Charts
            const clusters = ['a', 'b', 'c'];
            const clusterData = [85, 72, 95];
            const clusterColors = ['#3498db', '#f39c12', '#2ecc71'];
            const clusterLabels = ['Jakarta', 'Bandung', 'Banten'];
            
            clusters.forEach((cluster, index) => {
                const ctx = document.getElementById(`cluster-${cluster}-chart`);
                if (ctx && typeof Chart !== 'undefined') {
                    if (clusterCharts[cluster]) {
                        clusterCharts[cluster].destroy();
                    }
                    
                    clusterCharts[cluster] = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            datasets: [{
                                data: [clusterData[index], 100 - clusterData[index]],
                                backgroundColor: [clusterColors[index], '#f3f4f6'],
                                borderWidth: 0,
                                cutout: '70%'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            if (context.dataIndex === 0) {
                                                return `${clusterLabels[index]}: ${clusterData[index]}%`;
                                            }
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [{
                            beforeDraw: function(chart) {
                                const ctx = chart.ctx;
                                ctx.save();
                                const fontSize = Math.max(chart.height / 8, 12);
                                ctx.font = fontSize + "px sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = clusterColors[index];
                                
                                const text = clusterData[index] + "%";
                                const textX = Math.round((chart.width - ctx.measureText(text).width) / 2);
                                const textY = chart.height / 2;
                                
                                ctx.fillText(text, textX, textY);
                                ctx.restore();
                            }
                        }]
                    });
                }
            });

            // Impact Chart
            const impactCtx = document.getElementById('impact-chart');
            if (impactCtx && typeof Chart !== 'undefined') {
                if (impactChart) {
                    impactChart.destroy();
                }
                
                impactChart = new Chart(impactCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Driver Terbantu', 'Zakat Disalurkan', 'Wakaf Terkumpul', 'Mustahiq Dibantu'],
                        datasets: [{
                            label: 'Impact Metrics',
                            data: [1247, 4800000, 1200000, 2847],
                            backgroundColor: ['#2ecc71', '#f1c40f', '#9b59b6', '#3498db'],
                            borderColor: ['#27ae60', '#f39c12', '#8e44ad', '#2980b9'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label;
                                        const value = context.parsed.y;
                                        
                                        if (label.includes('Zakat') || label.includes('Wakaf')) {
                                            return label + ': Rp ' + (value / 1000000).toFixed(1) + 'M';
                                        }
                                        return label + ': ' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        if (value >= 1000000) {
                                            return 'Rp ' + (value / 1000000) + 'M';
                                        } else if (value >= 1000) {
                                            return (value / 1000) + 'K';
                                        }
                                        return value;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        } catch (error) {
            console.error('Error in initializeCharts:', error);
        }
    }

    function startAnalyticsUpdates() {
        try {
            // Update real-time stats every 5 seconds
            setInterval(() => {
                updateAnalyticsStats();
            }, 5000);
        } catch (error) {
            console.error('Error in startAnalyticsUpdates:', error);
        }
    }

    function updateAnalyticsStats() {
        try {
            const ordersToday = document.getElementById('orders-today');
            const activeDrivers = document.getElementById('active-drivers');
            
            if (ordersToday) {
                const currentOrders = parseInt(ordersToday.textContent.replace(/[^\d]/g, ''));
                const newOrders = currentOrders + Math.floor(Math.random() * 3);
                ordersToday.textContent = newOrders.toLocaleString();
            }
            
            if (activeDrivers) {
                const currentDrivers = parseInt(activeDrivers.textContent.replace(/[^\d]/g, ''));
                const variation = Math.floor(Math.random() * 10) - 5;
                const newDrivers = Math.max(1200, currentDrivers + variation);
                activeDrivers.textContent = newDrivers.toLocaleString();
            }
        } catch (error) {
            console.error('Error in updateAnalyticsStats:', error);
        }
    }

    // Orders functionality
    function initializeOrdersEvents() {
        try {
            updateOrdersList();
            startOrdersUpdates();
        } catch (error) {
            console.error('Error in initializeOrdersEvents:', error);
        }
    }

    function updateOrdersList() {
        try {
            const ordersList = document.getElementById('orders-list');
            if (!ordersList) return;

            // Orders list is already populated in template
            // This function can be used to refresh the list dynamically
        } catch (error) {
            console.error('Error in updateOrdersList:', error);
        }
    }

    function showOrderDetail(orderId) {
        try {
            const order = ordersData[orderId];
            if (!order) {
                showNotification('Data pesanan tidak ditemukan', 'error');
                return;
            }

            const modal = document.getElementById('order-detail-modal');
            const content = document.getElementById('order-detail-content');
            
            if (!modal || !content) {
                console.error('Order detail modal elements not found');
                return;
            }

            const statusColors = {
                pending: 'luyu-gold',
                confirmed: 'luyu-blue',
                pickup: 'luyu-purple',
                ongoing: 'orange-500',
                completed: 'luyu-green',
                cancelled: 'luyu-red'
            };

            const statusTexts = {
                pending: 'Menunggu Driver',
                confirmed: 'Dikonfirmasi',
                pickup: 'Penjemputan',
                ongoing: 'Dalam Perjalanan',
                completed: 'Selesai',
                cancelled: 'Dibatalkan'
            };

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Order Header -->
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${order.id}</h3>
                            <span class="status-${order.status} px-3 py-1 rounded-full text-sm font-semibold">${statusTexts[order.status]}</span>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-gray-800">Rp ${order.price.toLocaleString()}</p>
                            <p class="text-sm text-gray-500">${order.time}</p>
                        </div>
                    </div>

                    <!-- Route Details -->
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-luyu-green rounded-full mr-4"></div>
                            <div>
                                <p class="font-semibold text-gray-800">Lokasi Penjemputan</p>
                                <p class="text-gray-600">${order.from}</p>
                            </div>
                        </div>
                        <div class="border-l-2 border-gray-300 ml-2 h-8"></div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-luyu-red rounded-full mr-4"></div>
                            <div>
                                <p class="font-semibold text-gray-800">Tujuan</p>
                                <p class="text-gray-600">${order.to}</p>
                            </div>
                        </div>
                    </div>

                    ${order.driver ? `
                    <!-- Driver Info -->
                    <div class="p-4 bg-luyu-green/10 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-3">Informasi Driver</h4>
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-luyu-green/20 rounded-full flex items-center justify-center mr-4">
                                <svg class="w-6 h-6 text-luyu-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${order.driver}</p>
                                <p class="text-sm text-gray-600">${order.vehicle} • Cluster ${order.cluster}</p>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Progress -->
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Progress Pesanan</h4>
                        <div class="progress-bar">
                            <div class="progress-fill bg-${statusColors[order.status]}" style="width: ${order.progress}%"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">${order.eta}</p>
                    </div>

                    <!-- Actions -->
                    <div class="flex space-x-3">
                        ${order.status === 'ongoing' || order.status === 'pickup' ? `
                        <button class="flex-1 bg-luyu-blue text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="trackOrder('${order.id}')">
                            Lacak Pesanan
                        </button>
                        ` : ''}
                        ${order.status === 'pending' ? `
                        <button class="flex-1 bg-luyu-red text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="cancelOrder('${order.id}')">
                            Batalkan Pesanan
                        </button>
                        ` : ''}
                        ${order.status === 'completed' ? `
                        <button class="flex-1 bg-luyu-green text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="rateOrder('${order.id}')">
                            Beri Rating
                        </button>
                        ` : ''}
                        <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="closeModal('order-detail-modal')">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            showModal('order-detail-modal');
        } catch (error) {
            console.error('Error in showOrderDetail:', error);
            showNotification('Gagal memuat detail pesanan', 'error');
        }
    }

    function filterOrders(type, value) {
        try {
            console.log(`Filtering orders by ${type}: ${value}`);
            // Implement filter logic here
            showNotification(`Filter ${type}: ${value}`, 'info');
        } catch (error) {
            console.error('Error in filterOrders:', error);
        }
    }

    function searchOrders(query) {
        try {
            if (query.length > 2) {
                console.log('Searching orders:', query);
                showNotification(`Mencari pesanan: "${query}"`, 'info');
            }
        } catch (error) {
            console.error('Error in searchOrders:', error);
        }
    }

    function refreshOrders() {
        try {
            showLoading();
            setTimeout(() => {
                hideLoading();
                updateOrdersList();
                showNotification('Data pesanan berhasil diperbarui', 'success');
            }, 1500);
        } catch (error) {
            console.error('Error in refreshOrders:', error);
            hideLoading();
            showNotification('Gagal memperbarui data pesanan', 'error');
        }
    }

    function trackOrder(orderId) {
        try {
            closeModal('order-detail-modal');
            showPage('maps');
            showNotification(`Melacak pesanan ${orderId}`, 'info');
        } catch (error) {
            console.error('Error in trackOrder:', error);
        }
    }

    function cancelOrder(orderId) {
        try {
            if (confirm('Apakah Anda yakin ingin membatalkan pesanan ini?')) {
                ordersData[orderId].status = 'cancelled';
                ordersData[orderId].progress = 0;
                ordersData[orderId].eta = 'Dibatalkan';
                
                closeModal('order-detail-modal');
                showNotification(`Pesanan ${orderId} berhasil dibatalkan`, 'success');
                
                if (currentPage === 'orders') {
                    updateOrdersList();
                }
            }
        } catch (error) {
            console.error('Error in cancelOrder:', error);
            showNotification('Gagal membatalkan pesanan', 'error');
        }
    }

    function rateOrder(orderId) {
        try {
            closeModal('order-detail-modal');
            showNotification('Fitur rating akan segera tersedia', 'info');
        } catch (error) {
            console.error('Error in rateOrder:', error);
        }
    }

    function startOrdersUpdates() {
        try {
            // Update orders status every 10 seconds
            setInterval(() => {
                updateOrdersProgress();
            }, 10000);
        } catch (error) {
            console.error('Error in startOrdersUpdates:', error);
        }
    }

    function updateOrdersProgress() {
        try {
            // Simulate order progress updates
            Object.keys(ordersData).forEach(orderId => {
                const order = ordersData[orderId];
                if (order.status === 'ongoing' || order.status === 'pickup') {
                    const progressIncrease = Math.random() * 10;
                    order.progress = Math.min(100, order.progress + progressIncrease);
                    
                    if (order.progress >= 100 && order.status === 'ongoing') {
                        order.status = 'completed';
                        order.eta = 'Selesai';
                        showNotification(`Pesanan ${orderId} telah selesai`, 'success');
                    }
                }
            });
        } catch (error) {
            console.error('Error in updateOrdersProgress:', error);
        }
    }

    // Driver detail functionality
    function showDriverDetail(driverId) {
        try {
            const driver = driverData[driverId];
            if (!driver) {
                showNotification('Data driver tidak ditemukan', 'error');
                return;
            }

            const panel = document.getElementById('driver-panel');
            const content = document.getElementById('driver-detail-content');
            
            if (!panel || !content) {
                console.error('Driver panel elements not found');
                return;
            }
            
            const clusterColors = {
                'A': 'luyu-blue',
                'B': 'orange-500', 
                'C': 'luyu-green'
            };
            
            const clusterColor = clusterColors[driver.cluster] || 'luyu-gray';
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Driver Header -->
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <svg class="w-10 h-10 text-${clusterColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">${driver.name}</h3>
                        <div class="flex items-center justify-center mt-2 space-x-2">
                            <span class="bg-${clusterColor} text-white px-2 py-1 rounded-full text-xs font-bold">Cluster ${driver.cluster}</span>
                            ${driver.priority ? '<span class="bg-luyu-gold text-white px-2 py-1 rounded-full text-xs font-bold">Prioritas</span>' : ''}
                        </div>
                    </div>

                    <!-- Driver Stats -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-3 rounded-lg text-center">
                            <p class="text-2xl font-bold" style="color: #${clusterColor === 'luyu-blue' ? '3498db' : clusterColor === 'luyu-green' ? '2ecc71' : 'f39c12'}">${driver.rating || 'N/A'}</p>
                            <p class="text-xs text-gray-600">Rating</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg text-center">
                            <p class="text-2xl font-bold text-gray-800">${driver.trips || 'N/A'}</p>
                            <p class="text-xs text-gray-600">Total Trip</p>
                        </div>
                    </div>

                    <!-- Driver Info -->
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Kendaraan</span>
                            <span class="font-semibold">${driver.vehicle || 'N/A'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Jarak</span>
                            <span class="font-semibold" style="color: #${clusterColor === 'luyu-blue' ? '3498db' : clusterColor === 'luyu-green' ? '2ecc71' : 'f39c12'}">${driver.distance || 'N/A'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Pendapatan Harian</span>
                            <span class="font-semibold">${driver.earnings || 'N/A'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Status</span>
                            <span class="bg-luyu-green text-white px-2 py-1 rounded-full text-xs font-semibold">
                                ${driver.status === 'online' ? 'Online' : driver.status === 'busy' ? 'Sibuk' : 'Offline'}
                            </span>
                        </div>
                        ${driver.phone ? `
                        <div class="flex justify-between">
                            <span class="text-gray-600">Telepon</span>
                            <span class="font-semibold">${driver.phone}</span>
                        </div>
                        ` : ''}
                        ${driver.joinDate ? `
                        <div class="flex justify-between">
                            <span class="text-gray-600">Bergabung</span>
                            <span class="font-semibold">${driver.joinDate}</span>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Bagi Hasil Info -->
                    <div class="bg-gray-50 border-l-4 border-${clusterColor} rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Informasi Bagi Hasil</h4>
                        <div class="text-sm text-gray-600">
                            ${driver.cluster === 'C' ? 
                                '<p>Driver mendapat <span class="font-bold text-luyu-green">90%</span> dari total tarif</p><p class="mt-1">Platform hanya mengambil 10% untuk operasional</p>' : 
                                driver.cluster === 'B' ? 
                                '<p>Driver mendapat <span class="font-bold text-orange-500">80%</span> dari total tarif</p><p class="mt-1">Platform mengambil 20% untuk operasional</p>' :
                                '<p>Driver mendapat <span class="font-bold text-luyu-blue">70%</span> dari total tarif</p><p class="mt-1">Platform mengambil 30% untuk operasional</p>'
                            }
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="space-y-3">
                        <button class="w-full bg-luyu-green text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="bookDriver('${driverId}')">
                            Pesan ${driver.name}
                        </button>
                        <button class="w-full bg-luyu-gold text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all" onclick="sendInfaq('${driverId}')">
                            Kirim Infaq Langsung
                        </button>
                        ${driver.phone ? `
                        <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="callDriver('${driver.phone}')">
                            Hubungi Driver
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            panel.classList.add('active');
        } catch (error) {
            console.error('Error in showDriverDetail:', error);
            showNotification('Gagal memuat detail driver', 'error');
        }
    }

    function closeDriverPanel() {
        try {
            const panel = document.getElementById('driver-panel');
            if (panel) {
                panel.classList.remove('active');
            }
        } catch (error) {
            console.error('Error in closeDriverPanel:', error);
        }
    }

    // Driver actions
    function bookDriver(driverId) {
        try {
            const driver = driverData[driverId];
            if (driver) {
                closeDriverPanel();
                showOrderModal();
                showNotification(`Driver ${driver.name} dipilih untuk pesanan Anda`, 'success');
            }
        } catch (error) {
            console.error('Error in bookDriver:', error);
            showNotification('Gagal memesan driver', 'error');
        }
    }

    function sendInfaq(driverId) {
        try {
            const driver = driverData[driverId];
            if (driver) {
                closeDriverPanel();
                showNotification(`Infaq Rp 5.000 berhasil dikirim ke ${driver.name}`, 'success');
                userData.infaqBalance += 5000;
            }
        } catch (error) {
            console.error('Error in sendInfaq:', error);
            showNotification('Gagal mengirim infaq', 'error');
        }
    }

    function callDriver(phone) {
        try {
            showNotification(`Menghubungkan ke ${phone}...`, 'info');
            setTimeout(() => {
                showNotification('Panggilan dimulai', 'success');
            }, 2000);
        } catch (error) {
            console.error('Error in callDriver:', error);
            showNotification('Gagal menghubungi driver', 'error');
        }
    }

    // Map functionality
    function initializeMapEvents() {
        try {
            document.querySelectorAll('.driver-marker').forEach(marker => {
                marker.addEventListener('mouseenter', function(e) {
                    showTooltip(e, this.getAttribute('data-driver'));
                });
                
                marker.addEventListener('mouseleave', function() {
                    hideTooltip();
                });
            });

            startLiveActivityUpdates();
        } catch (error) {
            console.error('Error in initializeMapEvents:', error);
        }
    }

    function showTooltip(event, driverId) {
        try {
            const driver = driverData[driverId];
            if (!driver) return;
            
            const tooltip = document.getElementById('tooltip');
            if (tooltip) {
                tooltip.innerHTML = `<strong>${driver.name}</strong><br>${driver.vehicle} • ⭐ ${driver.rating}`;
                tooltip.style.left = event.pageX + 10 + 'px';
                tooltip.style.top = event.pageY - 30 + 'px';
                tooltip.classList.add('show');
            }
        } catch (error) {
            console.error('Error in showTooltip:', error);
        }
    }

    function hideTooltip() {
        try {
            const tooltip = document.getElementById('tooltip');
            if (tooltip) {
                tooltip.classList.remove('show');
            }
        } catch (error) {
            console.error('Error in hideTooltip:', error);
        }
    }

    function selectCluster(cluster) {
        try {
            const clusterNames = { a: 'Jakarta', b: 'Bandung', c: 'Banten' };
            const clusterColors = { a: '#3498db', b: '#f39c12', c: '#2ecc71' };
            const clusterRatios = { a: '70:30', b: '80:20', c: '90:10' };
            
            const info = document.getElementById('cluster-info');
            const content = document.getElementById('cluster-info-content');
            
            if (info && content) {
                content.innerHTML = `
                    <h4 class="font-bold text-gray-800 mb-3">Cluster ${cluster.toUpperCase()} - ${clusterNames[cluster]}</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Bagi Hasil:</span>
                            <span class="font-bold" style="color: ${clusterColors[cluster]}">${clusterRatios[cluster]}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Driver Online:</span>
                            <span class="font-bold">${cluster === 'a' ? '342' : cluster === 'b' ? '198' : '707'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Rata-rata Pendapatan:</span>
                            <span class="font-bold">${cluster === 'a' ? 'Rp 285K' : cluster === 'b' ? 'Rp 195K' : 'Rp 125K'}</span>
                        </div>
                    </div>
                    <button class="mt-3 w-full text-white py-2 rounded-lg text-sm font-semibold" style="background-color: ${clusterColors[cluster]}" onclick="focusCluster('${cluster}')">
                        Focus ke Cluster ${cluster.toUpperCase()}
                    </button>
                `;
                
                info.classList.remove('hidden');
                
                setTimeout(() => {
                    info.classList.add('hidden');
                }, 5000);
            }
        } catch (error) {
            console.error('Error in selectCluster:', error);
        }
    }

    function focusCluster(cluster) {
        try {
            if (cluster === '') {
                showNotification('Menampilkan semua cluster', 'info');
                return;
            }
            
            const clusterNames = { a: 'Jakarta', b: 'Bandung', c: 'Banten' };
            showNotification(`Focus ke Cluster ${cluster.toUpperCase()} - ${clusterNames[cluster]}`, 'info');
            
            console.log(`Focusing on cluster ${cluster}`);
        } catch (error) {
            console.error('Error in focusCluster:', error);
        }
    }

    function toggleDriverVisibility(type) {
        try {
            console.log(`Toggling ${type} drivers visibility`);
            showNotification(`${type === 'online' ? 'Driver Online' : type === 'offline' ? 'Driver Offline' : 'Driver Prioritas Syariah'} visibility toggled`, 'info');
        } catch (error) {
            console.error('Error in toggleDriverVisibility:', error);
        }
    }

    function updateSearchRadius(value) {
        try {
            const radiusElement = document.getElementById('radius-value');
            if (radiusElement) {
                radiusElement.textContent = `${value} km`;
            }
            console.log(`Search radius updated to ${value} km`);
        } catch (error) {
            console.error('Error in updateSearchRadius:', error);
        }
    }

    function refreshMap() {
        try {
            showLoading();
            setTimeout(() => {
                hideLoading();
                showNotification('Peta berhasil diperbarui', 'success');
                updateLiveActivity();
            }, 1500);
        } catch (error) {
            console.error('Error in refreshMap:', error);
            hideLoading();
            showNotification('Gagal memperbarui peta', 'error');
        }
    }

    function zoomIn() {
        console.log('Zooming in...');
        showNotification('Zoom in', 'info');
    }

    function zoomOut() {
        console.log('Zooming out...');
        showNotification('Zoom out', 'info');
    }

    function centerMap() {
        console.log('Centering map...');
        showNotification('Peta dikembalikan ke pusat', 'info');
    }

    function startLiveActivityUpdates() {
        try {
            const activities = [
                { driver: 'Ustadzah Siti', action: 'Menuju pickup', color: 'luyu-green' },
                { driver: 'Pak Ahmad', action: 'Dalam perjalanan', color: 'luyu-blue' },
                { driver: 'Bu Fatimah', action: 'Selesai trip', color: 'luyu-gold' },
                { driver: 'Ustadz Hasan', action: 'Menunggu pesanan', color: 'luyu-purple' },
                { driver: 'Pak Budi', action: 'Pickup passenger', color: 'luyu-red' }
            ];

            let currentIndex = 0;
            
            setInterval(() => {
                updateLiveActivity(activities[currentIndex]);
                currentIndex = (currentIndex + 1) % activities.length;
            }, 3000);
        } catch (error) {
            console.error('Error in startLiveActivityUpdates:', error);
        }
    }

    function updateLiveActivity(activity = null) {
        try {
            const container = document.getElementById('live-activity');
            if (!container) return;

            if (activity) {
                const newActivity = document.createElement('div');
                newActivity.className = 'flex items-center notification-enter';
                newActivity.innerHTML = `
                    <div class="w-2 h-2 bg-${activity.color} rounded-full mr-2 animate-pulse"></div>
                    <span>${activity.driver} - ${activity.action}</span>
                `;
                
                container.insertBefore(newActivity, container.firstChild);
                
                if (container.children.length > 3) {
                    container.removeChild(container.lastChild);
                }
            }
        } catch (error) {
            console.error('Error in updateLiveActivity:', error);
        }
    }

    // Wallet events
    function initializeWalletEvents() {
        try {
            const topupInput = document.getElementById('topup-amount');
            if (topupInput) {
                topupInput.addEventListener('input', function() {
                    const amount = parseInt(this.value) || 0;
                    updateZakatAmount(amount);
                });
            }

            initializeSwitchEvents();
        } catch (error) {
            console.error('Error in initializeWalletEvents:', error);
        }
    }

    function initializeSwitchEvents() {
        try {
            document.querySelectorAll('.switch input[type="checkbox"]').forEach(switchElement => {
                switchElement.addEventListener('change', function() {
                    const parentSwitch = this.closest('.switch');
                    const isChecked = this.checked;
                    
                    if (parentSwitch) {
                        const slider = parentSwitch.querySelector('.slider');
                        if (slider) {
                            if (isChecked) {
                                slider.style.boxShadow = '0 0 10px rgba(46, 204, 113, 0.5)';
                            } else {
                                slider.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.1)';
                            }
                        }
                    }
                    
                    console.log('Switch toggled:', isChecked);
                });
            });
        } catch (error) {
            console.error('Error in initializeSwitchEvents:', error);
        }
    }

    // Modal management
    function showModal(modalId) {
        try {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }
        } catch (error) {
            console.error('Error in showModal:', error);
        }
    }

    function closeModal(modalId) {
        try {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.style.overflow = 'auto';
            }
        } catch (error) {
            console.error('Error in closeModal:', error);
        }
    }

    function showOrderModal() {
        showModal('order-modal');
    }

    function showNotifications() {
        try {
            const notifications = [
                'Pesanan baru dari Cluster C tersedia',
                'Saldo Anda mencukupi untuk 8 trip lagi',
                'Ustadzah Siti memberikan rating 5 bintang',
                'Auto-zakat berhasil disalurkan Rp 2.500',
                'Pahala points Anda bertambah +15'
            ];
            
            notifications.forEach((notif, index) => {
                setTimeout(() => {
                    showNotification(notif, 'info');
                }, index * 1000);
            });
        } catch (error) {
            console.error('Error in showNotifications:', error);
        }
    }

    function showUserMenu() {
        try {
            const menuOptions = [
                'Edit Profile',
                'Pengaturan Akun',
                'Riwayat Aktivitas',
                'Bantuan & Support',
                'Logout'
            ];
            
            showNotification('Menu pengguna: ' + menuOptions.join(', '), 'info');
        } catch (error) {
            console.error('Error in showUserMenu:', error);
        }
    }

    // Notification system
    function showNotification(message, type = 'success') {
        try {
            const container = document.getElementById('notification-container');
            if (!container) return;

            const notification = document.createElement('div');
            
            const colors = {
                success: 'bg-luyu-green',
                error: 'bg-luyu-red',
                warning: 'bg-luyu-gold',
                info: 'bg-luyu-blue'
            };
            
            const icons = {
                success: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>`,
                error: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>`,
                warning: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"/>`,
                info: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>`
            };
            
            notification.className = `notification-enter ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg flex items-center max-w-sm`;
            notification.innerHTML = `
                <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    ${icons[type]}
                </svg>
                <span class="flex-1">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-4 hover:bg-white/20 rounded p-1 flex-shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        } catch (error) {
            console.error('Error in showNotification:', error);
        }
    }

    // Loading overlay
    function showLoading() {
        try {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            }
        } catch (error) {
            console.error('Error in showLoading:', error);
        }
    }

    function hideLoading() {
        try {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        } catch (error) {
            console.error('Error in hideLoading:', error);
        }
    }

    // Search functionality
    function handleSearch(query) {
        try {
            if (query.length > 2) {
                console.log('Searching for:', query);
                
                const searchResults = [
                    'Ustadzah Siti (Driver Cluster C)',
                    'Rute ke Masjid Al-Barokah',
                    'Driver terdekat di Banten',
                    'Cluster C - Prioritas Syariah'
                ].filter(item => item.toLowerCase().includes(query.toLowerCase()));
                
                if (searchResults.length > 0) {
                    showNotification(`Ditemukan ${searchResults.length} hasil untuk "${query}"`, 'info');
                } else {
                    showNotification(`Tidak ada hasil untuk "${query}"`, 'warning');
                }
            }
        } catch (error) {
            console.error('Error in handleSearch:', error);
        }
    }

    // Order processing
    function processOrder() {
        try {
            const fromInput = document.querySelector('input[placeholder="Lokasi penjemputan..."]');
            const toInput = document.querySelector('input[placeholder="Tujuan..."]');
            
            const fromLocation = fromInput ? fromInput.value : '';
            const toLocation = toInput ? toInput.value : '';
            
            if (!fromLocation || !toLocation) {
                showNotification('Mohon lengkapi lokasi penjemputan dan tujuan', 'error');
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                closeModal('order-modal');
                
                if (fromInput) fromInput.value = '';
                if (toInput) toInput.value = '';
                
                showNotification('Pesanan berhasil dibuat! Driver sedang menuju lokasi Anda.', 'success');
                
                userData.totalTrips++;
                
                setTimeout(() => {
                    showNotification('Driver telah mengkonfirmasi pesanan Anda', 'info');
                }, 3000);
                
                setTimeout(() => {
                    showNotification('Driver sedang dalam perjalanan ke lokasi pickup', 'info');
                }, 8000);
            }, 2000);
        } catch (error) {
            console.error('Error in processOrder:', error);
            hideLoading();
            showNotification('Terjadi kesalahan saat memproses pesanan', 'error');
        }
    }

    // Top up functionality
    function setTopupAmount(amount) {
        try {
            const input = document.getElementById('topup-amount');
            if (input) {
                input.value = amount;
                updateZakatAmount(amount);
            }
        } catch (error) {
            console.error('Error in setTopupAmount:', error);
        }
    }

    function updateZakatAmount(amount) {
        try {
            const zakatAmount = Math.floor(amount * 0.025);
            const zakatElement = document.getElementById('zakat-amount');
            if (zakatElement) {
                zakatElement.textContent = `Rp ${zakatAmount.toLocaleString()}`;
            }
        } catch (error) {
            console.error('Error in updateZakatAmount:', error);
        }
    }

    function processTopup() {
        try {
            const amountInput = document.getElementById('topup-amount');
            const autoZakatInput = document.getElementById('auto-zakat');
            
            const amount = amountInput ? parseInt(amountInput.value) : 0;
            const autoZakat = autoZakatInput ? autoZakatInput.checked : false;
            
            if (!amount || amount < 10000) {
                showNotification('Minimum top up adalah Rp 10.000', 'error');
                return;
            }
            
            if (amount > 10000000) {
                showNotification('Maximum top up adalah Rp 10.000.000', 'error');
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                closeModal('topup-modal');
                
                userData.balance += amount;
                if (autoZakat) {
                    const zakatAmount = Math.floor(amount * 0.025);
                    userData.balance -= zakatAmount;
                    showNotification(`Berhasil top up Rp ${amount.toLocaleString()}. Zakat Rp ${zakatAmount.toLocaleString()} telah disalurkan.`, 'success');
                } else {
                    showNotification(`Berhasil top up Rp ${amount.toLocaleString()}`, 'success');
                }
                
                if (amountInput) amountInput.value = '';
                updateZakatAmount(0);
                
                if (currentPage === 'wallet') {
                    setTimeout(() => {
                        loadPageContent('wallet');
                    }, 1000);
                }
            }, 2000);
        } catch (error) {
            console.error('Error in processTopup:', error);
            hideLoading();
            showNotification('Terjadi kesalahan saat memproses top up', 'error');
        }
    }

    // Data simulation and real-time updates
    function startDataSimulation() {
        try {
            setInterval(() => {
                const driverCountElement = document.getElementById('driver-count');
                if (driverCountElement) {
                    const variation = Math.floor(Math.random() * 20) - 10;
                    const newCount = 1247 + variation;
                    driverCountElement.textContent = newCount.toLocaleString();
                }
            }, 30000);

            setInterval(() => {
                userData.pahalaPoints += Math.floor(Math.random() * 5) + 1;
                const pahalaElement = document.getElementById('pahala-count');
                if (pahalaElement) {
                    pahalaElement.textContent = userData.pahalaPoints.toLocaleString();
                }
            }, 60000);

            setInterval(() => {
                if (Math.random() < 0.3) {
                    showNotification('Pesanan baru tersedia di sekitar Anda!', 'info');
                }
            }, 45000);
        } catch (error) {
            console.error('Error in startDataSimulation:', error);
        }
    }

    // Keyboard shortcuts
    function setupKeyboardShortcuts() {
        try {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal:not(.hidden)').forEach(modal => {
                        closeModal(modal.id);
                    });
                    closeDriverPanel();
                }
                
                if (e.ctrlKey && e.key === 'o') {
                    e.preventDefault();
                    showOrderModal();
                }
                
                if (e.ctrlKey && e.key === 't') {
                    e.preventDefault();
                    showModal('topup-modal');
                }
                
                if (e.key >= '1' && e.key <= '9') {
                    const pages = ['dashboard', 'maps', 'orders', 'wallet', 'analytics', 'zakat', 'wakaf', 'kajian', 'settings'];
                    const pageIndex = parseInt(e.key) - 1;
                    if (pages[pageIndex]) {
                        showPage(pages[pageIndex]);
                    }
                }
            });
        } catch (error) {
            console.error('Error in setupKeyboardShortcuts:', error);
        }
    }

    // Accessibility improvements
    function setupAccessibility() {
        try {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    document.body.classList.add('keyboard-navigation');
                }
            });

            document.addEventListener('mousedown', function() {
                document.body.classList.remove('keyboard-navigation');
            });

            document.querySelectorAll('button').forEach(button => {
                if (!button.getAttribute('aria-label') && button.textContent.trim()) {
                    button.setAttribute('aria-label', button.textContent.trim());
                }
            });
        } catch (error) {
            console.error('Error in setupAccessibility:', error);
        }
    }

    // Performance optimization
    function optimizePerformance() {
        try {
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) {
                                img.src = img.dataset.src;
                                img.classList.remove('lazy');
                                observer.unobserve(img);
                            }
                        }
                    });
                });

                document.querySelectorAll('img[data-src]').forEach(img => {
                    imageObserver.observe(img);
                });
            }

            let searchTimeout;
            const searchInput = document.querySelector('input[placeholder="Cari driver, rute..."]');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        handleSearch(this.value);
                    }, 300);
                });
            }
        } catch (error) {
            console.error('Error in optimizePerformance:', error);
        }
    }

    // Local storage management
    function saveUserPreferences() {
        try {
            const preferences = {
                currentPage: currentPage,
                lastLogin: new Date().toISOString(),
                userData: userData
            };
            localStorage.setItem('luyu_preferences', JSON.stringify(preferences));
        } catch (error) {
            console.error('Error in saveUserPreferences:', error);
        }
    }

    function loadUserPreferences() {
        try {
            const preferences = localStorage.getItem('luyu_preferences');
            if (preferences) {
                const prefs = JSON.parse(preferences);
                
                if (prefs.userData) {
                    userData = { ...userData, ...prefs.userData };
                }
                
                if (prefs.lastLogin) {
                    const lastLogin = new Date(prefs.lastLogin);
                    const now = new Date();
                    const daysDiff = Math.floor((now - lastLogin) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff > 0) {
                        setTimeout(() => {
                            showNotification(`Selamat datang kembali! Terakhir login ${daysDiff} hari yang lalu`, 'info');
                        }, 2000);
                    }
                }
            }
        } catch (error) {
            console.error('Error in loadUserPreferences:', error);
        }
    }

    // Error handling
    function setupErrorHandling() {
        try {
            window.addEventListener('error', function(e) {
                console.error('Application error:', e.error);
                showNotification('Terjadi kesalahan sistem. Tim teknis akan segera memperbaiki.', 'error');
            });

            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled promise rejection:', e.reason);
                showNotification('Koneksi bermasalah. Silakan coba lagi.', 'warning');
            });
        } catch (error) {
            console.error('Error in setupErrorHandling:', error);
        }
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
        try {
            console.log('LUYU Enhanced Application with Analytics & Orders Loaded Successfully');
            
            loadUserPreferences();
            
            showPage('dashboard');
            setupKeyboardShortcuts();
            setupAccessibility();
            optimizePerformance();
            setupErrorHandling();
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            initializeSwitchEvents();
            startDataSimulation();
            
            setTimeout(() => {
                showNotification('Selamat datang di LUYU Platform! 🌟', 'success');
            }, 1000);
            
            window.addEventListener('beforeunload', saveUserPreferences);
            setInterval(saveUserPreferences, 5 * 60 * 1000);
        } catch (error) {
            console.error('Error during app initialization:', error);
            showNotification('Terjadi kesalahan saat memuat aplikasi', 'error');
        }
    });
</script>

</body>
</html>